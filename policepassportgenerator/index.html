<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Police Passport Document Generator</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        :root {
            --primary-color: #1a365d;
            --secondary-color: #2d3748;
            --accent-color: #3182ce;
            --light-color: #f7fafc;
            --border-color: #e2e8f0;
            --success-color: #38a169;
            --danger-color: #e53e3e;
            --warning-color: #dd6b20;
            --card-shadow: 0 10px 30px rgba(0,0,0,0.1);
            --transition: all 0.3s ease;
        }
        
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            line-height: 1.6;
            color: #2d3748;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 0;
        }
        
        .modern-container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }
        
        header {
            background-color: white;
            color: var(--primary-color);
            padding: 25px 0;
            text-align: center;
            margin-bottom: 30px;
            border-radius: 12px;
            box-shadow: var(--card-shadow);
            position: relative;
            overflow: hidden;
        }
        
        header:before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 5px;
            background: linear-gradient(90deg, var(--accent-color), var(--success-color));
        }
        
        header h1 {
            font-size: 2.2rem;
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 15px;
        }
        
        header h1 i {
            color: var(--accent-color);
        }
        
        header p {
            font-size: 1.1rem;
            opacity: 0.8;
            max-width: 600px;
            margin: 0 auto;
        }
        
        .app-container {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 30px;
        }
        
        @media (max-width: 900px) {
            .app-container {
                grid-template-columns: 1fr;
            }
        }
        
        .card {
            background-color: white;
            border-radius: 12px;
            box-shadow: var(--card-shadow);
            padding: 25px;
            transition: var(--transition);
        }
        
        .card:hover {
            transform: translateY(-5px);
        }
        
        .section-title {
            font-size: 1.5rem;
            color: var(--primary-color);
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 2px solid var(--border-color);
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .section-title i {
            color: var(--accent-color);
        }
        
        .form-group {
            margin-bottom: 20px;
        }
        
        label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: var(--secondary-color);
        }
        
        input, select {
            width: 100%;
            padding: 12px 15px;
            border: 1px solid var(--border-color);
            border-radius: 6px;
            font-size: 1rem;
            transition: var(--transition);
        }
        
        input:focus, select:focus {
            outline: none;
            border-color: var(--accent-color);
            box-shadow: 0 0 0 3px rgba(49, 130, 206, 0.2);
        }
        
        .btn {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            padding: 12px 24px;
            background-color: var(--accent-color);
            color: white;
            border: none;
            border-radius: 6px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: var(--transition);
            text-align: center;
        }
        
        .btn:hover {
            background-color: #2c5aa0;
            transform: translateY(-2px);
        }
        
        .btn:active {
            transform: translateY(0);
        }
        
        .btn-block {
            display: block;
            width: 100%;
        }
        
        .btn-success {
            background-color: var(--success-color);
        }
        
        .btn-success:hover {
            background-color: #2f855a;
        }
        
        .btn-warning {
            background-color: var(--warning-color);
        }
        
        .btn-warning:hover {
            background-color: #c05621;
        }
        
        .btn-danger {
            background-color: var(--danger-color);
        }
        
        .btn-danger:hover {
            background-color: #c53030;
        }
        
        .officer-controls, .accused-controls {
            display: flex;
            gap: 10px;
            margin-bottom: 15px;
        }
        
        .officer-controls input, .accused-controls input {
            flex: 1;
        }
        
        .officer-container, .accused-container {
            position: relative;
            padding: 15px;
            border: 1px solid var(--border-color);
            border-radius: 6px;
            margin-bottom: 15px;
            background-color: #f8fafc;
            transition: var(--transition);
        }
        
        .officer-container:hover, .accused-container:hover {
            background-color: #f0f9ff;
        }
        
        .officer-container h4, .accused-container h4 {
            margin-top: 0;
            color: var(--primary-color);
        }
        
        .remove-officer, .remove-accused {
            position: absolute;
            top: 10px;
            right: 10px;
            background-color: var(--danger-color);
            color: white;
            border: none;
            border-radius: 4px;
            padding: 5px 10px;
            cursor: pointer;
            font-size: 0.8rem;
            transition: var(--transition);
        }
        
        .remove-officer:hover, .remove-accused:hover {
            background-color: #c53030;
        }
        
        .notification {
            padding: 12px 15px;
            margin: 15px 0;
            border-radius: 6px;
            text-align: center;
            display: none;
            animation: slideIn 0.5s ease;
        }
        
        @keyframes slideIn {
            from { transform: translateY(-20px); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }
        
        .notification.success {
            background-color: #c6f6d5;
            color: #22543d;
            border: 1px solid #9ae6b4;
        }
        
        .notification.error {
            background-color: #fed7d7;
            color: #742a2a;
            border: 1px solid #feb2b2;
        }
        
        .document-preview {
            border: 1px solid var(--border-color);
            border-radius: 6px;
            padding: 20px;
            background-color: white;
            min-height: 500px;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);
            width: 100%;
            max-width: 595px;
            height: 842px;
            overflow: hidden;
            transition: var(--transition);
        }
        
        .document-title {
            text-align: center;
            font-weight: bold;
            text-decoration: underline;
            margin-bottom: 20px;
            font-size: 1.5rem;
            color: var(--primary-color);
        }
        
        .document-table {
            width: 100%;
            border-collapse: collapse;
            border: 2px solid var(--primary-color);
            table-layout: fixed;
            margin-bottom: 20px;
        }
        
        .document-table td {
            border: 1px solid var(--primary-color);
            padding: 12px;
            vertical-align: top;
            word-wrap: break-word;
            overflow-wrap: break-word;
        }
        
        .document-table .left-column {
            width: 30%;
        }
        
        .document-table .middle-column {
            width: 20%;
            text-align: center;
        }
        
        .document-table .right-column {
            width: 50%;
        }
        
        .preview-field {
            width: 100%;
            padding: 5px;
            margin: 8px 0;
            min-height: 20px;
            background: transparent;
            color: #000000 !important;
            box-sizing: border-box;
            font-size: 14px;
            word-wrap: break-word;
            overflow-wrap: break-word;
        }
        
        .preview-field.empty:before {
            content: attr(placeholder);
            color: #a0aec0;
        }
        
        .time-container {
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 8px 0;
            gap: 0;
            min-height: 24px; /* Ensure consistent height */
        }
        
        .time-field {
            min-width: 50px;
            padding: 2px 5px;
            min-height: 18px;
            background: transparent;
            color: #000000 !important;
            box-sizing: border-box;
            font-size: 14px;
            text-align: center;
            margin: 0;
            border: none;
        }
        
        .time-field.empty {
            color: #ffffff !important;
        }
        
        .time-field.empty:before {
            content: attr(placeholder);
            color: #ffffff !important;
        }
        
        .time-suffix {
            color: #000000 !important;
            white-space: nowrap;
            font-size: 14px;
            margin-left: 2px;
            display: inline;
            height: auto;
            padding: 0;
        }
        
        .content-text {
            text-align: justify;
            line-height: 1.6;
            font-size: 14px;
            color: #000000 !important;
            word-wrap: break-word;
            overflow-wrap: break-word;
        }
        
        .embedded-field {
            display: inline;
            min-width: 60px;
            padding: 0 2px;
            margin: 0;
            background: transparent;
            white-space: nowrap;
            color: #000000 !important;
        }
        
        .embedded-field.empty:before {
            content: attr(placeholder);
            color: #a0aec0;
        }
        
        .action-buttons {
            display: flex;
            gap: 15px;
            margin-top: 20px;
        }
        
        .action-buttons .btn {
            flex: 1;
        }
        
        .hidden {
            display: none;
        }
        
        .language-selector {
            display: flex;
            align-items: center;
            margin-bottom: 20px;
            gap: 10px;
        }
        
        .language-selector label {
            margin-bottom: 0;
            font-weight: 600;
            white-space: nowrap;
        }
        
        .language-selector select {
            width: auto;
            min-width: 150px;
        }
        
        .language-content {
            display: none;
        }
        
        .language-content.active {
            display: block;
            animation: fadeIn 0.5s ease;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }
        
        .help-text {
            font-size: 0.85rem;
            color: #718096;
            margin-top: 5px;
        }
        
        .required:after {
            content: ' *';
            color: var(--danger-color);
        }
        
        .designation-select {
            width: 100%;
        }
        
        .officer-details {
            display: grid;
            grid-template-columns: 1fr;
            gap: 15px;
        }
        
        @media (max-width: 600px) {
            .officer-details {
                grid-template-columns: 1fr;
            }
        }
        
        .accused-details {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
        }
        
        @media (max-width: 600px) {
            .accused-details {
                grid-template-columns: 1fr;
            }
        }
        
        .pdf-mode .preview-field,
        .pdf-mode .embedded-field,
        .pdf-mode .time-field {
            border-bottom: none !important;
        }
        
        .document-table td {
            overflow: hidden;
        }
        
        .compact-line {
            margin-bottom: 5px;
            line-height: 1.3;
        }
        
        .compact-field {
            margin: 3px 0;
            min-height: 18px;
        }
        
        .middle-column-content {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            height: 100%;
        }
        
        .officer-container-preview {
            margin-bottom: 10px;
        }
        
        .officer-top-line {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 2px;
        }
        
        .officer-designation {
            min-width: 80px;
            flex-shrink: 0;
        }
        
        .officer-number {
            min-width: 60px;
            flex-shrink: 0;
        }
        
        .officer-name {
            width: 100%;
            margin-top: 2px;
        }
        
        .hidden-field {
            display: none !important;
        }
        
        .error-message {
            color: var(--danger-color);
            font-size: 0.85rem;
            margin-top: 5px;
            display: none;
        }
        
        .input-error {
            border-color: var(--danger-color);
            box-shadow: 0 0 0 3px rgba(229, 62, 62, 0.2);
        }
        
        .input-success {
            border-color: var(--success-color);
            box-shadow: 0 0 0 3px rgba(56, 161, 105, 0.2);
        }
        
        .transfer-fields {
            display: none;
            background-color: #f0f9ff;
            padding: 15px;
            border-radius: 6px;
            margin-top: 15px;
            border: 1px solid var(--border-color);
        }
        
        .transfer-fields.active {
            display: block;
            animation: slideDown 0.3s ease;
        }
        
        @keyframes slideDown {
            from { opacity: 0; max-height: 0; }
            to { opacity: 1; max-height: 500px; }
        }
        
        .fir-fields {
            display: none;
            background-color: #fff5f5;
            padding: 15px;
            border-radius: 6px;
            margin-top: 15px;
            border: 1px solid var(--border-color);
        }
        
        .fir-fields.active {
            display: block;
            animation: slideDown 0.3s ease;
        }
        
        .visera-fields {
            display: none;
            background-color: #f0f9ff;
            padding: 15px;
            border-radius: 6px;
            margin-top: 15px;
            border: 1px solid var(--border-color);
        }
        
        .visera-fields.active {
            display: block;
            animation: slideDown 0.3s ease;
        }
        
        .lab-report-fields {
            display: none;
            background-color: #f0f9ff;
            padding: 15px;
            border-radius: 6px;
            margin-top: 15px;
            border: 1px solid var(--border-color);
        }
        
        .lab-report-fields.active {
            display: block;
            animation: slideDown 0.3s ease;
        }
        
        @media print {
            body * {
                visibility: hidden;
            }
            #document-to-print, #document-to-print * {
                visibility: visible;
            }
            #document-to-print {
                position: absolute;
                left: 0;
                top: 0;
                width: 100%;
                height: 100%;
            }
        }
        
        .spinner {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid rgba(255,255,255,.3);
            border-radius: 50%;
            border-top-color: #fff;
            animation: spin 1s ease-in-out infinite;
            margin-right: 10px;
        }
        
        @keyframes spin {
            to { transform: rotate(360deg); }
        }
        
        .auto-save {
            position: fixed;
            bottom: 20px;
            right: 20px;
            background: var(--success-color);
            color: white;
            padding: 10px 15px;
            border-radius: 4px;
            font-size: 0.9rem;
            box-shadow: 0 2px 5px rgba(0,0,0,0.2);
            display: none;
            z-index: 1000;
            animation: slideIn 0.5s ease;
        }
        
        .format-example {
            font-size: 0.8rem;
            color: #718096;
            margin-top: 5px;
            font-style: italic;
        }
        
        .content-status {
            display: flex;
            align-items: center;
            gap: 8px;
            margin-top: 10px;
            padding: 8px 12px;
            border-radius: 6px;
            font-size: 0.9rem;
            font-weight: 500;
        }
        
        .content-status.available {
            background-color: #f0fff4;
            color: #22543d;
            border: 1px solid #9ae6b4;
        }
        
        .content-status.unavailable {
            background-color: #fff5f5;
            color: #742a2a;
            border: 1px solid #feb2b2;
        }
        
        .content-status-icon {
            width: 16px;
            height: 16px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.7rem;
            font-weight: bold;
        }
        
        .content-status.available .content-status-icon {
            background-color: #38a169;
            color: white;
        }
        
        .content-status.unavailable .content-status-icon {
            background-color: #e53e3e;
            color: white;
        }

        #document-to-print,
        #document-to-print .document-table,
        #document-to-print .document-table td,
        #document-to-print .content-text,
        #document-to-print .embedded-field,
        #document-to-print .preview-field,
        #document-to-print .time-field,
        #document-to-print .time-suffix {
            color: #000000 !important;
            -webkit-print-color-adjust: exact !important;
            print-color-adjust: exact !important;
        }

        #document-to-print.pdf-mode .right-column,
        #document-to-print.pdf-mode .content-text,
        #document-to-print.pdf-mode .embedded-field,
        #document-to-print.pdf-mode .preview-field,
        #document-to-print.pdf-mode .time-field,
        #document-to-print.pdf-mode .time-suffix {
            color: #000000 !important;
            font-weight: normal !important;
        }

        #document-to-print.pdf-mode {
            opacity: 1 !important;
            background: #FFFFFF !important;
        }

        #document-to-print.pdf-mode,
        #document-to-print.pdf-mode * {
            color: #000000 !important;
            -webkit-print-color-adjust: exact !important;
            print-color-adjust: exact !important;
        }

        #document-to-print.pdf-mode .content-text,
        #document-to-print.pdf-mode .embedded-field,
        #document-to-print.pdf-mode .preview-field,
        #document-to-print.pdf-mode .time-field,
        #document-to-print.pdf-mode .time-suffix {
            opacity: 1 !important;
            filter: none !important;
        }

        #document-to-print.pdf-mode * {
            text-shadow: none !important;
            filter: none !important;
        }

        /* Ensure empty time field is white in PDF */
        #document-to-print.pdf-mode .time-field.empty,
        #document-to-print.pdf-mode .time-field.empty:before {
            color: #ffffff !important;
        }
    </style>
</head>
<body>
    <div class="modern-container">
        <header>
            <h1><i class="fas fa-passport"></i> Police Passport Document Generator</h1>
            <p>Create professional police passport documents quickly and easily</p>
        </header>
        
        <div class="app-container">
            <div class="card">
                <h2 class="section-title"><i class="fas fa-edit"></i> Document Information</h2>
                
                <div class="form-group">
                    <label for="passportType" class="required">Passport Type</label>
                    <select id="passportType">
                        <option value="">Select Passport Type</option>
                        <option value="Lab Report">Lab Report</option>
                        <option value="PT warrant">PT warrant</option>
                        <option value="Escort">Escort</option>
                        <option value="Visera Report">Visera Report</option>
                        <option value="Releaving Passport">Releaving Passport</option>
                        <option value="Property to lab">Property to lab</option>
                        <option value="Sick Passport">Sick Passport</option>
                        <option value="ML Passport">ML Passport</option>
                        <option value="Formal Arrest">Formal Arrest</option>
                        <option value="Transfer Passport">Transfer Passport</option>
                        <option value="FIR Filing Passport">FIR Filing Passport</option>
                    </select>
                    <div class="error-message" id="passportType-error">Please select a passport type</div>
                    
                    <div class="content-status hidden" id="content-status">
                        <div class="content-status-icon">!</div>
                        <span id="content-status-text">Content status will appear here</span>
                    </div>
                </div>
                
                <div class="language-selector">
                    <label for="language"><i class="fas fa-language"></i> Document Language:</label>
                    <select id="language">
                        <option value="tamil">Tamil</option>
                        <option value="english">English</option>
                    </select>
                </div>
                
                <div class="form-group">
                    <label for="policeStation" class="required">Police Station</label>
                    <input type="text" id="policeStation" placeholder="Enter police station name">
                    <div class="error-message" id="policeStation-error">Please enter a police station</div>
                    <div class="help-text">This will be used in the document content</div>
                </div>
                
                <div class="form-group">
                    <label for="crimeNumber" class="required">Crime Number</label>
                    <input type="text" id="crimeNumber" placeholder="Enter crime number (e.g., 123/2024)">
                    <div class="error-message" id="crimeNumber-error">Please enter a valid crime number in format: number/year (e.g., 123/2024)</div>
                    <div class="format-example">Format: number/year (e.g., 123/2024)</div>
                </div>
                
                <div class="form-group">
                    <label for="section" class="required">Section</label>
                    <input type="text" id="section" placeholder="Enter section">
                    <div class="error-message" id="section-error">Please enter a section</div>
                    <div class="help-text">Enter the relevant IPC section (e.g., 302, 420)</div>
                </div>
                
                <div class="transfer-fields" id="transfer-fields">
                    <h3 class="section-title"><i class="fas fa-exchange-alt"></i> Transfer Details</h3>
                    <div class="form-group">
                        <label for="fromStation" class="required">From Station</label>
                        <input type="text" id="fromStation" placeholder="Enter from station">
                        <div class="error-message" id="fromStation-error">Please enter from station</div>
                    </div>
                    <div class="form-group">
                        <label for="toStation" class="required">To Station</label>
                        <input type="text" id="toStation" placeholder="Enter to station">
                        <div class="error-message" id="toStation-error">Please enter to station</div>
                    </div>
                    <div class="form-group">
                        <label for="transferReason" class="required">Transfer Reason</label>
                        <input type="text" id="transferReason" placeholder="Enter transfer reason">
                        <div class="error-message" id="transferReason-error">Please enter transfer reason</div>
                    </div>
                </div>
                
                <div class="fir-fields conditional-section" id="fir-fields">
                    <h3 class="section-title"><i class="fas fa-file-alt"></i> FIR Details</h3>
                    <div class="form-group">
                        <label for="complainantName" class="required">Complainant Name</label>
                        <input type="text" id="complainantName" placeholder="Enter complainant name">
                        <div class="error-message" id="complainantName-error">Please enter complainant name</div>
                    </div>
                    <div class="form-group">
                        <label for="complainantAddress" class="required">Complainant Address</label>
                        <input type="text" id="complainantAddress" placeholder="Enter complainant address">
                        <div class="error-message" id="complainantAddress-error">Please enter complainant address</div>
                    </div>
                    <div class="form-group">
                        <label for="incidentDate" class="required">Incident Date</label>
                        <input type="text" id="incidentDate" placeholder="Enter incident date in DD/MM/YYYY format">
                        <div class="error-message" id="incidentDate-error">Please enter a valid incident date</div>
                    </div>
                    <div class="form-group">
                        <label for="incidentTime">Incident Time</label>
                        <input type="text" id="incidentTime" placeholder="Enter incident time in HH:MM format">
                        <div class="error-message" id="incidentTime-error">Please enter a valid incident time</div>
                        <div class="help-text">Optional field</div>
                    </div>
                    <div class="form-group">
                        <label for="incidentPlace" class="required">Incident Place</label>
                        <input type="text" id="incidentPlace" placeholder="Enter incident place">
                        <div class="error-message" id="incidentPlace-error">Please enter incident place</div>
                    </div>
                </div>
                
                <div class="visera-fields" id="visera-fields">
                    <h3 class="section-title"><i class="fas fa-flask"></i> Visera Report Details</h3>
                    <div class="form-group">
                        <label for="deceasedName" class="required">Deceased Name</label>
                        <input type="text" id="deceasedName" placeholder="Enter deceased name">
                        <div class="error-message" id="deceasedName-error">Please enter deceased name</div>
                    </div>
                    <div class="form-group">
                        <label for="deceasedAge" class="required">Deceased Age</label>
                        <input type="text" id="deceasedAge" placeholder="Enter deceased age">
                        <div class="error-message" id="deceasedAge-error">Please enter deceased age</div>
                    </div>
                    <div class="form-group">
                        <label for="deceasedFatherName" class="required">Deceased Father Name</label>
                        <input type="text" id="deceasedFatherName" placeholder="Enter deceased father name">
                        <div class="error-message" id="deceasedFatherName-error">Please enter deceased father name</div>
                    </div>
                    <div class="form-group">
                        <label for="pmNumber" class="required">P.M. Number</label>
                        <input type="text" id="pmNumber" placeholder="Enter P.M. Number">
                        <div class="error-message" id="pmNumber-error">Please enter P.M. Number</div>
                    </div>
                    <div class="form-group">
                        <label for="pmDate" class="required">P.M. Date</label>
                        <input type="text" id="pmDate" placeholder="Enter P.M. date in DD/MM/YYYY format">
                        <div class="error-message" id="pmDate-error">Please enter a valid P.M. date</div>
                    </div>
                </div>
                
                <div class="lab-report-fields" id="lab-report-fields">
                    <h3 class="section-title"><i class="fas fa-file-medical"></i> Lab Report Details</h3>
                    <div class="form-group">
                        <label for="narNumber" class="required">NAR Number</label>
                        <input type="text" id="narNumber" placeholder="Enter NAR Number">
                        <div class="error-message" id="narNumber-error">Please enter NAR Number</div>
                    </div>
                    <div class="form-group">
                        <label for="narDate" class="required">NAR Date</label>
                        <input type="text" id="narDate" placeholder="Enter NAR date in DD/MM/YYYY format">
                        <div class="error-message" id="narDate-error">Please enter a valid NAR date</div>
                    </div>
                </div>
                
                <div class="conditional-section" id="accused-section">
                    <h3 class="section-title"><i class="fas fa-user"></i> Accused Persons</h3>
                    
                    <div class="form-group">
                        <div class="accused-controls">
                            <input type="number" id="accused-count" min="1" max="10" value="1" placeholder="Number of accused">
                            <button type="button" id="add-accused" class="btn"><i class="fas fa-plus"></i> Add Accused</button>
                        </div>
                        <div class="help-text">Enter the number of accused persons or use the button to add individually</div>
                    </div>
                    
                    <div id="accused-persons-container">
                    </div>
                </div>
                
                <div class="form-group conditional-section" id="mm-section">
                    <label for="mm" class="required">MM</label>
                    <input type="text" id="mm" placeholder="Enter MM (e.g., 1, 2, 3)">
                    <div class="error-message" id="mm-error">Please enter a valid MM number</div>
                    <div class="help-text">Enter the Metropolitan Magistrate number</div>
                </div>
                
                <div class="form-group">
                    <label for="date" class="required">Date</label>
                    <input type="text" id="date" placeholder="Enter date in DD/MM/YYYY format">
                    <div class="error-message" id="date-error">Please enter a valid date in DD/MM/YYYY format</div>
                </div>
                
                <div class="form-group">
                    <label for="time">Time</label>
                    <input type="text" id="time" placeholder="Enter time in HH:MM format">
                    <div class="error-message" id="time-error">Please enter a valid time in HH:MM format</div>
                    <div class="help-text">Optional field - leave blank to keep space vacant in document</div>
                </div>
                
                <h3 class="section-title"><i class="fas fa-user-shield"></i> Police Officers</h3>
                
                <div class="form-group">
                    <div class="officer-controls">
                        <input type="number" id="officer-count" min="1" max="10" value="1" placeholder="Number of officers">
                        <button type="button" id="add-officer" class="btn"><i class="fas fa-plus"></i> Add Officer</button>
                    </div>
                    <div class="help-text">Enter the number of officers or use the button to add individually</div>
                </div>
                
                <div id="police-officers-container">
                </div>
                
                <div id="notification" class="notification"></div>
                
                <button id="fill-form" class="btn btn-success btn-block"><i class="fas fa-file-alt"></i> Generate Document</button>
            </div>
            
            <div class="card preview-section">
                <h2 class="section-title"><i class="fas fa-eye"></i> Document Preview</h2>
                
                <div class="document-preview" id="document-to-print">
                    <div class="document-title">
                        POLICE PASSPORT
                    </div>
                    
                    <table class="document-table">
                        <tr>
                            <td class="left-column">
                                <div id="police-officers-list">
                                </div>
                                
                                <div class="preview-field compact-field empty" id="police-station-field" placeholder="Police Station"></div>
                            </td>
                            <td class="middle-column">
                                <div class="middle-column-content">
                                    <div class="time-container" id="time-container">
                                        <span class="time-field empty" id="time-field" placeholder="Time (HH:MM)"></span>
                                        <span class="time-suffix" id="time-suffix">Hrs</span>
                                    </div>
                                    <div class="preview-field compact-field empty" id="date-field" placeholder="Date (DD/MM/YYYY)"></div>
                                </div>
                            </td>
                            <td class="right-column">
                                <div class="content-text" id="content-placeholder">
                                    Please fill out the form to generate the document content.
                                </div>
                                
                                <div class="language-content active" id="tamil-content">
                                    <div class="content-text" id="escort-tamil-content" style="display: none;">
                                        ஆகிய நீவிர் <span class="embedded-field empty" id="police-station-content-tamil" placeholder="Police Station"></span> காவல் நிலைய குற்ற எண். <span class="embedded-field empty" id="crime-no-field-tamil" placeholder="Cr. No."></span> U/s <span class="embedded-field empty" id="section-field-tamil" placeholder="Section"></span> என்ற வழக்கில் சம்மந்தப்பட்ட எதிரி <span id="accused-list-tamil"></span> என்பவரை கனம் <span class="embedded-field empty" id="mm-field-tamil" placeholder="MM"></span>-வது பெருநகர குற்றவியல் நடுவர் அவர்களிடம் ஆஜர்படுத்தி உத்தரவுபடி நடந்து அத்தாட்சி பெற்று நிலையம் வரவும்.
                                    </div>
                                    
                                    <div class="content-text" id="pt-warrant-tamil-content" style="display: none;">
                                        ஆகிய நீவிர் <span class="embedded-field empty" id="police-station-content-pt-tamil" placeholder="Police Station"></span> கா.நி. கு. எண். <span class="embedded-field empty" id="crime-no-field-pt-tamil" placeholder="Cr. No."></span> U/s <span class="embedded-field empty" id="section-field-pt-tamil" placeholder="Section"></span> (ளுஊ.ழே. <span class="embedded-field empty" id="sc-no-field-tamil" placeholder="SC No."></span> P.Nழு. <span class="embedded-field empty" id="prc-no-field-tamil" placeholder="PRC No."></span> ) என்ற வழக்கில் சம்மந்தப்பட்ட எதிரி <span id="accused-list-pt-tamil"></span> என்பவருக்கு கனம் <span class="embedded-field empty" id="mm-field-pt-tamil" placeholder="MM"></span>-வது டுதல் அமர்வு நீதிமன்ற நீதிபதி அவர்களால் வழங்கப்பட்ட PT Warrant-ஐ <span class="embedded-field empty" id="central-prison-field-tamil" placeholder="Central Prison"></span> மத்திய சிறை கண்காணிப்பாளர் சென்னை அவர்களிடம் சார்வு செய்து அத்தாட்சி பெற்று நிலையம் வரவும்.
                                    </div>
                                    
                                    <div class="content-text" id="sick-passport-tamil-content" style="display: none;">
                                        உங்கள் உடல்நிலை சிகிச்சைக்காக காவல் மருத்துவமனையின் மருத்துவ அதிகாரியிடம் ஆஜர்படுத்தி அங்கீகாரம் பெற்று திரும்பவும். உங்கள் சிகிச்சை I.P. அல்லது O.P. இல் இருந்தால் உடனடியாக காவல் நிலையத்திற்கு செய்தியைத் தெரிவிக்க வேண்டும்.
                                    </div>
                                    
                                    <div class="content-text" id="transfer-passport-tamil-content" style="display: none;">
                                        ஆகிய நீவிர் கிழக்கு மண்டல காவல் துணை ஆய்வாளர் அவர்களின் RC.No.Estt/EZ/2389/82/2023 EZO.No.485/2023, தேதி: 13.06.2023 உத்தரவின் படி G3 கில்பauk L&O காவல் நிலைய ஆய்வாளர் அவர்களிடம் உடனடியாக ஆஜர்படுத்தி அத்தாட்சி பெற்று நிலையம் வரவும்.
                                    </div>
                                    
                                    <div class="content-text" id="fir-filing-tamil-content" style="display: none;">
                                        ஆகிய நீவிர் <span class="embedded-field empty" id="police-station-content-fir-tamil" placeholder="Police Station"></span> காவல்நிலைய குற்ற எண். <span class="embedded-field empty" id="crime-no-field-fir-tamil" placeholder="Cr. No."></span> U/s <span class="embedded-field empty" id="section-field-fir-tamil" placeholder="Section"></span> என்ற வழக்கின் முதல் தகவல் அறிக்கையை கனம் <span class="embedded-field empty" id="mm-field-fir-tamil" placeholder="MM"></span>வது பெருநகர குற்றவியல் நடுவர் நீதிமன்றத்தில் தாக்கல் செய்து அத்தாட்சி பெற்று நிலையம் வரவும்.
                                    </div>
                                    
                                    <div class="content-text" id="visera-report-tamil-content" style="display: none;">
                                        ஆகிய நீவிர் மயிலாப்பூரில் உள்ள  தடயவியல் அறிவியல் ஆய்வகத்திற்கு சென்று <span class="embedded-field empty" id="police-station-content-visera-tamil" placeholder="Police Station"></span> காவல் நிலைய குற்ற எண். <span class="embedded-field empty" id="crime-no-field-visera-tamil" placeholder="Cr. No."></span> U/s <span class="embedded-field empty" id="section-field-visera-tamil" placeholder="Section"></span> இறப்பு <span class="embedded-field empty" id="deceased-name-field-tamil" placeholder="Deceased Name"></span> ஆ/வ <span class="embedded-field empty" id="deceased-age-field-tamil" placeholder="Deceased Age"></span> த/பெ <span class="embedded-field empty" id="deceased-father-name-field-tamil" placeholder="Deceased Father Name"></span> P.M. எண்: <span class="embedded-field empty" id="pm-number-field-tamil" placeholder="P.M. Number"></span>, தேதி <span class="embedded-field empty" id="pm-date-field-tamil" placeholder="P.M. Date"></span> இன் விசரா அறிக்கையை பெற்று அத்தாட்சி பெற்று நிலையம் வரவும்.
                                    </div>
                                    
                                    <div class="content-text" id="lab-report-tamil-content" style="display: none;">
                                        ஆகிய நீவிர் மயிலாப்பூரில் உள்ள தடயவியல் அறிவியல் ஆய்வகத்திற்கு சென்று <span class="embedded-field empty" id="police-station-content-lab-tamil" placeholder="Police Station"></span> காவல் நிலைய குற்ற எண்: <span class="embedded-field empty" id="crime-no-field-lab-tamil" placeholder="Cr. No."></span> U/s <span class="embedded-field empty" id="section-field-lab-tamil" placeholder="Section"></span> தேதி <span class="embedded-field empty" id="date-field-lab-tamil" placeholder="Date"></span> இன் ஆய்வக அறிக்கையை பெற்று அத்தாட்சி பெற்று நிலையம் வரவும். NAR எண்: <span class="embedded-field empty" id="nar-no-field-tamil" placeholder="NAR No."></span> தேதி: <span class="embedded-field empty" id="nar-date-field-tamil" placeholder="NAR Date"></span>
                                    </div>
                                    
                                    <div class="content-text" id="formal-arrest-tamil-content" style="display: none;">
                                        ஆகிய நீவிர் சேத்துப்பட்டு கா.நி கு.எண். <span class="embedded-field empty" id="crime-no-field-formal-arrest-tamil" placeholder="Cr. No."></span> U/s <span class="embedded-field empty" id="section-field-formal-arrest-tamil" placeholder="Section"></span> என்ற வழக்கில் சம்மந்தப்பட்ட எதிரி <span id="accused-list-formal-arrest-tamil"></span> என்பவருக்கு சம்பிரதாய கைது (Formal Arrest) ஐ சிறை கண்காணிப்பாளர் பஜர்ல் மத்திய சிறை, சென்னை அவர்களிடம் சார்வை செய்து அத்தாட்சி பெற்று நிலையம் வரவும்.
                                    </div>
                                </div>
                                
                                <div class="language-content" id="english-content">
                                    <div class="content-text" id="escort-english-content" style="display: none;">
                                        You are hereby directed to produce the accused <span id="accused-list-english"></span> involved in <span class="embedded-field empty" id="police-station-content-english" placeholder="Police Station"></span> Crime No. <span class="embedded-field empty" id="crime-no-field-english" placeholder="Cr. No."></span> U/s <span class="embedded-field empty" id="section-field-english" placeholder="Section"></span> before the <span class="embedded-field empty" id="mm-field-english" placeholder="MM"></span> Metropolitan Magistrate, obtain orders and return to the station with acknowledgement.
                                    </div>
                                    
                                    <div class="content-text" id="pt-warrant-english-content" style="display: none;">
                                        You are hereby directed to execute the PT Warrant issued by the Hon'ble <span class="embedded-field empty" id="mm-field-pt-english" placeholder="MM"></span> Metropolitan Magistrate to the accused <span id="accused-list-pt-english"></span> involved in <span class="embedded-field empty" id="police-station-content-pt-english" placeholder="Police Station"></span> Crime No. <span class="embedded-field empty" id="crime-no-field-pt-english" placeholder="Cr. No."></span> U/S <span class="embedded-field empty" id="section-field-pt-english" placeholder="Section"></span> NDPS Act (SC.NO.<span class="embedded-field empty" id="sc-no-field-english" placeholder="SC No."></span>, PRC.NO. <span class="embedded-field empty" id="prc-no-field-english" placeholder="PRC No."></span>) before the Central Prison Superintendent, Chennai and return to the station with acknowledgement.
                                    </div>
                                    
                                    <div class="content-text" id="sick-passport-english-content" style="display: none;">
                                        You are directed to report before Medical officer of Police Hospital for your illness treatment and get back with acknowledgment. If you are treated as I.P. or O.P. you must intimate the message to the police station at once without fail.
                                    </div>
                                    
                                    <div class="content-text" id="transfer-passport-english-content" style="display: none;">
                                        You are hereby instructed to report before the Inspector of Police G3 Kilpauk L&O PS as per the JCOP East Zone order RC.No.Estt/EZ/2389/82/2023 EZO.No.485/2023, Dt:13.06.2023 immediately and return to the station with acknowledgement.
                                    </div>
                                    
                                    <div class="content-text" id="fir-filing-english-content" style="display: none;">
                                        You are hereby directed to file the FIR in <span class="embedded-field empty" id="police-station-content-fir-english" placeholder="Police Station"></span> Crime No. <span class="embedded-field empty" id="crime-no-field-fir-english" placeholder="Cr. No."></span> U/s <span class="embedded-field empty" id="section-field-fir-english" placeholder="Section"></span> before the <span class="embedded-field empty" id="mm-field-fir-english" placeholder="MM"></span> Metropolitan Magistrate and return to the station with acknowledgement.
                                    </div>
                                    
                                    <div class="content-text" id="visera-report-english-content" style="display: none;">
                                        You are directed to report forensic science lab at Mylapore and obtain the Visra Report of <span class="embedded-field empty" id="police-station-content-visera-english" placeholder="Police Station"></span> Cr.No. <span class="embedded-field empty" id="crime-no-field-visera-english" placeholder="Cr. No."></span> U/s <span class="embedded-field empty" id="section-field-visera-english" placeholder="Section"></span> deceased <span class="embedded-field empty" id="deceased-name-field-english" placeholder="Deceased Name"></span> M/a <span class="embedded-field empty" id="deceased-age-field-english" placeholder="Deceased Age"></span>, S/o <span class="embedded-field empty" id="deceased-father-name-field-english" placeholder="Deceased Father Name"></span>, P.M. No: <span class="embedded-field empty" id="pm-number-field-english" placeholder="P.M. Number"></span>, dated <span class="embedded-field empty" id="pm-date-field-english" placeholder="P.M. Date"></span> and get back with acknowledgment.
                                    </div>
                                    
                                    <div class="content-text" id="lab-report-english-content" style="display: none;">
                                        You are directed to report forensic science at Mylapore and collect the lab report in <span class="embedded-field empty" id="police-station-content-lab-english" placeholder="Police Station"></span> PS Cr.No: <span class="embedded-field empty" id="crime-no-field-lab-english" placeholder="Cr. No."></span> U/s <span class="embedded-field empty" id="section-field-lab-english" placeholder="Section"></span> dated <span class="embedded-field empty" id="date-field-lab-english" placeholder="Date"></span> and return back. NAR No. <span class="embedded-field empty" id="nar-no-field-english" placeholder="NAR No."></span> Dt. <span class="embedded-field empty" id="nar-date-field-english" placeholder="NAR Date"></span>
                                    </div>
                                    
                                    <div class="content-text" id="formal-arrest-english-content" style="display: none;">
                                        You are hereby directed to produce the accused <span id="accused-list-formal-arrest-english"></span> involved in Crime No. <span class="embedded-field empty" id="crime-no-field-formal-arrest-english" placeholder="Cr. No."></span> U/s <span class="embedded-field empty" id="section-field-formal-arrest-english" placeholder="Section"></span> for Formal Arrest before the Central Prison Superintendent, Puzhal Central Prison, Chennai and return to the station with acknowledgement.
                                    </div>
                                </div>
                            </td>
                        </tr>
                    </table>
                </div>
                
                <div class="action-buttons">
                    <button id="print-document" class="btn btn-warning"><i class="fas fa-print"></i> Print Document</button>
                    <button id="generate-pdf" class="btn btn-success"><i class="fas fa-file-pdf"></i> Generate PDF</button>
                </div>
            </div>
        </div>
    </div>

    <div class="auto-save" id="auto-save-indicator"><i class="fas fa-check-circle"></i> Auto-saved</div>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const { jsPDF } = window.jspdf;
            const generateBtn = document.getElementById('generate-pdf');
            const printBtn = document.getElementById('print-document');
            const fillFormBtn = document.getElementById('fill-form');
            const passportTypeSelect = document.getElementById('passportType');
            const languageSelect = document.getElementById('language');
            const crimeNumberInput = document.getElementById('crimeNumber');
            const policeStationInput = document.getElementById('policeStation');
            const notification = document.getElementById('notification');
            const officerCountInput = document.getElementById('officer-count');
            const addOfficerBtn = document.getElementById('add-officer');
            const accusedCountInput = document.getElementById('accused-count');
            const addAccusedBtn = document.getElementById('add-accused');
            const policeOfficersContainer = document.getElementById('police-officers-container');
            const accusedPersonsContainer = document.getElementById('accused-persons-container');
            const policeOfficersList = document.getElementById('police-officers-list');
            const languageContents = document.querySelectorAll('.language-content');
            const contentPlaceholder = document.getElementById('content-placeholder');
            const autoSaveIndicator = document.getElementById('auto-save-indicator');
            const contentStatus = document.getElementById('content-status');
            const contentStatusText = document.getElementById('content-status-text');
            const accusedSection = document.getElementById('accused-section');
            const mmSection = document.getElementById('mm-section');
            const transferFields = document.getElementById('transfer-fields');
            const firFields = document.getElementById('fir-fields');
            const viseraFields = document.getElementById('visera-fields');
            const labReportFields = document.getElementById('lab-report-fields');
            const timeContainer = document.getElementById('time-container');
            const timeSuffix = document.getElementById('time-suffix');
            
            let officerCounter = 1;
            let accusedCounter = 1;
            let currentLanguage = 'tamil';
            let autoSaveTimeout;
            
            const availablePassportTypes = {
                'Lab Report': true,
                'PT warrant': true,
                'Escort': true,
                'Visera Report': true,
                'Releaving Passport': false,
                'Property to lab': false,
                'Sick Passport': true,
                'ML Passport': false,
                'Formal Arrest': true,
                'Transfer Passport': true,
                'FIR Filing Passport': true
            };
            
            function showNotification(message, type) {
                notification.textContent = message;
                notification.className = 'notification ' + type;
                notification.style.display = 'block';
                
                setTimeout(() => {
                    notification.style.display = 'none';
                }, 5000);
            }
            
            function isValidCrimeNumber(crimeNumber) {
                const regex = /^\d+\/\d{4}$/;
                return regex.test(crimeNumber);
            }
            
            function formatCrimeNumber(input) {
                let value = input.value.replace(/[^\d\/]/g, '');
                
                const parts = value.split('/');
                if (parts.length > 2) {
                    value = parts[0] + '/' + parts.slice(1).join('');
                }
                
                if (value.length >= 4 && !value.includes('/')) {
                    value = value.substring(0, value.length - 4) + '/' + value.substring(value.length - 4);
                }
                
                input.value = value;
            }
            
            function getOrdinalSuffix(num) {
                if (!num || isNaN(num)) return '';
                
                const j = num % 10;
                const k = num % 100;
                
                if (j === 1 && k !== 11) {
                    return num + "st";
                }
                if (j === 2 && k !== 12) {
                    return num + "nd";
                }
                if (j === 3 && k !== 13) {
                    return num + "rd";
                }
                return num + "th";
            }
            
            function isValidDate(dateString) {
                const regex = /^(\d{1,2})\/(\d{1,2})\/(\d{4})$/;
                if (!regex.test(dateString)) return false;
                
                const parts = dateString.split('/');
                const day = parseInt(parts[0], 10);
                const month = parseInt(parts[1], 10);
                const year = parseInt(parts[2], 10);
                
                if (year < 1000 || year > 3000 || month === 0 || month > 12) return false;
                
                const monthLength = [31, 28, 31, 30, 31, 30, 31, 31, 30, 31, 30, 31];
                
                if (year % 400 === 0 || (year % 100 !== 0 && year % 4 === 0)) {
                    monthLength[1] = 29;
                }
                
                return day > 0 && day <= monthLength[month - 1];
            }
            
            function isValidTime(timeString) {
                if (!timeString || timeString.trim() === '') return true; // Time is optional
                const regex = /^([0-1]?[0-9]|2[0-3]):[0-5][0-9]$/;
                return regex.test(timeString);
            }
            
            function showError(inputId, message) {
                const input = document.getElementById(inputId);
                const errorElement = document.getElementById(`${inputId}-error`);
                
                input.classList.add('input-error');
                input.classList.remove('input-success');
                errorElement.textContent = message;
                errorElement.style.display = 'block';
            }
            
            function hideError(inputId) {
                const input = document.getElementById(inputId);
                const errorElement = document.getElementById(`${inputId}-error`);
                
                input.classList.remove('input-error');
                input.classList.add('input-success');
                errorElement.style.display = 'none';
            }
            
            function validateField() {
                const fieldId = this.id;
                const value = this.value.trim();
                
                if (fieldId === 'time' || fieldId === 'incidentTime') {
                    // Time fields are optional, only validate if they have content
                    if (value && !isValidTime(value)) {
                        showError(fieldId, 'Please enter a valid time in HH:MM format or leave blank');
                        return false;
                    } else {
                        hideError(fieldId);
                        return true;
                    }
                }
                
                if (!value) {
                    if (this.hasAttribute('required')) {
                        showError(fieldId, 'This field is required');
                        return false;
                    } else {
                        hideError(fieldId);
                        return true;
                    }
                }
                
                if (fieldId === 'crimeNumber') {
                    if (!isValidCrimeNumber(value)) {
                        showError(fieldId, 'Please enter a valid crime number in format: number/year (e.g., 123/2024)');
                        return false;
                    }
                }
                
                if (fieldId === 'date' || fieldId === 'incidentDate' || fieldId === 'pmDate' || fieldId === 'narDate') {
                    if (!isValidDate(value)) {
                        showError(fieldId, 'Please enter a valid date in DD/MM/YYYY format');
                        return false;
                    }
                }
                
                if (fieldId === 'mm') {
                    if (isNaN(value) || value < 1) {
                        showError(fieldId, 'Please enter a valid MM number');
                        return false;
                    }
                }
                
                if (fieldId.includes('age') || fieldId === 'deceasedAge') {
                    if (isNaN(value) || value < 1 || value > 120) {
                        showError(fieldId, 'Please enter a valid age');
                        return false;
                    }
                }
                
                hideError(fieldId);
                return true;
            }
            
            function toggleTransferFields() {
                const passportType = passportTypeSelect.value;
                
                if (passportType === 'Transfer Passport') {
                    transferFields.classList.add('active');
                } else {
                    transferFields.classList.remove('active');
                }
            }
            
            function toggleFIRFields() {
                const passportType = passportTypeSelect.value;
                
                if (passportType === 'FIR Filing Passport') {
                    firFields.classList.add('active');
                } else {
                    firFields.classList.remove('active');
                }
            }
            
            function toggleViseraFields() {
                const passportType = passportTypeSelect.value;
                
                if (passportType === 'Visera Report') {
                    viseraFields.classList.add('active');
                } else {
                    viseraFields.classList.remove('active');
                }
            }
            
            function toggleLabReportFields() {
                const passportType = passportTypeSelect.value;
                
                if (passportType === 'Lab Report') {
                    labReportFields.classList.add('active');
                } else {
                    labReportFields.classList.remove('active');
                }
            }
            
            function toggleMMSection() {
                const passportType = passportTypeSelect.value;
                
                if (passportType === 'Lab Report') {
                    mmSection.classList.add('hidden');
                    document.getElementById('mm').removeAttribute('required');
                } else {
                    mmSection.classList.remove('hidden');
                    document.getElementById('mm').setAttribute('required', 'required');
                }
            }
            
            function toggleAccusedSection() {
                const passportType = passportTypeSelect.value;
                
                if (passportType === 'FIR Filing Passport' || passportType === 'Visera Report' || passportType === 'Lab Report') {
                    accusedSection.classList.add('hidden');
                } else {
                    accusedSection.classList.remove('hidden');
                }
            }
            
            function updateContentStatus() {
                const selectedType = passportTypeSelect.value;
                
                if (!selectedType) {
                    contentStatus.classList.add('hidden');
                    return;
                }
                
                const hasContent = availablePassportTypes[selectedType] || false;
                
                if (hasContent) {
                    contentStatus.className = 'content-status available';
                    contentStatusText.textContent = `✓ Content template available for ${selectedType}`;
                } else {
                    contentStatus.className = 'content-status unavailable';
                    contentStatusText.textContent = `⚠ No content template available for ${selectedType}`;
                }
                
                contentStatus.classList.remove('hidden');
            }
            
            function createPoliceOfficerForm(index) {
                const officerDiv = document.createElement('div');
                officerDiv.className = 'officer-container';
                officerDiv.id = `officer-${index}`;
                
                officerDiv.innerHTML = `
                    <h4>Police Officer ${index}</h4>
                    <div class="officer-details">
                        <div class="form-group">
                            <label for="designation${index}" class="required">Designation with Number</label>
                            <input type="text" id="designation${index}" placeholder="Enter designation with number (e.g., SI 1234, HC 5678)">
                            <div class="error-message" id="designation${index}-error">Please enter designation with number</div>
                            <div class="help-text">Enter designation followed by number (e.g., SI 1234, HC 5678, PC 8901)</div>
                        </div>
                    </div>
                    <div class="form-group">
                        <label for="fullName${index}" class="required">Full Name</label>
                        <input type="text" id="fullName${index}" placeholder="Enter full name">
                        <div class="error-message" id="fullName${index}-error">Please enter a full name</div>
                    </div>
                    ${index > 1 ? `<button type="button" class="remove-officer" data-index="${index}">Remove Officer</button>` : ''}
                `;
                
                return officerDiv;
            }
            
            function createAccusedForm(index) {
                const accusedDiv = document.createElement('div');
                accusedDiv.className = 'accused-container';
                accusedDiv.id = `accused-${index}`;
                
                accusedDiv.innerHTML = `
                    <h4>Accused Person ${index}</h4>
                    <div class="accused-details">
                        <div class="form-group">
                            <label for="accusedName${index}" class="required">Name</label>
                            <input type="text" id="accusedName${index}" placeholder="Enter accused name">
                            <div class="error-message" id="accusedName${index}-error">Please enter an accused name</div>
                        </div>
                        <div class="form-group">
                            <label for="age${index}" class="required">Age</label>
                            <input type="text" id="age${index}" placeholder="Enter age">
                            <div class="error-message" id="age${index}-error">Please enter a valid age</div>
                        </div>
                    </div>
                    <div class="form-group">
                        <label for="fatherName${index}" class="required">Father Name</label>
                        <input type="text" id="fatherName${index}" placeholder="Enter father's name">
                            <div class="error-message" id="fatherName${index}-error">Please enter a father name</div>
                    </div>
                    ${index > 1 ? `<button type="button" class="remove-accused" data-index="${index}">Remove Accused</button>` : ''}
                `;
                
                return accusedDiv;
            }
            
            function createPoliceOfficerDocumentField(index) {
                const officerContainer = document.createElement('div');
                officerContainer.className = 'officer-container-preview';
                officerContainer.id = `police-officer-${index}`;
                
                officerContainer.innerHTML = `
                    <div class="preview-field compact-field officer-designation empty" id="designation-field-${index}" placeholder="Designation with Number"></div>
                    <div class="preview-field compact-field officer-name empty" id="full-name-field-${index}" placeholder="Full Name"></div>
                `;
                
                return officerContainer;
            }
            
            function updatePoliceOfficers() {
                const count = parseInt(officerCountInput.value) || 1;
                
                if (count < 1) {
                    officerCountInput.value = 1;
                    return;
                }
                if (count > 10) {
                    officerCountInput.value = 10;
                    showNotification('Maximum 10 police officers allowed', 'error');
                    return;
                }
                
                policeOfficersContainer.innerHTML = '';
                for (let i = 1; i <= count; i++) {
                    policeOfficersContainer.appendChild(createPoliceOfficerForm(i));
                }
                officerCounter = count;
                
                policeOfficersList.innerHTML = '';
                for (let i = 1; i <= count; i++) {
                    policeOfficersList.appendChild(createPoliceOfficerDocumentField(i));
                }
                
                document.querySelectorAll('.remove-officer').forEach(button => {
                    button.addEventListener('click', function() {
                        const index = parseInt(this.getAttribute('data-index'));
                        removePoliceOfficer(index);
                    });
                });
            }
            
            function updateAccusedPersons() {
                const count = parseInt(accusedCountInput.value) || 1;
                
                if (count < 1) {
                    accusedCountInput.value = 1;
                    return;
                }
                if (count > 10) {
                    accusedCountInput.value = 10;
                    showNotification('Maximum 10 accused persons allowed', 'error');
                    return;
                }
                
                accusedPersonsContainer.innerHTML = '';
                for (let i = 1; i <= count; i++) {
                    accusedPersonsContainer.appendChild(createAccusedForm(i));
                }
                accusedCounter = count;
                
                document.querySelectorAll('.remove-accused').forEach(button => {
                    button.addEventListener('click', function() {
                        const index = parseInt(this.getAttribute('data-index'));
                        removeAccusedPerson(index);
                    });
                });
            }
            
            function addPoliceOfficer() {
                officerCounter++;
                officerCountInput.value = officerCounter;
                updatePoliceOfficers();
            }
            
            function addAccusedPerson() {
                accusedCounter++;
                accusedCountInput.value = accusedCounter;
                updateAccusedPersons();
            }
            
            function removePoliceOfficer(index) {
                if (officerCounter <= 1) {
                    showNotification('At least one police officer is required', 'error');
                    return;
                }
                
                officerCounter--;
                officerCountInput.value = officerCounter;
                updatePoliceOfficers();
            }
            
            function removeAccusedPerson(index) {
                if (accusedCounter <= 1) {
                    showNotification('At least one accused person is required', 'error');
                    return;
                }
                
                accusedCounter--;
                accusedCountInput.value = accusedCounter;
                updateAccusedPersons();
            }
            
            function validateForm() {
                let isValid = true;
                
                const mainFields = [
                    'passportType', 'policeStation', 'crimeNumber', 'section', 'date'
                ];
                
                if (passportTypeSelect.value !== 'Lab Report') {
                    mainFields.push('mm');
                }
                
                mainFields.forEach(fieldId => {
                    const field = document.getElementById(fieldId);
                    if (!validateField.call(field)) {
                        isValid = false;
                    }
                });
                
                // Validate time field (optional)
                const timeField = document.getElementById('time');
                if (!validateField.call(timeField)) {
                    isValid = false;
                }
                
                if (passportTypeSelect.value === 'Transfer Passport') {
                    const transferFields = ['fromStation', 'toStation', 'transferReason'];
                    transferFields.forEach(fieldId => {
                        const field = document.getElementById(fieldId);
                        if (!validateField.call(field)) {
                            isValid = false;
                        }
                    });
                }
                
                if (passportTypeSelect.value === 'FIR Filing Passport' && !firFields.classList.contains('hidden')) {
                    const firFieldsToValidate = ['complainantName', 'complainantAddress', 'incidentDate', 'incidentPlace'];
                    firFieldsToValidate.forEach(fieldId => {
                        const field = document.getElementById(fieldId);
                        if (field && !validateField.call(field)) {
                            isValid = false;
                        }
                    });
                    // Incident time is optional
                    const incidentTimeField = document.getElementById('incidentTime');
                    if (!validateField.call(incidentTimeField)) {
                        isValid = false;
                    }
                }
                
                if (passportTypeSelect.value === 'Visera Report') {
                    const viseraFields = ['deceasedName', 'deceasedAge', 'deceasedFatherName', 'pmNumber', 'pmDate'];
                    viseraFields.forEach(fieldId => {
                        const field = document.getElementById(fieldId);
                        if (!validateField.call(field)) {
                            isValid = false;
                        }
                    });
                }
                
                if (passportTypeSelect.value === 'Lab Report') {
                    const labReportFields = ['narNumber', 'narDate'];
                    labReportFields.forEach(fieldId => {
                        const field = document.getElementById(fieldId);
                        if (!validateField.call(field)) {
                            isValid = false;
                        }
                    });
                }
                
                for (let i = 1; i <= officerCounter; i++) {
                    const designationField = document.getElementById(`designation${i}`);
                    const fullNameField = document.getElementById(`fullName${i}`);
                    
                    if (!validateField.call(designationField) || !validateField.call(fullNameField)) {
                        isValid = false;
                    }
                }
                
                if (passportTypeSelect.value !== 'FIR Filing Passport' && passportTypeSelect.value !== 'Visera Report' && passportTypeSelect.value !== 'Lab Report') {
                    for (let i = 1; i <= accusedCounter; i++) {
                        const accusedNameField = document.getElementById(`accusedName${i}`);
                        const ageField = document.getElementById(`age${i}`);
                        const fatherNameField = document.getElementById(`fatherName${i}`);
                        
                        if (!validateField.call(accusedNameField) || !validateField.call(ageField) || !validateField.call(fatherNameField)) {
                            isValid = false;
                        }
                    }
                }
                
                return isValid;
            }
            
            function autoSave() {
                clearTimeout(autoSaveTimeout);
                
                autoSaveTimeout = setTimeout(() => {
                    const formData = {
                        passportType: document.getElementById('passportType').value,
                        policeStation: document.getElementById('policeStation').value,
                        crimeNumber: document.getElementById('crimeNumber').value,
                        section: document.getElementById('section').value,
                        mm: document.getElementById('mm').value,
                        date: document.getElementById('date').value,
                        time: document.getElementById('time').value,
                        officerCount: officerCounter,
                        accusedCount: accusedCounter,
                        language: currentLanguage
                    };
                    
                    localStorage.setItem('policePassportFormData', JSON.stringify(formData));
                    
                    autoSaveIndicator.style.display = 'block';
                    setTimeout(() => {
                        autoSaveIndicator.style.display = 'none';
                    }, 2000);
                }, 1000);
            }
            
            function loadSavedData() {
                const savedData = localStorage.getItem('policePassportFormData');
                
                if (savedData) {
                    const formData = JSON.parse(savedData);
                    
                    document.getElementById('passportType').value = formData.passportType || '';
                    document.getElementById('policeStation').value = formData.policeStation || '';
                    document.getElementById('crimeNumber').value = formData.crimeNumber || '';
                    document.getElementById('section').value = formData.section || '';
                    document.getElementById('mm').value = formData.mm || '';
                    document.getElementById('date').value = formData.date || '';
                    document.getElementById('time').value = formData.time || '';
                    
                    if (formData.officerCount) {
                        officerCountInput.value = formData.officerCount;
                        updatePoliceOfficers();
                    }
                    
                    if (formData.accusedCount) {
                        accusedCountInput.value = formData.accusedCount;
                        updateAccusedPersons();
                    }
                    
                    if (formData.language) {
                        currentLanguage = formData.language;
                        languageSelect.value = currentLanguage;
                        updateLanguageContent();
                    }
                    
                    updateContentVisibility();
                    toggleTransferFields();
                    toggleFIRFields();
                    toggleViseraFields();
                    toggleLabReportFields();
                    toggleMMSection();
                    toggleAccusedSection();
                    updateContentStatus();
                    
                    showNotification('Previous form data restored', 'success');
                }
            }
            
            function updateLanguageContent() {
                languageContents.forEach(content => {
                    content.classList.remove('active');
                });
                
                document.getElementById(`${currentLanguage}-content`).classList.add('active');
                
                updateContentVisibility();
            }
            
            function updateContentVisibility() {
                const passportType = passportTypeSelect.value;
                
                document.querySelectorAll('.content-text').forEach(el => {
                    el.style.display = 'none';
                });
                
                contentPlaceholder.style.display = 'block';
                
                if (!passportType) return;
                
                contentPlaceholder.style.display = 'none';
                
                if (currentLanguage === 'tamil') {
                    if (passportType === 'Escort') {
                        document.getElementById('escort-tamil-content').style.display = 'block';
                    } else if (passportType === 'PT warrant') {
                        document.getElementById('pt-warrant-tamil-content').style.display = 'block';
                    } else if (passportType === 'Sick Passport') {
                        document.getElementById('sick-passport-tamil-content').style.display = 'block';
                    } else if (passportType === 'Transfer Passport') {
                        document.getElementById('transfer-passport-tamil-content').style.display = 'block';
                    } else if (passportType === 'FIR Filing Passport') {
                        document.getElementById('fir-filing-tamil-content').style.display = 'block';
                    } else if (passportType === 'Visera Report') {
                        document.getElementById('visera-report-tamil-content').style.display = 'block';
                    } else if (passportType === 'Lab Report') {
                        document.getElementById('lab-report-tamil-content').style.display = 'block';
                    } else if (passportType === 'Formal Arrest') {
                        document.getElementById('formal-arrest-tamil-content').style.display = 'block';
                    }
                } else if (currentLanguage === 'english') {
                    if (passportType === 'Escort') {
                        document.getElementById('escort-english-content').style.display = 'block';
                    } else if (passportType === 'PT warrant') {
                        document.getElementById('pt-warrant-english-content').style.display = 'block';
                    } else if (passportType === 'Sick Passport') {
                        document.getElementById('sick-passport-english-content').style.display = 'block';
                    } else if (passportType === 'Transfer Passport') {
                        document.getElementById('transfer-passport-english-content').style.display = 'block';
                    } else if (passportType === 'FIR Filing Passport') {
                        document.getElementById('fir-filing-english-content').style.display = 'block';
                    } else if (passportType === 'Visera Report') {
                        document.getElementById('visera-report-english-content').style.display = 'block';
                    } else if (passportType === 'Lab Report') {
                        document.getElementById('lab-report-english-content').style.display = 'block';
                    } else if (passportType === 'Formal Arrest') {
                        document.getElementById('formal-arrest-english-content').style.display = 'block';
                    }
                }
            }
            
            function initializeApp() {
                updatePoliceOfficers();
                updateAccusedPersons();
                loadSavedData();
                updateContentStatus();
            }
            
            initializeApp();
            
            crimeNumberInput.addEventListener('input', function() {
                formatCrimeNumber(this);
                autoSave();
            });
            
            passportTypeSelect.addEventListener('change', function() {
                updateContentVisibility();
                toggleTransferFields();
                toggleFIRFields();
                toggleViseraFields();
                toggleLabReportFields();
                toggleMMSection();
                toggleAccusedSection();
                updateContentStatus();
                autoSave();
            });
            
            languageSelect.addEventListener('change', function() {
                currentLanguage = this.value;
                updateLanguageContent();
                updateContentStatus();
                autoSave();
            });
            
            officerCountInput.addEventListener('change', updatePoliceOfficers);
            officerCountInput.addEventListener('input', updatePoliceOfficers);
            
            accusedCountInput.addEventListener('change', updateAccusedPersons);
            accusedCountInput.addEventListener('input', updateAccusedPersons);
            
            addOfficerBtn.addEventListener('click', addPoliceOfficer);
            
            addAccusedBtn.addEventListener('click', addAccusedPerson);
            
            document.querySelectorAll('input, select').forEach(element => {
                if (element.id !== 'crimeNumber') {
                    element.addEventListener('input', function() {
                        autoSave();
                    });
                }
            });
            
            document.querySelectorAll('input[required], select[required]').forEach(field => {
                field.addEventListener('blur', validateField);
            });
            
            // Add validation for optional time fields
            document.getElementById('time').addEventListener('blur', validateField);
            document.getElementById('incidentTime').addEventListener('blur', validateField);
            
            fillFormBtn.addEventListener('click', function() {
                if (!validateForm()) {
                    showNotification('Please fix the errors in the form before generating the document', 'error');
                    return;
                }
                
                const selectedType = passportTypeSelect.value;
                if (!availablePassportTypes[selectedType]) {
                    showNotification(`No content template available for ${selectedType}. Please select a different passport type.`, 'error');
                    return;
                }
                
                const passportType = document.getElementById('passportType').value;
                const policeCount = parseInt(officerCountInput.value) || 1;
                const accusedCount = parseInt(accusedCountInput.value) || 1;
                const policeStation = document.getElementById('policeStation').value;
                const time = document.getElementById('time').value;
                const date = document.getElementById('date').value;
                const crimeNumber = document.getElementById('crimeNumber').value;
                const section = document.getElementById('section').value;
                const mm = document.getElementById('mm').value;
                
                const fromStation = document.getElementById('fromStation')?.value || '';
                const toStation = document.getElementById('toStation')?.value || '';
                const transferReason = document.getElementById('transferReason')?.value || '';
                
                const deceasedName = document.getElementById('deceasedName')?.value || '';
                const deceasedAge = document.getElementById('deceasedAge')?.value || '';
                const deceasedFatherName = document.getElementById('deceasedFatherName')?.value || '';
                const pmNumber = document.getElementById('pmNumber')?.value || '';
                const pmDate = document.getElementById('pmDate')?.value || '';
                
                const narNumber = document.getElementById('narNumber')?.value || '';
                const narDate = document.getElementById('narDate')?.value || '';
                
                const mmNumber = parseInt(mm);
                const mmWithSuffix = getOrdinalSuffix(mmNumber);
                
                for (let i = 1; i <= policeCount; i++) {
                    const designation = document.getElementById(`designation${i}`).value;
                    const fullName = document.getElementById(`fullName${i}`).value;
                    
                    const designationField = document.getElementById(`designation-field-${i}`);
                    const fullNameField = document.getElementById(`full-name-field-${i}`);
                    
                    designationField.textContent = designation;
                    designationField.classList.remove('empty');
                    
                    fullNameField.textContent = fullName;
                    fullNameField.classList.remove('empty');
                }
                
                document.getElementById('police-station-field').textContent = policeStation;
                document.getElementById('police-station-field').classList.remove('empty');
                
                // Handle time field - keep space vacant when time is not provided
                if (time && time.trim() !== '') {
                    document.getElementById('time-field').textContent = time;
                    document.getElementById('time-field').classList.remove('empty');
                    timeSuffix.style.display = 'inline';
                } else {
                    document.getElementById('time-field').textContent = '';
                    document.getElementById('time-field').classList.add('empty');
                    timeSuffix.style.display = 'none';
                }
                
                document.getElementById('date-field').textContent = date;
                document.getElementById('date-field').classList.remove('empty');
                
                let accusedListTamil = '';
                let accusedListEnglish = '';
                let accusedListPtTamil = '';
                let accusedListPtEnglish = '';
                let accusedListTransferTamil = '';
                let accusedListTransferEnglish = '';
                let accusedListFormalArrestTamil = '';
                let accusedListFormalArrestEnglish = '';
                
                if (passportType !== 'FIR Filing Passport' && passportType !== 'Visera Report' && passportType !== 'Lab Report') {
                    for (let i = 1; i <= accusedCount; i++) {
                        const accusedName = document.getElementById(`accusedName${i}`).value;
                        const age = document.getElementById(`age${i}`).value;
                        const fatherName = document.getElementById(`fatherName${i}`).value;
                        
                        if (currentLanguage === 'tamil') {
                            accusedListTamil += `${accusedName} ஆ/வ ${age} த/பெ ${fatherName}`;
                            accusedListPtTamil += `${accusedName}, பெ-வ ${age}, த/பெ ${fatherName}`;
                            accusedListTransferTamil += `${accusedName} ஆ/வ ${age} த/பெ ${fatherName}`;
                            accusedListFormalArrestTamil += `${accusedName} ஆ/வ ${age} த/பெ ${fatherName}`;
                            
                            if (i < accusedCount) {
                                accusedListTamil += ', ';
                                accusedListPtTamil += ', ';
                                accusedListTransferTamil += ', ';
                                accusedListFormalArrestTamil += ', ';
                            }
                        } else {
                            accusedListEnglish += `${accusedName} aged ${age} years, S/o ${fatherName}`;
                            accusedListPtEnglish += `${accusedName} aged ${age} years, S/o ${fatherName}`;
                            accusedListTransferEnglish += `${accusedName} aged ${age} years, S/o ${fatherName}`;
                            accusedListFormalArrestEnglish += `${accusedName} aged ${age} years, S/o ${fatherName}`;
                            
                            if (i < accusedCount) {
                                accusedListEnglish += ', ';
                                accusedListPtEnglish += ', ';
                                accusedListTransferEnglish += ', ';
                                accusedListFormalArrestEnglish += ', ';
                            }
                        }
                    }
                }
                
                if (currentLanguage === 'tamil') {
                    if (passportType === 'Escort' || passportType === 'PT warrant' || passportType === 'Transfer Passport' || passportType === 'FIR Filing Passport' || passportType === 'Visera Report' || passportType === 'Lab Report' || passportType === 'Formal Arrest') {
                        document.getElementById('police-station-content-tamil').textContent = policeStation;
                        document.getElementById('police-station-content-tamil').classList.remove('empty');
                        
                        document.getElementById('crime-no-field-tamil').textContent = crimeNumber;
                        document.getElementById('crime-no-field-tamil').classList.remove('empty');
                        
                        document.getElementById('section-field-tamil').textContent = section;
                        document.getElementById('section-field-tamil').classList.remove('empty');
                        
                        document.getElementById('accused-list-tamil').textContent = accusedListTamil;
                        
                        if (passportType !== 'Lab Report') {
                            document.getElementById('mm-field-tamil').textContent = mm;
                            document.getElementById('mm-field-tamil').classList.remove('empty');
                        }
                    }
                    if (passportType === 'PT warrant') {
                        document.getElementById('police-station-content-pt-tamil').textContent = policeStation;
                        document.getElementById('police-station-content-pt-tamil').classList.remove('empty');
                        
                        document.getElementById('crime-no-field-pt-tamil').textContent = crimeNumber;
                        document.getElementById('crime-no-field-pt-tamil').classList.remove('empty');
                        
                        document.getElementById('section-field-pt-tamil').textContent = section;
                        document.getElementById('section-field-pt-tamil').classList.remove('empty');
                        
                        document.getElementById('accused-list-pt-tamil').textContent = accusedListPtTamil;
                        
                        document.getElementById('mm-field-pt-tamil').textContent = mm;
                        document.getElementById('mm-field-pt-tamil').classList.remove('empty');
                        
                        document.getElementById('sc-no-field-tamil').textContent = '97/2023';
                        document.getElementById('sc-no-field-tamil').classList.remove('empty');
                        
                        document.getElementById('prc-no-field-tamil').textContent = '156/2021';
                        document.getElementById('prc-no-field-tamil').classList.remove('empty');
                        
                        document.getElementById('central-prison-field-tamil').textContent = 'மத்திய சிறை';
                        document.getElementById('central-prison-field-tamil').classList.remove('empty');
                    }
                    if (passportType === 'Transfer Passport') {
                    }
                    if (passportType === 'FIR Filing Passport') {
                        document.getElementById('police-station-content-fir-tamil').textContent = policeStation;
                        document.getElementById('police-station-content-fir-tamil').classList.remove('empty');
                        
                        document.getElementById('crime-no-field-fir-tamil').textContent = crimeNumber;
                        document.getElementById('crime-no-field-fir-tamil').classList.remove('empty');
                        
                        document.getElementById('section-field-fir-tamil').textContent = section;
                        document.getElementById('section-field-fir-tamil').classList.remove('empty');
                        
                        document.getElementById('accused-list-fir-tamil').textContent = '';
                        
                        document.getElementById('mm-field-fir-tamil').textContent = mm;
                        document.getElementById('mm-field-fir-tamil').classList.remove('empty');
                    }
                    if (passportType === 'Visera Report') {
                        document.getElementById('police-station-content-visera-tamil').textContent = policeStation;
                        document.getElementById('police-station-content-visera-tamil').classList.remove('empty');
                        
                        document.getElementById('crime-no-field-visera-tamil').textContent = crimeNumber;
                        document.getElementById('crime-no-field-visera-tamil').classList.remove('empty');
                        
                        document.getElementById('section-field-visera-tamil').textContent = section;
                        document.getElementById('section-field-visera-tamil').classList.remove('empty');
                        
                        document.getElementById('deceased-name-field-tamil').textContent = deceasedName;
                        document.getElementById('deceased-name-field-tamil').classList.remove('empty');
                        
                        document.getElementById('deceased-age-field-tamil').textContent = deceasedAge;
                        document.getElementById('deceased-age-field-tamil').classList.remove('empty');
                        
                        document.getElementById('deceased-father-name-field-tamil').textContent = deceasedFatherName;
                        document.getElementById('deceased-father-name-field-tamil').classList.remove('empty');
                        
                        document.getElementById('pm-number-field-tamil').textContent = pmNumber;
                        document.getElementById('pm-number-field-tamil').classList.remove('empty');
                        
                        document.getElementById('pm-date-field-tamil').textContent = pmDate;
                        document.getElementById('pm-date-field-tamil').classList.remove('empty');
                    }
                    if (passportType === 'Lab Report') {
                        document.getElementById('police-station-content-lab-tamil').textContent = policeStation;
                        document.getElementById('police-station-content-lab-tamil').classList.remove('empty');
                        
                        document.getElementById('crime-no-field-lab-tamil').textContent = crimeNumber;
                        document.getElementById('crime-no-field-lab-tamil').classList.remove('empty');
                        
                        document.getElementById('section-field-lab-tamil').textContent = section;
                        document.getElementById('section-field-lab-tamil').classList.remove('empty');
                        
                        document.getElementById('date-field-lab-tamil').textContent = date;
                        document.getElementById('date-field-lab-tamil').classList.remove('empty');
                        
                        document.getElementById('nar-no-field-tamil').textContent = narNumber;
                        document.getElementById('nar-no-field-tamil').classList.remove('empty');
                        
                        document.getElementById('nar-date-field-tamil').textContent = narDate;
                        document.getElementById('nar-date-field-tamil').classList.remove('empty');
                    }
                    if (passportType === 'Formal Arrest') {
                        document.getElementById('crime-no-field-formal-arrest-tamil').textContent = crimeNumber;
                        document.getElementById('crime-no-field-formal-arrest-tamil').classList.remove('empty');
                        
                        document.getElementById('section-field-formal-arrest-tamil').textContent = section;
                        document.getElementById('section-field-formal-arrest-tamil').classList.remove('empty');
                        
                        document.getElementById('accused-list-formal-arrest-tamil').textContent = accusedListFormalArrestTamil;
                    }
                } else if (currentLanguage === 'english') {
                    if (passportType === 'Escort' || passportType === 'PT warrant' || passportType === 'Transfer Passport' || passportType === 'FIR Filing Passport' || passportType === 'Visera Report' || passportType === 'Lab Report' || passportType === 'Formal Arrest') {
                        document.getElementById('police-station-content-english').textContent = policeStation;
                        document.getElementById('police-station-content-english').classList.remove('empty');
                        
                        document.getElementById('crime-no-field-english').textContent = crimeNumber;
                        document.getElementById('crime-no-field-english').classList.remove('empty');
                        
                        document.getElementById('section-field-english').textContent = section;
                        document.getElementById('section-field-english').classList.remove('empty');
                        
                        document.getElementById('accused-list-english').textContent = accusedListEnglish;
                        
                        if (passportType !== 'Lab Report') {
                            document.getElementById('mm-field-english').textContent = mmWithSuffix || mm;
                            document.getElementById('mm-field-english').classList.remove('empty');
                        }
                    }
                    if (passportType === 'PT warrant') {
                        document.getElementById('police-station-content-pt-english').textContent = policeStation;
                        document.getElementById('police-station-content-pt-english').classList.remove('empty');
                        
                        document.getElementById('crime-no-field-pt-english').textContent = crimeNumber;
                        document.getElementById('crime-no-field-pt-english').classList.remove('empty');
                        
                        document.getElementById('section-field-pt-english').textContent = section;
                        document.getElementById('section-field-pt-english').classList.remove('empty');
                        
                        document.getElementById('accused-list-pt-english').textContent = accusedListPtEnglish;
                        
                        document.getElementById('mm-field-pt-english').textContent = mmWithSuffix || mm;
                        document.getElementById('mm-field-pt-english').classList.remove('empty');
                        
                        document.getElementById('sc-no-field-english').textContent = '97/2023';
                        document.getElementById('sc-no-field-english').classList.remove('empty');
                        
                        document.getElementById('prc-no-field-english').textContent = '156/2021';
                        document.getElementById('prc-no-field-english').classList.remove('empty');
                    }
                    if (passportType === 'Transfer Passport') {
                    }
                    if (passportType === 'FIR Filing Passport') {
                        document.getElementById('police-station-content-fir-english').textContent = policeStation;
                        document.getElementById('police-station-content-fir-english').classList.remove('empty');
                        
                        document.getElementById('crime-no-field-fir-english').textContent = crimeNumber;
                        document.getElementById('crime-no-field-fir-english').classList.remove('empty');
                        
                        document.getElementById('section-field-fir-english').textContent = section;
                        document.getElementById('section-field-fir-english').classList.remove('empty');
                        
                        document.getElementById('accused-list-fir-english').textContent = '';
                        
                        document.getElementById('mm-field-fir-english').textContent = mmWithSuffix || mm;
                        document.getElementById('mm-field-fir-english').classList.remove('empty');
                    }
                    if (passportType === 'Visera Report') {
                        document.getElementById('police-station-content-visera-english').textContent = policeStation;
                        document.getElementById('police-station-content-visera-english').classList.remove('empty');
                        
                        document.getElementById('crime-no-field-visera-english').textContent = crimeNumber;
                        document.getElementById('crime-no-field-visera-english').classList.remove('empty');
                        
                        document.getElementById('section-field-visera-english').textContent = section;
                        document.getElementById('section-field-visera-english').classList.remove('empty');
                        
                        document.getElementById('deceased-name-field-english').textContent = deceasedName;
                        document.getElementById('deceased-name-field-english').classList.remove('empty');
                        
                        document.getElementById('deceased-age-field-english').textContent = deceasedAge;
                        document.getElementById('deceased-age-field-english').classList.remove('empty');
                        
                        document.getElementById('deceased-father-name-field-english').textContent = deceasedFatherName;
                        document.getElementById('deceased-father-name-field-english').classList.remove('empty');
                        
                        document.getElementById('pm-number-field-english').textContent = pmNumber;
                        document.getElementById('pm-number-field-english').classList.remove('empty');
                        
                        document.getElementById('pm-date-field-english').textContent = pmDate;
                        document.getElementById('pm-date-field-english').classList.remove('empty');
                    }
                    if (passportType === 'Lab Report') {
                        document.getElementById('police-station-content-lab-english').textContent = policeStation;
                        document.getElementById('police-station-content-lab-english').classList.remove('empty');
                        
                        document.getElementById('crime-no-field-lab-english').textContent = crimeNumber;
                        document.getElementById('crime-no-field-lab-english').classList.remove('empty');
                        
                        document.getElementById('section-field-lab-english').textContent = section;
                        document.getElementById('section-field-lab-english').classList.remove('empty');
                        
                        document.getElementById('date-field-lab-english').textContent = date;
                        document.getElementById('date-field-lab-english').classList.remove('empty');
                        
                        document.getElementById('nar-no-field-english').textContent = narNumber;
                        document.getElementById('nar-no-field-english').classList.remove('empty');
                        
                        document.getElementById('nar-date-field-english').textContent = narDate;
                        document.getElementById('nar-date-field-english').classList.remove('empty');
                    }
                    if (passportType === 'Formal Arrest') {
                        document.getElementById('crime-no-field-formal-arrest-english').textContent = crimeNumber;
                        document.getElementById('crime-no-field-formal-arrest-english').classList.remove('empty');
                        
                        document.getElementById('section-field-formal-arrest-english').textContent = section;
                        document.getElementById('section-field-formal-arrest-english').classList.remove('empty');
                        
                        document.getElementById('accused-list-formal-arrest-english').textContent = accusedListFormalArrestEnglish;
                    }
                }
                
                updateContentVisibility();
                
                showNotification('Document generated successfully!', 'success');
            });

            printBtn.addEventListener('click', function() {
                const printContent = document.getElementById('document-to-print').innerHTML;
                const originalContent = document.body.innerHTML;
                
                document.body.innerHTML = printContent;
                window.print();
                document.body.innerHTML = originalContent;
                
                window.location.reload();
            });

            generateBtn.addEventListener('click', function() {
                const firstDesignation = document.getElementById('designation-field-1').textContent;
                if (!firstDesignation || firstDesignation === 'Designation with Number') {
                    showNotification('Please generate the document first using the "Generate Document" button', 'error');
                    return;
                }
                
                generateBtn.disabled = true;
                generateBtn.innerHTML = '<span class="spinner"></span> Generating PDF...';
                
                const previewElement = document.getElementById('document-to-print');
                previewElement.classList.add('pdf-mode');
                
                // Remove the placeholder text completely for PDF generation
                const timeField = document.getElementById('time-field');
                if (timeField.classList.contains('empty')) {
                    // Store the original placeholder
                    const originalPlaceholder = timeField.getAttribute('placeholder');
                    timeField.setAttribute('data-original-placeholder', originalPlaceholder);
                    // Remove the placeholder attribute to prevent the ::before content from showing
                    timeField.removeAttribute('placeholder');
                    // Clear any text content
                    timeField.textContent = '';
                }
                
                const originalStyles = {
                    width: previewElement.style.width,
                    height: previewElement.style.height,
                    boxShadow: previewElement.style.boxShadow
                };
                
                previewElement.style.width = '595px';
                previewElement.style.height = '842px';
                previewElement.style.boxShadow = 'none';
                
                const allTextElements = previewElement.querySelectorAll('*');
                const originalColors = [];
                
                allTextElements.forEach((el, index) => {
                    originalColors[index] = {
                        color: el.style.color,
                        backgroundColor: el.style.backgroundColor
                    };
                    
                    el.style.color = '#000000';
                    el.style.backgroundColor = '#FFFFFF';
                });
                
                setTimeout(() => {
                    html2canvas(previewElement, {
                        scale: 2,
                        useCORS: true,
                        logging: false,
                        backgroundColor: '#FFFFFF',
                        width: 595,
                        height: 842,
                        onclone: function(clonedDoc) {
                            const clonedElement = clonedDoc.getElementById('document-to-print');
                            if (clonedElement) {
                                const clonedTextElements = clonedElement.querySelectorAll('*');
                                clonedTextElements.forEach(el => {
                                    el.style.color = '#000000';
                                    el.style.backgroundColor = '#FFFFFF';
                                });
                                
                                // Remove placeholder from cloned document too
                                const clonedTimeField = clonedDoc.getElementById('time-field');
                                if (clonedTimeField && clonedTimeField.classList.contains('empty')) {
                                    const originalPlaceholder = clonedTimeField.getAttribute('data-original-placeholder');
                                    if (!originalPlaceholder) {
                                        clonedTimeField.setAttribute('data-original-placeholder', clonedTimeField.getAttribute('placeholder'));
                                    }
                                    clonedTimeField.removeAttribute('placeholder');
                                    clonedTimeField.textContent = '';
                                }
                            }
                        }
                    }).then(canvas => {
                        const imgData = canvas.toDataURL('image/png');
                        const pdf = new jsPDF({
                            orientation: 'portrait',
                            unit: 'px',
                            format: 'a4'
                        });
                        
                        const pdfWidth = pdf.internal.pageSize.getWidth();
                        const pdfHeight = pdf.internal.pageSize.getHeight();
                        
                        pdf.addImage(imgData, 'PNG', 0, 0, pdfWidth, pdfHeight);
                        
                        const passportType = document.getElementById('passportType').value.replace(/\s+/g, '_');
                        const dateString = new Date().toISOString().split('T')[0];
                        const crimeNumber = document.getElementById('crimeNumber').value.replace(/\//g, '-');
                        
                        pdf.save(`Police_Passport_${passportType}_${crimeNumber}_${dateString}.pdf`);
                        
                    }).catch(error => {
                        console.error('PDF generation error:', error);
                        showNotification('Error generating PDF: ' + error.message, 'error');
                    }).finally(() => {
                        previewElement.style.width = originalStyles.width;
                        previewElement.style.height = originalStyles.height;
                        previewElement.style.boxShadow = originalStyles.boxShadow;
                        
                        allTextElements.forEach((el, index) => {
                            if (originalColors[index]) {
                                el.style.color = originalColors[index].color;
                                el.style.backgroundColor = originalColors[index].backgroundColor;
                            }
                        });
                        
                        // Restore the placeholder after PDF generation
                        if (timeField.classList.contains('empty')) {
                            const originalPlaceholder = timeField.getAttribute('data-original-placeholder');
                            if (originalPlaceholder) {
                                timeField.setAttribute('placeholder', originalPlaceholder);
                                timeField.removeAttribute('data-original-placeholder');
                            }
                        }
                        
                        previewElement.classList.remove('pdf-mode');
                        generateBtn.disabled = false;
                        generateBtn.innerHTML = '<i class="fas fa-file-pdf"></i> Generate PDF';
                        showNotification('PDF generated successfully!', 'success');
                    });
                }, 100);
            });
        });
    </script>
</body>
</html>
