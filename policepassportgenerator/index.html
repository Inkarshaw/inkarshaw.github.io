<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Police Passport Document Generator</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        :root {
            --primary-color: #1a365d;
            --secondary-color: #2d3748;
            --accent-color: #3182ce;
            --light-color: #f7fafc;
            --border-color: #e2e8f0;
            --success-color: #38a169;
            --danger-color: #e53e3e;
            --warning-color: #dd6b20;
            --card-shadow: 0 10px 30px rgba(0,0,0,0.1);
            --transition: all 0.3s ease;
        }
        
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            line-height: 1.6;
            color: #2d3748;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 0;
        }
        
        .modern-container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }
        
        header {
            background-color: white;
            color: var(--primary-color);
            padding: 25px 0;
            text-align: center;
            margin-bottom: 30px;
            border-radius: 12px;
            box-shadow: var(--card-shadow);
            position: relative;
            overflow: hidden;
        }
        
        header:before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 5px;
            background: linear-gradient(90deg, var(--accent-color), var(--success-color));
        }
        
        header h1 {
            font-size: 2.2rem;
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 15px;
        }
        
        header h1 i {
            color: var(--accent-color);
        }
        
        header p {
            font-size: 1.1rem;
            opacity: 0.8;
            max-width: 600px;
            margin: 0 auto;
        }
        
        .app-container {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 30px;
        }
        
        @media (max-width: 900px) {
            .app-container {
                grid-template-columns: 1fr;
            }
        }
        
        .card {
            background-color: white;
            border-radius: 12px;
            box-shadow: var(--card-shadow);
            padding: 25px;
            transition: var(--transition);
        }
        
        .card:hover {
            transform: translateY(-5px);
        }
        
        .section-title {
            font-size: 1.5rem;
            color: var(--primary-color);
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 2px solid var(--border-color);
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .section-title i {
            color: var(--accent-color);
        }
        
        .form-group {
            margin-bottom: 20px;
        }
        
        label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: var(--secondary-color);
        }
        
        input, select {
            width: 100%;
            padding: 12px 15px;
            border: 1px solid var(--border-color);
            border-radius: 6px;
            font-size: 1rem;
            transition: var(--transition);
        }
        
        input:focus, select:focus {
            outline: none;
            border-color: var(--accent-color);
            box-shadow: 0 0 0 3px rgba(49, 130, 206, 0.2);
        }
        
        .btn {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            padding: 12px 24px;
            background-color: var(--accent-color);
            color: white;
            border: none;
            border-radius: 6px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: var(--transition);
            text-align: center;
        }
        
        .btn:hover {
            background-color: #2c5aa0;
            transform: translateY(-2px);
        }
        
        .btn:active {
            transform: translateY(0);
        }
        
        .btn-block {
            display: block;
            width: 100%;
        }
        
        .btn-success {
            background-color: var(--success-color);
        }
        
        .btn-success:hover {
            background-color: #2f855a;
        }
        
        .btn-warning {
            background-color: var(--warning-color);
        }
        
        .btn-warning:hover {
            background-color: #c05621;
        }
        
        .btn-danger {
            background-color: var(--danger-color);
        }
        
        .btn-danger:hover {
            background-color: #c53030;
        }
        
        .officer-controls, .accused-controls {
            display: flex;
            gap: 10px;
            margin-bottom: 15px;
        }
        
        .officer-controls input, .accused-controls input {
            flex: 1;
        }
        
        .officer-container, .accused-container {
            position: relative;
            padding: 15px;
            border: 1px solid var(--border-color);
            border-radius: 6px;
            margin-bottom: 15px;
            background-color: #f8fafc;
            transition: var(--transition);
        }
        
        .officer-container:hover, .accused-container:hover {
            background-color: #f0f9ff;
        }
        
        .officer-container h4, .accused-container h4 {
            margin-top: 0;
            color: var(--primary-color);
        }
        
        .remove-officer, .remove-accused {
            position: absolute;
            top: 10px;
            right: 10px;
            background-color: var(--danger-color);
            color: white;
            border: none;
            border-radius: 4px;
            padding: 5px 10px;
            cursor: pointer;
            font-size: 0.8rem;
            transition: var(--transition);
        }
        
        .remove-officer:hover, .remove-accused:hover {
            background-color: #c53030;
        }
        
        .notification {
            padding: 12px 15px;
            margin: 15px 0;
            border-radius: 6px;
            text-align: center;
            display: none;
            animation: slideIn 0.5s ease;
        }
        
        @keyframes slideIn {
            from { transform: translateY(-20px); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }
        
        .notification.success {
            background-color: #c6f6d5;
            color: #22543d;
            border: 1px solid #9ae6b4;
        }
        
        .notification.error {
            background-color: #fed7d7;
            color: #742a2a;
            border: 1px solid #feb2b2;
        }
        
        .document-preview {
            border: 1px solid var(--border-color);
            border-radius: 6px;
            padding: 20px;
            background-color: white;
            min-height: 500px;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);
            /* A4 aspect ratio */
            width: 100%;
            max-width: 595px; /* A4 width in pixels at 72 DPI */
            height: 842px; /* A4 height in pixels at 72 DPI */
            overflow: hidden;
            transition: var(--transition);
        }
        
        .document-title {
            text-align: center;
            font-weight: bold;
            text-decoration: underline;
            margin-bottom: 20px;
            font-size: 1.5rem;
            color: var(--primary-color);
        }
        
        .document-table {
            width: 100%;
            border-collapse: collapse;
            border: 2px solid var(--primary-color);
            table-layout: fixed;
            margin-bottom: 20px;
        }
        
        .document-table td {
            border: 1px solid var(--primary-color);
            padding: 12px;
            vertical-align: top;
            word-wrap: break-word;
            overflow-wrap: break-word;
        }
        
        .document-table .left-column {
            width: 30%;
        }
        
        .document-table .middle-column {
            width: 20%;
            text-align: center;
        }
        
        .document-table .right-column {
            width: 50%;
        }
        
        .preview-field {
            width: 100%;
            padding: 5px;
            margin: 8px 0;
            min-height: 20px;
            background: transparent;
            color: #2d3748;
            box-sizing: border-box;
            font-size: 14px;
            word-wrap: break-word;
            overflow-wrap: break-word;
        }
        
        .preview-field.empty:before {
            content: attr(placeholder);
            color: #a0aec0;
        }
        
        .time-container {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 2px;
            margin: 8px 0;
        }
        
        .time-field {
            min-width: 80px;
            padding: 5px;
            min-height: 20px;
            background: transparent;
            color: #2d3748;
            box-sizing: border-box;
            font-size: 14px;
            text-align: center;
        }
        
        .time-field.empty:before {
            content: attr(placeholder);
            color: #a0aec0;
        }
        
        .time-suffix {
            color: #2d3748;
            white-space: nowrap;
            font-size: 14px;
            margin-left: 4px; /* Exactly one space */
        }
        
        .content-text {
            text-align: justify;
            line-height: 1.6;
            font-size: 14px;
            color: #2d3748;
            word-wrap: break-word;
            overflow-wrap: break-word;
        }
        
        .embedded-field {
            display: inline;
            min-width: 60px;
            padding: 0 2px;
            margin: 0;
            background: transparent;
            white-space: nowrap;
            color: #2d3748;
        }
        
        .embedded-field.empty:before {
            content: attr(placeholder);
            color: #a0aec0;
        }
        
        .action-buttons {
            display: flex;
            gap: 15px;
            margin-top: 20px;
        }
        
        .action-buttons .btn {
            flex: 1;
        }
        
        .hidden {
            display: none;
        }
        
        .language-selector {
            display: flex;
            align-items: center;
            margin-bottom: 20px;
            gap: 10px;
        }
        
        .language-selector label {
            margin-bottom: 0;
            font-weight: 600;
            white-space: nowrap;
        }
        
        .language-selector select {
            width: auto;
            min-width: 150px;
        }
        
        .language-content {
            display: none;
        }
        
        .language-content.active {
            display: block;
            animation: fadeIn 0.5s ease;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }
        
        .help-text {
            font-size: 0.85rem;
            color: #718096;
            margin-top: 5px;
        }
        
        .required:after {
            content: ' *';
            color: var(--danger-color);
        }
        
        .designation-select {
            width: 100%;
        }
        
        .officer-details {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
        }
        
        @media (max-width: 600px) {
            .officer-details {
                grid-template-columns: 1fr;
            }
        }
        
        .no-police-number .police-number-group {
            display: none;
        }
        
        .accused-details {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
        }
        
        @media (max-width: 600px) {
            .accused-details {
                grid-template-columns: 1fr;
            }
        }
        
        /* Remove underlines in generated document */
        .pdf-mode .preview-field,
        .pdf-mode .embedded-field,
        .pdf-mode .time-field {
            border-bottom: none !important;
        }
        
        /* Ensure content doesn't overflow table cells */
        .document-table td {
            overflow: hidden;
        }
        
        .compact-line {
            margin-bottom: 5px;
            line-height: 1.3;
        }
        
        .compact-field {
            margin: 3px 0;
            min-height: 18px;
        }
        
        .middle-column-content {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            height: 100%;
        }
        
        /* Police officer layout - designation and number on same line, name on next line */
        .officer-container-preview {
            margin-bottom: 10px;
        }
        
        .officer-top-line {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 2px;
        }
        
        .officer-designation {
            min-width: 80px;
            flex-shrink: 0;
        }
        
        .officer-number {
            min-width: 60px;
            flex-shrink: 0;
        }
        
        .officer-name {
            width: 100%;
            margin-top: 2px;
        }
        
        .hidden-field {
            display: none !important;
        }
        
        /* Form validation styles */
        .error-message {
            color: var(--danger-color);
            font-size: 0.85rem;
            margin-top: 5px;
            display: none;
        }
        
        .input-error {
            border-color: var(--danger-color);
            box-shadow: 0 0 0 3px rgba(229, 62, 62, 0.2);
        }
        
        .input-success {
            border-color: var(--success-color);
            box-shadow: 0 0 0 3px rgba(56, 161, 105, 0.2);
        }
        
        /* Transfer-specific fields */
        .transfer-fields {
            display: none;
            background-color: #f0f9ff;
            padding: 15px;
            border-radius: 6px;
            margin-top: 15px;
            border: 1px solid var(--border-color);
        }
        
        .transfer-fields.active {
            display: block;
            animation: slideDown 0.3s ease;
        }
        
        @keyframes slideDown {
            from { opacity: 0; max-height: 0; }
            to { opacity: 1; max-height: 500px; }
        }
        
        /* FIR-specific fields */
        .fir-fields {
            display: none;
            background-color: #fff5f5;
            padding: 15px;
            border-radius: 6px;
            margin-top: 15px;
            border: 1px solid var(--border-color);
        }
        
        .fir-fields.active {
            display: block;
            animation: slideDown 0.3s ease;
        }
        
        /* Visera report specific fields */
        .visera-fields {
            display: none;
            background-color: #f0f9ff;
            padding: 15px;
            border-radius: 6px;
            margin-top: 15px;
            border: 1px solid var(--border-color);
        }
        
        .visera-fields.active {
            display: block;
            animation: slideDown 0.3s ease;
        }
        
        /* Lab Report specific fields */
        .lab-report-fields {
            display: none;
            background-color: #f0f9ff;
            padding: 15px;
            border-radius: 6px;
            margin-top: 15px;
            border: 1px solid var(--border-color);
        }
        
        .lab-report-fields.active {
            display: block;
            animation: slideDown 0.3s ease;
        }
        
        /* A4 print styles */
        @media print {
            body * {
                visibility: hidden;
            }
            #document-to-print, #document-to-print * {
                visibility: visible;
            }
            #document-to-print {
                position: absolute;
                left: 0;
                top: 0;
                width: 100%;
                height: 100%;
            }
        }
        
        /* Loading spinner */
        .spinner {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid rgba(255,255,255,.3);
            border-radius: 50%;
            border-top-color: #fff;
            animation: spin 1s ease-in-out infinite;
            margin-right: 10px;
        }
        
        @keyframes spin {
            to { transform: rotate(360deg); }
        }
        
        /* Auto-save indicator */
        .auto-save {
            position: fixed;
            bottom: 20px;
            right: 20px;
            background: var(--success-color);
            color: white;
            padding: 10px 15px;
            border-radius: 4px;
            font-size: 0.9rem;
            box-shadow: 0 2px 5px rgba(0,0,0,0.2);
            display: none;
            z-index: 1000;
            animation: slideIn 0.5s ease;
        }
        
        /* Crime number format helper */
        .format-example {
            font-size: 0.8rem;
            color: #718096;
            margin-top: 5px;
            font-style: italic;
        }
        
        /* Content status indicator */
        .content-status {
            display: flex;
            align-items: center;
            gap: 8px;
            margin-top: 10px;
            padding: 8px 12px;
            border-radius: 6px;
            font-size: 0.9rem;
            font-weight: 500;
        }
        
        .content-status.available {
            background-color: #f0fff4;
            color: #22543d;
            border: 1px solid #9ae6b4;
        }
        
        .content-status.unavailable {
            background-color: #fff5f5;
            color: #742a2a;
            border: 1px solid #feb2b2;
        }
        
        .content-status-icon {
            width: 16px;
            height: 16px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.7rem;
            font-weight: bold;
        }
        
        .content-status.available .content-status-icon {
            background-color: #38a169;
            color: white;
        }
        
        .content-status.unavailable .content-status-icon {
            background-color: #e53e3e;
            color: white;
        }
        
        /* NEW STYLES FOR ENHANCED UX */
        
        /* Form completion indicator */
        .form-completion {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 15px;
            padding: 10px 15px;
            background-color: #f8fafc;
            border-radius: 6px;
            border: 1px solid var(--border-color);
        }
        
        .completion-percentage {
            font-weight: bold;
            color: var(--accent-color);
        }
        
        .completion-bar {
            flex-grow: 1;
            height: 6px;
            background-color: #e2e8f0;
            border-radius: 3px;
            margin: 0 10px;
            overflow: hidden;
        }
        
        .completion-fill {
            height: 100%;
            background-color: var(--accent-color);
            transition: width 0.3s ease;
        }
        
        /* Quick templates */
        .quick-templates {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }
        
        .template-btn {
            padding: 8px 12px;
            background-color: #f7fafc;
            border: 1px solid #e2e8f0;
            border-radius: 4px;
            cursor: pointer;
            font-size: 0.9rem;
            transition: all 0.2s;
            display: flex;
            align-items: center;
            gap: 5px;
        }
        
        .template-btn:hover {
            background-color: #edf2f7;
            border-color: var(--accent-color);
        }
        
        /* Enhanced document preview */
        .preview-container {
            position: relative;
        }
        
        .preview-actions {
            position: absolute;
            top: 10px;
            right: 10px;
            display: flex;
            gap: 5px;
            opacity: 0;
            transition: opacity 0.3s;
        }
        
        .preview-container:hover .preview-actions {
            opacity: 1;
        }
        
        .preview-action-btn {
            background: rgba(255, 255, 255, 0.9);
            border: 1px solid #e2e8f0;
            border-radius: 4px;
            padding: 4px 8px;
            font-size: 0.8rem;
            cursor: pointer;
        }
        
        /* Enhanced form sections */
        .form-section-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }
        
        .section-counter {
            background: var(--accent-color);
            color: white;
            padding: 4px 8px;
            border-radius: 12px;
            font-size: 0.8rem;
            font-weight: bold;
        }
        
        /* Field hints */
        .field-hint {
            font-size: 0.8rem;
            color: #718096;
            margin-top: 5px;
            display: flex;
            align-items: center;
            gap: 4px;
        }
        
        .field-hint::before {
            content: 'üí°';
        }
        
        /* Document status indicator */
        .document-status {
            padding: 10px;
            border-radius: 6px;
            margin-bottom: 15px;
            font-weight: 500;
        }
        
        .document-status.ready {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }
        
        .document-status.pending {
            background: #fff3cd;
            color: #856404;
            border: 1px solid #ffeaa7;
        }
        
        /* Enhanced loading states */
        .btn-loading {
            position: relative;
            color: transparent;
        }
        
        .btn-loading::after {
            content: '';
            position: absolute;
            width: 16px;
            height: 16px;
            top: 50%;
            left: 50%;
            margin-left: -8px;
            margin-top: -8px;
            border: 2px solid #ffffff;
            border-radius: 50%;
            border-right-color: transparent;
            animation: button-loading 1s linear infinite;
        }
        
        @keyframes button-loading {
            to {
                transform: rotate(360deg);
            }
        }
        
        /* Responsive improvements */
        @media (max-width: 768px) {
            .app-container {
                gap: 20px;
            }
            
            .card {
                padding: 15px;
            }
            
            .action-buttons {
                flex-direction: column;
            }
            
            .quick-templates {
                flex-direction: column;
            }
            
            .document-preview {
                transform: scale(0.8);
                transform-origin: top center;
            }
        }
        
        /* Conditional section visibility */
        .conditional-section {
            transition: all 0.3s ease;
        }
        
        .conditional-section.hidden {
            display: none;
        }
        
        /* Mobile-specific improvements */
        @media (max-width: 480px) {
            .modern-container {
                padding: 10px;
            }
            
            header h1 {
                font-size: 1.8rem;
            }
            
            .btn {
                padding: 16px;
                font-size: 1.1rem;
            }
            
            .officer-controls, .accused-controls {
                flex-direction: column;
            }
        }
        
        /* Accessibility improvements */
        .sr-only {
            position: absolute;
            width: 1px;
            height: 1px;
            padding: 0;
            margin: -1px;
            overflow: hidden;
            clip: rect(0, 0, 0, 0);
            white-space: nowrap;
            border: 0;
        }
        
        /* Focus styles for better accessibility */
        .btn:focus, input:focus, select:focus {
            outline: 2px solid var(--accent-color);
            outline-offset: 2px;
        }
        
        /* High contrast mode support */
        @media (prefers-contrast: high) {
            :root {
                --border-color: #000000;
            }
            
            .card {
                border: 2px solid #000000;
            }
        }
        
        /* Reduced motion support */
        @media (prefers-reduced-motion: reduce) {
            * {
                animation-duration: 0.01ms !important;
                animation-iteration-count: 1 !important;
                transition-duration: 0.01ms !important;
            }
        }
        
        /* NEW: Form validation improvements */
        .form-section {
            margin-bottom: 30px;
        }
        
        .form-section-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }
        
        .section-counter {
            background: var(--accent-color);
            color: white;
            padding: 4px 8px;
            border-radius: 12px;
            font-size: 0.8rem;
            font-weight: bold;
        }
        
        /* NEW: Enhanced date/time picker */
        .date-time-group {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
        }
        
        /* NEW: Enhanced officer and accused management */
        .dynamic-list-controls {
            display: flex;
            gap: 10px;
            margin-bottom: 15px;
        }
        
        .dynamic-list-controls input {
            max-width: 100px;
        }
        
        /* NEW: Enhanced preview styling */
        .preview-field, .embedded-field, .time-field {
            border-bottom: 1px dashed #cbd5e0;
        }
        
        .preview-field.empty, .embedded-field.empty, .time-field.empty {
            border-bottom: 1px dashed #a0aec0;
        }
        
        /* NEW: Enhanced mobile responsiveness */
        @media (max-width: 600px) {
            .date-time-group {
                grid-template-columns: 1fr;
            }
            
            .dynamic-list-controls {
                flex-direction: column;
            }
            
            .dynamic-list-controls input {
                max-width: 100%;
            }
        }
    </style>
</head>
<body>
    <div class="modern-container">
        <header>
            <h1><i class="fas fa-passport"></i> Police Passport Document Generator</h1>
            <p>Create professional police passport documents quickly and easily</p>
        </header>
        
        <div class="app-container">
            <div class="card">
                <div class="form-section-header">
                    <h2 class="section-title"><i class="fas fa-edit"></i> Document Information</h2>
                    <span class="section-counter" id="form-completion">0%</span>
                </div>
                
                <!-- Form completion indicator -->
                <div class="form-completion">
                    <span>Form Completion:</span>
                    <div class="completion-bar">
                        <div class="completion-fill" id="completion-fill" style="width: 0%"></div>
                    </div>
                    <span class="completion-percentage" id="completion-percentage">0%</span>
                </div>
                
                <!-- Quick templates -->
                <div class="quick-templates">
                    <button class="template-btn" data-template="escort"><i class="fas fa-user-shield"></i> Escort Template</button>
                    <button class="template-btn" data-template="transfer"><i class="fas fa-exchange-alt"></i> Transfer Template</button>
                    <button class="template-btn" data-template="fir"><i class="fas fa-file-alt"></i> FIR Template</button>
                    <button class="template-btn" data-template="visera"><i class="fas fa-flask"></i> Visera Template</button>
                    <button class="template-btn" data-template="lab"><i class="fas fa-file-medical"></i> Lab Report Template</button>
                    <button class="template-btn" data-template="formal-arrest"><i class="fas fa-handcuffs"></i> Formal Arrest Template</button>
                </div>
                
                <div class="form-section">
                    <div class="form-group">
                        <label for="passportType" class="required">Passport Type</label>
                        <select id="passportType">
                            <option value="">Select Passport Type</option>
                            <option value="Lab Report">Lab Report</option>
                            <option value="PT warrant">PT warrant</option>
                            <option value="Escort">Escort</option>
                            <option value="Visera Report">Visera Report</option>
                            <option value="Releaving Passport">Releaving Passport</option>
                            <option value="Property to lab">Property to lab</option>
                            <option value="Sick Passport">Sick Passport</option>
                            <option value="ML Passport">ML Passport</option>
                            <option value="Formal Arrest">Formal Arrest</option>
                            <option value="Transfer Passport">Transfer Passport</option>
                            <option value="FIR Filing Passport">FIR Filing Passport</option>
                        </select>
                        <div class="error-message" id="passportType-error">Please select a passport type</div>
                        
                        <!-- Content Status Indicator -->
                        <div class="content-status hidden" id="content-status">
                            <div class="content-status-icon">!</div>
                            <span id="content-status-text">Content status will appear here</span>
                        </div>
                    </div>
                    
                    <div class="language-selector">
                        <label for="language"><i class="fas fa-language"></i> Document Language:</label>
                        <select id="language">
                            <option value="tamil">Tamil</option>
                            <option value="english">English</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label for="policeStation" class="required">Police Station</label>
                        <input type="text" id="policeStation" placeholder="Enter police station name">
                        <div class="error-message" id="policeStation-error">Please enter a police station</div>
                        <div class="field-hint">This will be used in the document content</div>
                    </div>
                    
                    <div class="form-group">
                        <label for="crimeNumber" class="required">Crime Number</label>
                        <input type="text" id="crimeNumber" placeholder="Enter crime number (e.g., 123/2024)">
                        <div class="error-message" id="crimeNumber-error">Please enter a valid crime number in format: number/year (e.g., 123/2024)</div>
                        <div class="format-example">Format: number/year (e.g., 123/2024)</div>
                    </div>
                    
                    <div class="form-group">
                        <label for="section" class="required">Section</label>
                        <input type="text" id="section" placeholder="Enter section">
                        <div class="error-message" id="section-error">Please enter a section</div>
                        <div class="field-hint">Enter the relevant IPC section (e.g., 302, 420)</div>
                    </div>
                    
                    <!-- Transfer-specific fields -->
                    <div class="transfer-fields" id="transfer-fields">
                        <h3 class="section-title"><i class="fas fa-exchange-alt"></i> Transfer Details</h3>
                        <div class="form-group">
                            <label for="fromStation" class="required">From Station</label>
                            <input type="text" id="fromStation" placeholder="Enter from station">
                            <div class="error-message" id="fromStation-error">Please enter from station</div>
                        </div>
                        <div class="form-group">
                            <label for="toStation" class="required">To Station</label>
                            <input type="text" id="toStation" placeholder="Enter to station">
                            <div class="error-message" id="toStation-error">Please enter to station</div>
                        </div>
                        <div class="form-group">
                            <label for="transferReason" class="required">Transfer Reason</label>
                            <input type="text" id="transferReason" placeholder="Enter transfer reason">
                            <div class="error-message" id="transferReason-error">Please enter transfer reason</div>
                        </div>
                    </div>
                    
                    <!-- FIR-specific fields - Hidden for FIR Filing Passport -->
                    <div class="fir-fields conditional-section" id="fir-fields">
                        <h3 class="section-title"><i class="fas fa-file-alt"></i> FIR Details</h3>
                        <div class="form-group">
                            <label for="complainantName" class="required">Complainant Name</label>
                            <input type="text" id="complainantName" placeholder="Enter complainant name">
                            <div class="error-message" id="complainantName-error">Please enter complainant name</div>
                        </div>
                        <div class="form-group">
                            <label for="complainantAddress" class="required">Complainant Address</label>
                            <input type="text" id="complainantAddress" placeholder="Enter complainant address">
                            <div class="error-message" id="complainantAddress-error">Please enter complainant address</div>
                        </div>
                        <div class="form-group">
                            <label for="incidentDate" class="required">Incident Date</label>
                            <input type="text" id="incidentDate" placeholder="Enter incident date in DD/MM/YYYY format">
                            <div class="error-message" id="incidentDate-error">Please enter a valid incident date</div>
                        </div>
                        <div class="form-group">
                            <label for="incidentTime" class="required">Incident Time</label>
                            <input type="text" id="incidentTime" placeholder="Enter incident time in HH:MM format">
                            <div class="error-message" id="incidentTime-error">Please enter a valid incident time</div>
                        </div>
                        <div class="form-group">
                            <label for="incidentPlace" class="required">Incident Place</label>
                            <input type="text" id="incidentPlace" placeholder="Enter incident place">
                            <div class="error-message" id="incidentPlace-error">Please enter incident place</div>
                        </div>
                    </div>
                    
                    <!-- Visera Report specific fields -->
                    <div class="visera-fields" id="visera-fields">
                        <h3 class="section-title"><i class="fas fa-flask"></i> Visera Report Details</h3>
                        <div class="form-group">
                            <label for="deceasedName" class="required">Deceased Name</label>
                            <input type="text" id="deceasedName" placeholder="Enter deceased name">
                            <div class="error-message" id="deceasedName-error">Please enter deceased name</div>
                        </div>
                        <div class="form-group">
                            <label for="deceasedAge" class="required">Deceased Age</label>
                            <input type="text" id="deceasedAge" placeholder="Enter deceased age">
                            <div class="error-message" id="deceasedAge-error">Please enter deceased age</div>
                        </div>
                        <div class="form-group">
                            <label for="deceasedFatherName" class="required">Deceased Father Name</label>
                            <input type="text" id="deceasedFatherName" placeholder="Enter deceased father name">
                            <div class="error-message" id="deceasedFatherName-error">Please enter deceased father name</div>
                        </div>
                        <div class="form-group">
                            <label for="pmNumber" class="required">P.M. Number</label>
                            <input type="text" id="pmNumber" placeholder="Enter P.M. Number">
                            <div class="error-message" id="pmNumber-error">Please enter P.M. Number</div>
                        </div>
                        <div class="form-group">
                            <label for="pmDate" class="required">P.M. Date</label>
                            <input type="text" id="pmDate" placeholder="Enter P.M. date in DD/MM/YYYY format">
                            <div class="error-message" id="pmDate-error">Please enter a valid P.M. date</div>
                        </div>
                    </div>
                    
                    <!-- Lab Report specific fields -->
                    <div class="lab-report-fields" id="lab-report-fields">
                        <h3 class="section-title"><i class="fas fa-file-medical"></i> Lab Report Details</h3>
                        <div class="form-group">
                            <label for="narNumber" class="required">NAR Number</label>
                            <input type="text" id="narNumber" placeholder="Enter NAR Number">
                            <div class="error-message" id="narNumber-error">Please enter NAR Number</div>
                        </div>
                        <div class="form-group">
                            <label for="narDate" class="required">NAR Date</label>
                            <input type="text" id="narDate" placeholder="Enter NAR date in DD/MM/YYYY format">
                            <div class="error-message" id="narDate-error">Please enter a valid NAR date</div>
                        </div>
                    </div>
                    
                    <!-- Accused Persons Section - Hidden for FIR Filing Passport and Visera Report -->
                    <div class="conditional-section" id="accused-section">
                        <h3 class="section-title"><i class="fas fa-user"></i> Accused Persons</h3>
                        
                        <div class="form-group">
                            <div class="dynamic-list-controls">
                                <input type="number" id="accused-count" min="1" max="10" value="1" placeholder="Number of accused">
                                <button type="button" id="add-accused" class="btn"><i class="fas fa-plus"></i> Add Accused</button>
                            </div>
                            <div class="help-text">Enter the number of accused persons or use the button to add individually</div>
                        </div>
                        
                        <div id="accused-persons-container">
                            <!-- Accused persons will be dynamically added here -->
                        </div>
                    </div>
                    
                    <!-- MM Field - Hidden for Lab Report -->
                    <div class="form-group conditional-section" id="mm-section">
                        <label for="mm" class="required">MM</label>
                        <input type="text" id="mm" placeholder="Enter MM (e.g., 1, 2, 3)">
                        <div class="error-message" id="mm-error">Please enter a valid MM number</div>
                        <div class="help-text">Enter the Metropolitan Magistrate number</div>
                    </div>
                    
                    <div class="date-time-group">
                        <div class="form-group">
                            <label for="date" class="required">Date</label>
                            <input type="text" id="date" placeholder="Enter date in DD/MM/YYYY format">
                            <div class="error-message" id="date-error">Please enter a valid date in DD/MM/YYYY format</div>
                        </div>
                        
                        <div class="form-group">
                            <label for="time" class="required">Time</label>
                            <input type="text" id="time" placeholder="Enter time in HH:MM format">
                            <div class="error-message" id="time-error">Please enter a valid time in HH:MM format</div>
                        </div>
                    </div>
                </div>
                
                <div class="form-section">
                    <h3 class="section-title"><i class="fas fa-user-shield"></i> Police Officers</h3>
                    
                    <div class="form-group">
                        <div class="dynamic-list-controls">
                            <input type="number" id="officer-count" min="1" max="10" value="1" placeholder="Number of officers">
                            <button type="button" id="add-officer" class="btn"><i class="fas fa-plus"></i> Add Officer</button>
                        </div>
                        <div class="help-text">Enter the number of officers or use the button to add individually</div>
                    </div>
                    
                    <div id="police-officers-container">
                        <!-- Police officers will be dynamically added here -->
                    </div>
                </div>
                
                <!-- Document status indicator -->
                <div class="document-status pending" id="document-status">
                    <i class="fas fa-info-circle"></i> Fill all required fields to generate document
                </div>
                
                <div id="notification" class="notification"></div>
                
                <button id="fill-form" class="btn btn-success btn-block"><i class="fas fa-file-alt"></i> Generate Document</button>
            </div>
            
            <div class="card preview-section">
                <h2 class="section-title"><i class="fas fa-eye"></i> Document Preview</h2>
                
                <div class="preview-container">
                    <div class="preview-actions">
                        <button class="preview-action-btn" id="zoom-in"><i class="fas fa-search-plus"></i></button>
                        <button class="preview-action-btn" id="zoom-out"><i class="fas fa-search-minus"></i></button>
                        <button class="preview-action-btn" id="reset-zoom"><i class="fas fa-sync-alt"></i></button>
                    </div>
                    
                    <div class="document-preview" id="document-to-print">
                        <div class="document-title">
                            POLICE PASSPORT
                        </div>
                        
                        <table class="document-table">
                            <tr>
                                <td class="left-column">
                                    <div id="police-officers-list">
                                        <!-- Police officers will be dynamically added here -->
                                    </div>
                                    
                                    <!-- UPDATED: Added "Police Station" text after the police station name -->
                                    <div class="preview-field compact-field empty" id="police-station-field" placeholder="Police Station"></div>
                                    <div class="preview-field compact-field" id="police-station-label" style="display: none;">Police Station</div>
                                </td>
                                <td class="middle-column">
                                    <div class="middle-column-content">
                                        <div class="time-container">
                                            <div class="time-field empty" id="time-field" placeholder="Time (HH:MM)"></div>
                                            <span class="time-suffix">Hrs</span>
                                        </div>
                                        <div class="preview-field compact-field empty" id="date-field" placeholder="Date (DD/MM/YYYY)"></div>
                                    </div>
                                </td>
                                <td class="right-column">
                                    <div class="content-text" id="content-placeholder">
                                        Please fill out the form to generate the document content.
                                    </div>
                                    
                                    <!-- Content templates for different passport types and languages -->
                                    <div class="language-content active" id="tamil-content">
                                        <div class="content-text" id="escort-tamil-content" style="display: none;">
                                            <!-- UPDATED: Changed to Police Station -->
                                            ‡ÆÜ‡Æï‡Æø‡ÆØ ‡Æ®‡ØÄ‡Æµ‡Æø‡Æ∞‡Øç <span class="embedded-field empty" id="police-station-content-tamil" placeholder="Police Station"></span> ‡Æï‡Ææ‡Æµ‡Æ≤‡Øç ‡Æ®‡Æø‡Æ≤‡Øà‡ÆØ ‡Æï‡ØÅ‡Æ±‡Øç‡Æ± ‡Æé‡Æ£‡Øç. <span class="embedded-field empty" id="crime-no-field-tamil" placeholder="Cr. No."></span> U/s <span class="embedded-field empty" id="section-field-tamil" placeholder="Section"></span> ‡Æé‡Æ©‡Øç‡Æ± ‡Æµ‡Æ¥‡Æï‡Øç‡Æï‡Æø‡Æ≤‡Øç ‡Æö‡ÆÆ‡Øç‡ÆÆ‡Æ®‡Øç‡Æ§‡Æ™‡Øç‡Æ™‡Æü‡Øç‡Æü ‡Æé‡Æ§‡Æø‡Æ∞‡Æø <span id="accused-list-tamil"></span> ‡Æé‡Æ©‡Øç‡Æ™‡Æµ‡Æ∞‡Øà ‡Æï‡Æ©‡ÆÆ‡Øç <span class="embedded-field empty" id="mm-field-tamil" placeholder="MM"></span>-‡Æµ‡Æ§‡ØÅ ‡Æ™‡ØÜ‡Æ∞‡ØÅ‡Æ®‡Æï‡Æ∞ ‡Æï‡ØÅ‡Æ±‡Øç‡Æ±‡Æµ‡Æø‡ÆØ‡Æ≤‡Øç ‡Æ®‡Æü‡ØÅ‡Æµ‡Æ∞‡Øç ‡ÆÖ‡Æµ‡Æ∞‡Øç‡Æï‡Æ≥‡Æø‡Æü‡ÆÆ‡Øç ‡ÆÜ‡Æú‡Æ∞‡Øç‡Æ™‡Æü‡ØÅ‡Æ§‡Øç‡Æ§‡Æø ‡Æâ‡Æ§‡Øç‡Æ§‡Æ∞‡Æµ‡ØÅ‡Æ™‡Æü‡Æø ‡Æ®‡Æü‡Æ®‡Øç‡Æ§‡ØÅ ‡ÆÖ‡Æ§‡Øç‡Æ§‡Ææ‡Æü‡Øç‡Æö‡Æø ‡Æ™‡ØÜ‡Æ±‡Øç‡Æ±‡ØÅ ‡Æ®‡Æø‡Æ≤‡Øà‡ÆØ‡ÆÆ‡Øç ‡Æµ‡Æ∞‡Æµ‡ØÅ‡ÆÆ‡Øç.
                                        </div>
                                        
                                        <div class="content-text" id="pt-warrant-tamil-content" style="display: none;">
                                            <!-- UPDATED: Changed to Police Station -->
                                            ‡ÆÜ‡Æï‡Æø‡ÆØ ‡Æ®‡ØÄ‡Æµ‡Æø‡Æ∞‡Øç <span class="embedded-field empty" id="police-station-content-pt-tamil" placeholder="Police Station"></span> ‡Æï‡Ææ.‡Æ®‡Æø. ‡Æï‡ØÅ. ‡Æé‡Æ£‡Øç. <span class="embedded-field empty" id="crime-no-field-pt-tamil" placeholder="Cr. No."></span> U/s <span class="embedded-field empty" id="section-field-pt-tamil" placeholder="Section"></span> (‡Æ≥‡ØÅ‡Æä.‡Æ¥‡Øá. <span class="embedded-field empty" id="sc-no-field-tamil" placeholder="SC No."></span> P.N‡Æ¥‡ØÅ. <span class="embedded-field empty" id="prc-no-field-tamil" placeholder="PRC No."></span> ) ‡Æé‡Æ©‡Øç‡Æ± ‡Æµ‡Æ¥‡Æï‡Øç‡Æï‡Æø‡Æ≤‡Øç ‡Æö‡ÆÆ‡Øç‡ÆÆ‡Æ®‡Øç‡Æ§‡Æ™‡Øç‡Æ™‡Æü‡Øç‡Æü ‡Æé‡Æ§‡Æø‡Æ∞‡Æø <span id="accused-list-pt-tamil"></span> ‡Æé‡Æ©‡Øç‡Æ™‡Æµ‡Æ∞‡ØÅ‡Æï‡Øç‡Æï‡ØÅ ‡Æï‡Æ©‡ÆÆ‡Øç <span class="embedded-field empty" id="mm-field-pt-tamil" placeholder="MM"></span>-‡Æµ‡Æ§‡ØÅ ‡Æü‡ØÅ‡Æ§‡Æ≤‡Øç ‡ÆÖ‡ÆÆ‡Æ∞‡Øç‡Æµ‡ØÅ ‡Æ®‡ØÄ‡Æ§‡Æø‡ÆÆ‡Æ©‡Øç‡Æ± ‡Æ®‡ØÄ‡Æ§‡Æø‡Æ™‡Æ§‡Æø ‡ÆÖ‡Æµ‡Æ∞‡Øç‡Æï‡Æ≥‡Ææ‡Æ≤‡Øç ‡Æµ‡Æ¥‡Æô‡Øç‡Æï‡Æ™‡Øç‡Æ™‡Æü‡Øç‡Æü PT Warrant-‡Æê <span class="embedded-field empty" id="central-prison-field-tamil" placeholder="Central Prison"></span> ‡ÆÆ‡Æ§‡Øç‡Æ§‡Æø‡ÆØ ‡Æö‡Æø‡Æ±‡Øà ‡Æï‡Æ£‡Øç‡Æï‡Ææ‡Æ£‡Æø‡Æ™‡Øç‡Æ™‡Ææ‡Æ≥‡Æ∞‡Øç ‡Æö‡ØÜ‡Æ©‡Øç‡Æ©‡Øà ‡ÆÖ‡Æµ‡Æ∞‡Øç‡Æï‡Æ≥‡Æø‡Æü‡ÆÆ‡Øç ‡Æö‡Ææ‡Æ∞‡Øç‡Æµ‡ØÅ ‡Æö‡ØÜ‡ÆØ‡Øç‡Æ§‡ØÅ ‡ÆÖ‡Æ§‡Øç‡Æ§‡Ææ‡Æü‡Øç‡Æö‡Æø ‡Æ™‡ØÜ‡Æ±‡Øç‡Æ±‡ØÅ ‡Æ®‡Æø‡Æ≤‡Øà‡ÆØ‡ÆÆ‡Øç ‡Æµ‡Æ∞‡Æµ‡ØÅ‡ÆÆ‡Øç.
                                        </div>
                                        
                                        <div class="content-text" id="sick-passport-tamil-content" style="display: none;">
                                            ‡Æâ‡Æô‡Øç‡Æï‡Æ≥‡Øç ‡Æâ‡Æü‡Æ≤‡Øç‡Æ®‡Æø‡Æ≤‡Øà ‡Æö‡Æø‡Æï‡Æø‡Æö‡Øç‡Æö‡Øà‡Æï‡Øç‡Æï‡Ææ‡Æï ‡Æï‡Ææ‡Æµ‡Æ≤‡Øç ‡ÆÆ‡Æ∞‡ØÅ‡Æ§‡Øç‡Æ§‡ØÅ‡Æµ‡ÆÆ‡Æ©‡Øà‡ÆØ‡Æø‡Æ©‡Øç ‡ÆÆ‡Æ∞‡ØÅ‡Æ§‡Øç‡Æ§‡ØÅ‡Æµ ‡ÆÖ‡Æ§‡Æø‡Æï‡Ææ‡Æ∞‡Æø‡ÆØ‡Æø‡Æü‡ÆÆ‡Øç ‡ÆÜ‡Æú‡Æ∞‡Øç‡Æ™‡Æü‡ØÅ‡Æ§‡Øç‡Æ§‡Æø ‡ÆÖ‡Æô‡Øç‡Æï‡ØÄ‡Æï‡Ææ‡Æ∞‡ÆÆ‡Øç ‡Æ™‡ØÜ‡Æ±‡Øç‡Æ±‡ØÅ ‡Æ§‡Æø‡Æ∞‡ØÅ‡ÆÆ‡Øç‡Æ™‡Æµ‡ØÅ‡ÆÆ‡Øç. ‡Æâ‡Æô‡Øç‡Æï‡Æ≥‡Øç ‡Æö‡Æø‡Æï‡Æø‡Æö‡Øç‡Æö‡Øà I.P. ‡ÆÖ‡Æ≤‡Øç‡Æ≤‡Æ§‡ØÅ O.P. ‡Æá‡Æ≤‡Øç ‡Æá‡Æ∞‡ØÅ‡Æ®‡Øç‡Æ§‡Ææ‡Æ≤‡Øç ‡Æâ‡Æü‡Æ©‡Æü‡Æø‡ÆØ‡Ææ‡Æï ‡Æï‡Ææ‡Æµ‡Æ≤‡Øç ‡Æ®‡Æø‡Æ≤‡Øà‡ÆØ‡Æ§‡Øç‡Æ§‡Æø‡Æ±‡Øç‡Æï‡ØÅ ‡Æö‡ØÜ‡ÆØ‡Øç‡Æ§‡Æø‡ÆØ‡Øà‡Æ§‡Øç ‡Æ§‡ØÜ‡Æ∞‡Æø‡Æµ‡Æø‡Æï‡Øç‡Æï ‡Æµ‡Øá‡Æ£‡Øç‡Æü‡ØÅ‡ÆÆ‡Øç.
                                        </div>
                                        
                                        <!-- UPDATED: Transfer Passport Tamil content -->
                                        <div class="content-text" id="transfer-passport-tamil-content" style="display: none;">
                                            <!-- UPDATED: Changed to new transfer instruction -->
                                            ‡ÆÜ‡Æï‡Æø‡ÆØ ‡Æ®‡ØÄ‡Æµ‡Æø‡Æ∞‡Øç ‡Æï‡Æø‡Æ¥‡Æï‡Øç‡Æï‡ØÅ ‡ÆÆ‡Æ£‡Øç‡Æü‡Æ≤ ‡Æï‡Ææ‡Æµ‡Æ≤‡Øç ‡Æ§‡ØÅ‡Æ£‡Øà ‡ÆÜ‡ÆØ‡Øç‡Æµ‡Ææ‡Æ≥‡Æ∞‡Øç ‡ÆÖ‡Æµ‡Æ∞‡Øç‡Æï‡Æ≥‡Æø‡Æ©‡Øç RC.No.Estt/EZ/2389/82/2023 EZO.No.485/2023, ‡Æ§‡Øá‡Æ§‡Æø: 13.06.2023 ‡Æâ‡Æ§‡Øç‡Æ§‡Æ∞‡Æµ‡Æø‡Æ©‡Øç ‡Æ™‡Æü‡Æø G3 ‡Æï‡Æø‡Æ≤‡Øç‡Æ™auk L&O ‡Æï‡Ææ‡Æµ‡Æ≤‡Øç ‡Æ®‡Æø‡Æ≤‡Øà‡ÆØ ‡ÆÜ‡ÆØ‡Øç‡Æµ‡Ææ‡Æ≥‡Æ∞‡Øç ‡ÆÖ‡Æµ‡Æ∞‡Øç‡Æï‡Æ≥‡Æø‡Æü‡ÆÆ‡Øç ‡Æâ‡Æü‡Æ©‡Æü‡Æø‡ÆØ‡Ææ‡Æï ‡ÆÜ‡Æú‡Æ∞‡Øç‡Æ™‡Æü‡ØÅ‡Æ§‡Øç‡Æ§‡Æø ‡ÆÖ‡Æ§‡Øç‡Æ§‡Ææ‡Æü‡Øç‡Æö‡Æø ‡Æ™‡ØÜ‡Æ±‡Øç‡Æ±‡ØÅ ‡Æ®‡Æø‡Æ≤‡Øà‡ÆØ‡ÆÆ‡Øç ‡Æµ‡Æ∞‡Æµ‡ØÅ‡ÆÆ‡Øç.
                                        </div>
                                        
                                        <!-- UPDATED: FIR Filing Tamil content - removed FIR details and accused reference -->
                                        <div class="content-text" id="fir-filing-tamil-content" style="display: none;">
                                            <!-- UPDATED: Changed to Police Station -->
                                            ‡ÆÜ‡Æï‡Æø‡ÆØ ‡Æ®‡ØÄ‡Æµ‡Æø‡Æ∞‡Øç <span class="embedded-field empty" id="police-station-content-fir-tamil" placeholder="Police Station"></span> ‡Æï‡Ææ‡Æµ‡Æ≤‡Øç‡Æ®‡Æø‡Æ≤‡Øà‡ÆØ ‡Æï‡ØÅ‡Æ±‡Øç‡Æ± ‡Æé‡Æ£‡Øç. <span class="embedded-field empty" id="crime-no-field-fir-tamil" placeholder="Cr. No."></span> U/s <span class="embedded-field empty" id="section-field-fir-tamil" placeholder="Section"></span> ‡Æé‡Æ©‡Øç‡Æ± ‡Æµ‡Æ¥‡Æï‡Øç‡Æï‡Æø‡Æ©‡Øç ‡ÆÆ‡ØÅ‡Æ§‡Æ≤‡Øç ‡Æ§‡Æï‡Æµ‡Æ≤‡Øç ‡ÆÖ‡Æ±‡Æø‡Æï‡Øç‡Æï‡Øà‡ÆØ‡Øà ‡Æï‡Æ©‡ÆÆ‡Øç <span class="embedded-field empty" id="mm-field-fir-tamil" placeholder="MM"></span>‡Æµ‡Æ§‡ØÅ ‡Æ™‡ØÜ‡Æ∞‡ØÅ‡Æ®‡Æï‡Æ∞ ‡Æï‡ØÅ‡Æ±‡Øç‡Æ±‡Æµ‡Æø‡ÆØ‡Æ≤‡Øç ‡Æ®‡Æü‡ØÅ‡Æµ‡Æ∞‡Øç ‡Æ®‡ØÄ‡Æ§‡Æø‡ÆÆ‡Æ©‡Øç‡Æ±‡Æ§‡Øç‡Æ§‡Æø‡Æ≤‡Øç ‡Æ§‡Ææ‡Æï‡Øç‡Æï‡Æ≤‡Øç ‡Æö‡ØÜ‡ÆØ‡Øç‡Æ§‡ØÅ ‡ÆÖ‡Æ§‡Øç‡Æ§‡Ææ‡Æü‡Øç‡Æö‡Æø ‡Æ™‡ØÜ‡Æ±‡Øç‡Æ±‡ØÅ ‡Æ®‡Æø‡Æ≤‡Øà‡ÆØ‡ÆÆ‡Øç ‡Æµ‡Æ∞‡Æµ‡ØÅ‡ÆÆ‡Øç.
                                        </div>
                                        
                                        <div class="content-text" id="visera-report-tamil-content" style="display: none;">
                                            <!-- UPDATED: Changed to Police Station -->
                                            ‡ÆÜ‡Æï‡Æø‡ÆØ ‡Æ®‡ØÄ‡Æµ‡Æø‡Æ∞‡Øç ‡ÆÆ‡ÆØ‡Æø‡Æ≤‡Ææ‡Æ™‡Øç‡Æ™‡ØÇ‡Æ∞‡Æø‡Æ≤‡Øç ‡Æâ‡Æ≥‡Øç‡Æ≥  ‡Æ§‡Æü‡ÆØ‡Æµ‡Æø‡ÆØ‡Æ≤‡Øç ‡ÆÖ‡Æ±‡Æø‡Æµ‡Æø‡ÆØ‡Æ≤‡Øç ‡ÆÜ‡ÆØ‡Øç‡Æµ‡Æï‡Æ§‡Øç‡Æ§‡Æø‡Æ±‡Øç‡Æï‡ØÅ ‡Æö‡ØÜ‡Æ©‡Øç‡Æ±‡ØÅ <span class="embedded-field empty" id="police-station-content-visera-tamil" placeholder="Police Station"></span> ‡Æï‡Ææ‡Æµ‡Æ≤‡Øç ‡Æ®‡Æø‡Æ≤‡Øà‡ÆØ ‡Æï‡ØÅ‡Æ±‡Øç‡Æ± ‡Æé‡Æ£‡Øç. <span class="embedded-field empty" id="crime-no-field-visera-tamil" placeholder="Cr. No."></span> U/s <span class="embedded-field empty" id="section-field-visera-tamil" placeholder="Section"></span> ‡Æá‡Æ±‡Æ™‡Øç‡Æ™‡ØÅ <span class="embedded-field empty" id="deceased-name-field-tamil" placeholder="Deceased Name"></span> ‡ÆÜ/‡Æµ <span class="embedded-field empty" id="deceased-age-field-tamil" placeholder="Deceased Age"></span> ‡Æ§/‡Æ™‡ØÜ <span class="embedded-field empty" id="deceased-father-name-field-tamil" placeholder="Deceased Father Name"></span> P.M. ‡Æé‡Æ£‡Øç: <span class="embedded-field empty" id="pm-number-field-tamil" placeholder="P.M. Number"></span>, ‡Æ§‡Øá‡Æ§‡Æø <span class="embedded-field empty" id="pm-date-field-tamil" placeholder="P.M. Date"></span> ‡Æá‡Æ©‡Øç ‡Æµ‡Æø‡Æö‡Æ∞‡Ææ ‡ÆÖ‡Æ±‡Æø‡Æï‡Øç‡Æï‡Øà‡ÆØ‡Øà ‡Æ™‡ØÜ‡Æ±‡Øç‡Æ±‡ØÅ ‡ÆÖ‡Æ§‡Øç‡Æ§‡Ææ‡Æü‡Øç‡Æö‡Æø ‡Æ™‡ØÜ‡Æ±‡Øç‡Æ±‡ØÅ ‡Æ®‡Æø‡Æ≤‡Øà‡ÆØ‡ÆÆ‡Øç ‡Æµ‡Æ∞‡Æµ‡ØÅ‡ÆÆ‡Øç.
                                        </div>
                                        
                                        <!-- NEW: Lab Report Tamil content -->
                                        <div class="content-text" id="lab-report-tamil-content" style="display: none;">
                                            ‡ÆÜ‡Æï‡Æø‡ÆØ ‡Æ®‡ØÄ‡Æµ‡Æø‡Æ∞‡Øç ‡ÆÆ‡ÆØ‡Æø‡Æ≤‡Ææ‡Æ™‡Øç‡Æ™‡ØÇ‡Æ∞‡Æø‡Æ≤‡Øç ‡Æâ‡Æ≥‡Øç‡Æ≥ ‡Æ§‡Æü‡ÆØ‡Æµ‡Æø‡ÆØ‡Æ≤‡Øç ‡ÆÖ‡Æ±‡Æø‡Æµ‡Æø‡ÆØ‡Æ≤‡Øç ‡ÆÜ‡ÆØ‡Øç‡Æµ‡Æï‡Æ§‡Øç‡Æ§‡Æø‡Æ±‡Øç‡Æï‡ØÅ ‡Æö‡ØÜ‡Æ©‡Øç‡Æ±‡ØÅ <span class="embedded-field empty" id="police-station-content-lab-tamil" placeholder="Police Station"></span> ‡Æï‡Ææ‡Æµ‡Æ≤‡Øç ‡Æ®‡Æø‡Æ≤‡Øà‡ÆØ ‡Æï‡ØÅ‡Æ±‡Øç‡Æ± ‡Æé‡Æ£‡Øç: <span class="embedded-field empty" id="crime-no-field-lab-tamil" placeholder="Cr. No."></span> U/s <span class="embedded-field empty" id="section-field-lab-tamil" placeholder="Section"></span> ‡Æ§‡Øá‡Æ§‡Æø <span class="embedded-field empty" id="date-field-lab-tamil" placeholder="Date"></span> ‡Æá‡Æ©‡Øç ‡ÆÜ‡ÆØ‡Øç‡Æµ‡Æï ‡ÆÖ‡Æ±‡Æø‡Æï‡Øç‡Æï‡Øà‡ÆØ‡Øà ‡Æ™‡ØÜ‡Æ±‡Øç‡Æ±‡ØÅ ‡ÆÖ‡Æ§‡Øç‡Æ§‡Ææ‡Æü‡Øç‡Æö‡Æø ‡Æ™‡ØÜ‡Æ±‡Øç‡Æ±‡ØÅ ‡Æ®‡Æø‡Æ≤‡Øà‡ÆØ‡ÆÆ‡Øç ‡Æµ‡Æ∞‡Æµ‡ØÅ‡ÆÆ‡Øç. NAR ‡Æé‡Æ£‡Øç: <span class="embedded-field empty" id="nar-no-field-tamil" placeholder="NAR No."></span> ‡Æ§‡Øá‡Æ§‡Æø: <span class="embedded-field empty" id="nar-date-field-tamil" placeholder="NAR Date"></span>
                                        </div>
                                        
                                        <!-- NEW: Formal Arrest Tamil content -->
                                        <div class="content-text" id="formal-arrest-tamil-content" style="display: none;">
                                            ‡ÆÜ‡Æï‡Æø‡ÆØ ‡Æ®‡ØÄ‡Æµ‡Æø‡Æ∞‡Øç ‡Æö‡Øá‡Æ§‡Øç‡Æ§‡ØÅ‡Æ™‡Øç‡Æ™‡Æü‡Øç‡Æü‡ØÅ ‡Æï‡Ææ.‡Æ®‡Æø ‡Æï‡ØÅ.‡Æé‡Æ£‡Øç. <span class="embedded-field empty" id="crime-no-field-formal-arrest-tamil" placeholder="Cr. No."></span> U/s <span class="embedded-field empty" id="section-field-formal-arrest-tamil" placeholder="Section"></span> ‡Æé‡Æ©‡Øç‡Æ± ‡Æµ‡Æ¥‡Æï‡Øç‡Æï‡Æø‡Æ≤‡Øç ‡Æö‡ÆÆ‡Øç‡ÆÆ‡Æ®‡Øç‡Æ§‡Æ™‡Øç‡Æ™‡Æü‡Øç‡Æü ‡Æé‡Æ§‡Æø‡Æ∞‡Æø <span id="accused-list-formal-arrest-tamil"></span> ‡Æé‡Æ©‡Øç‡Æ™‡Æµ‡Æ∞‡ØÅ‡Æï‡Øç‡Æï‡ØÅ ‡Æö‡ÆÆ‡Øç‡Æ™‡Æø‡Æ∞‡Æ§‡Ææ‡ÆØ ‡Æï‡Øà‡Æ§‡ØÅ (Formal Arrest) ‡Æê ‡Æö‡Æø‡Æ±‡Øà ‡Æï‡Æ£‡Øç‡Æï‡Ææ‡Æ£‡Æø‡Æ™‡Øç‡Æ™‡Ææ‡Æ≥‡Æ∞‡Øç ‡Æ™‡Æú‡Æ∞‡Øç‡Æ≤‡Øç ‡ÆÆ‡Æ§‡Øç‡Æ§‡Æø‡ÆØ ‡Æö‡Æø‡Æ±‡Øà, ‡Æö‡ØÜ‡Æ©‡Øç‡Æ©‡Øà ‡ÆÖ‡Æµ‡Æ∞‡Øç‡Æï‡Æ≥‡Æø‡Æü‡ÆÆ‡Øç ‡Æö‡Ææ‡Æ∞‡Øç‡Æµ‡Øà ‡Æö‡ØÜ‡ÆØ‡Øç‡Æ§‡ØÅ ‡ÆÖ‡Æ§‡Øç‡Æ§‡Ææ‡Æü‡Øç‡Æö‡Æø ‡Æ™‡ØÜ‡Æ±‡Øç‡Æ±‡ØÅ ‡Æ®‡Æø‡Æ≤‡Øà‡ÆØ‡ÆÆ‡Øç ‡Æµ‡Æ∞‡Æµ‡ØÅ‡ÆÆ‡Øç.
                                        </div>
                                    </div>
                                    
                                    <div class="language-content" id="english-content">
                                        <div class="content-text" id="escort-english-content" style="display: none;">
                                            <!-- UPDATED: Changed to Police Station -->
                                            You are hereby directed to produce the accused <span id="accused-list-english"></span> involved in <span class="embedded-field empty" id="police-station-content-english" placeholder="Police Station"></span> Crime No. <span class="embedded-field empty" id="crime-no-field-english" placeholder="Cr. No."></span> U/s <span class="embedded-field empty" id="section-field-english" placeholder="Section"></span> before the <span class="embedded-field empty" id="mm-field-english" placeholder="MM"></span> Metropolitan Magistrate, obtain orders and return to the station with acknowledgement.
                                        </div>
                                        
                                        <div class="content-text" id="pt-warrant-english-content" style="display: none;">
                                            <!-- UPDATED: Changed to Police Station -->
                                            You are hereby directed to execute the PT Warrant issued by the Hon'ble <span class="embedded-field empty" id="mm-field-pt-english" placeholder="MM"></span> Metropolitan Magistrate to the accused <span id="accused-list-pt-english"></span> involved in <span class="embedded-field empty" id="police-station-content-pt-english" placeholder="Police Station"></span> Crime No. <span class="embedded-field empty" id="crime-no-field-pt-english" placeholder="Cr. No."></span> U/S <span class="embedded-field empty" id="section-field-pt-english" placeholder="Section"></span> NDPS Act (SC.NO.<span class="embedded-field empty" id="sc-no-field-english" placeholder="SC No."></span>, PRC.NO. <span class="embedded-field empty" id="prc-no-field-english" placeholder="PRC No."></span>) before the Central Prison Superintendent, Chennai and return to the station with acknowledgement.
                                        </div>
                                        
                                        <div class="content-text" id="sick-passport-english-content" style="display: none;">
                                            You are directed to report before Medical officer of Police Hospital for your illness treatment and get back with acknowledgment. If you are treated as I.P. or O.P. you must intimate the message to the police station at once without fail.
                                        </div>
                                        
                                        <!-- UPDATED: Transfer Passport English content -->
                                        <div class="content-text" id="transfer-passport-english-content" style="display: none;">
                                            <!-- UPDATED: Changed to new transfer instruction -->
                                            You are hereby instructed to report before the Inspector of Police G3 Kilpauk L&O PS as per the JCOP East Zone order RC.No.Estt/EZ/2389/82/2023 EZO.No.485/2023, Dt:13.06.2023 immediately and return to the station with acknowledgement.
                                        </div>
                                        
                                        <!-- UPDATED: FIR Filing English content - removed FIR details and accused reference -->
                                        <div class="content-text" id="fir-filing-english-content" style="display: none;">
                                            <!-- UPDATED: Changed to Police Station -->
                                            You are hereby directed to file the FIR in <span class="embedded-field empty" id="police-station-content-fir-english" placeholder="Police Station"></span> Crime No. <span class="embedded-field empty" id="crime-no-field-fir-english" placeholder="Cr. No."></span> U/s <span class="embedded-field empty" id="section-field-fir-english" placeholder="Section"></span> before the <span class="embedded-field empty" id="mm-field-fir-english" placeholder="MM"></span> Metropolitan Magistrate and return to the station with acknowledgement.
                                        </div>
                                        
                                        <div class="content-text" id="visera-report-english-content" style="display: none;">
                                            <!-- UPDATED: Changed to Police Station -->
                                            You are directed to report forensic science lab at Mylapore and obtain the Visra Report of <span class="embedded-field empty" id="police-station-content-visera-english" placeholder="Police Station"></span> Cr.No. <span class="embedded-field empty" id="crime-no-field-visera-english" placeholder="Cr. No."></span> U/s <span class="embedded-field empty" id="section-field-visera-english" placeholder="Section"></span> deceased <span class="embedded-field empty" id="deceased-name-field-english" placeholder="Deceased Name"></span> M/a <span class="embedded-field empty" id="deceased-age-field-english" placeholder="Deceased Age"></span>, S/o <span class="embedded-field empty" id="deceased-father-name-field-english" placeholder="Deceased Father Name"></span>, P.M. No: <span class="embedded-field empty" id="pm-number-field-english" placeholder="P.M. Number"></span>, dated <span class="embedded-field empty" id="pm-date-field-english" placeholder="P.M. Date"></span> and get back with acknowledgment.
                                        </div>
                                        
                                        <!-- NEW: Lab Report English content -->
                                        <div class="content-text" id="lab-report-english-content" style="display: none;">
                                            You are directed to report forensic science at Mylapore and collect the lab report in <span class="embedded-field empty" id="police-station-content-lab-english" placeholder="Police Station"></span> PS Cr.No: <span class="embedded-field empty" id="crime-no-field-lab-english" placeholder="Cr. No."></span> U/s <span class="embedded-field empty" id="section-field-lab-english" placeholder="Section"></span> dated <span class="embedded-field empty" id="date-field-lab-english" placeholder="Date"></span> and return back. NAR No. <span class="embedded-field empty" id="nar-no-field-english" placeholder="NAR No."></span> Dt. <span class="embedded-field empty" id="nar-date-field-english" placeholder="NAR Date"></span>
                                        </div>
                                        
                                        <!-- NEW: Formal Arrest English content -->
                                        <div class="content-text" id="formal-arrest-english-content" style="display: none;">
                                            You are hereby directed to produce the accused <span id="accused-list-formal-arrest-english"></span> involved in Crime No. <span class="embedded-field empty" id="crime-no-field-formal-arrest-english" placeholder="Cr. No."></span> U/s <span class="embedded-field empty" id="section-field-formal-arrest-english" placeholder="Section"></span> for Formal Arrest before the Central Prison Superintendent, Puzhal Central Prison, Chennai and return to the station with acknowledgement.
                                        </div>
                                    </div>
                                </td>
                            </tr>
                        </table>
                    </div>
                </div>
                
                <div class="action-buttons">
                    <button id="print-document" class="btn btn-warning"><i class="fas fa-print"></i> Print Document</button>
                    <button id="generate-pdf" class="btn btn-success"><i class="fas fa-file-pdf"></i> Generate PDF</button>
                </div>
            </div>
        </div>
    </div>

    <div class="auto-save" id="auto-save-indicator"><i class="fas fa-check-circle"></i> Auto-saved</div>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const { jsPDF } = window.jspdf;
            const generateBtn = document.getElementById('generate-pdf');
            const printBtn = document.getElementById('print-document');
            const fillFormBtn = document.getElementById('fill-form');
            const passportTypeSelect = document.getElementById('passportType');
            const languageSelect = document.getElementById('language');
            const crimeNumberInput = document.getElementById('crimeNumber');
            const policeStationInput = document.getElementById('policeStation');
            const notification = document.getElementById('notification');
            const officerCountInput = document.getElementById('officer-count');
            const addOfficerBtn = document.getElementById('add-officer');
            const accusedCountInput = document.getElementById('accused-count');
            const addAccusedBtn = document.getElementById('add-accused');
            const policeOfficersContainer = document.getElementById('police-officers-container');
            const accusedPersonsContainer = document.getElementById('accused-persons-container');
            const policeOfficersList = document.getElementById('police-officers-list');
            const languageContents = document.querySelectorAll('.language-content');
            const contentPlaceholder = document.getElementById('content-placeholder');
            const autoSaveIndicator = document.getElementById('auto-save-indicator');
            const contentStatus = document.getElementById('content-status');
            const contentStatusText = document.getElementById('content-status-text');
            const accusedSection = document.getElementById('accused-section');
            const mmSection = document.getElementById('mm-section');
            const transferFields = document.getElementById('transfer-fields');
            const firFields = document.getElementById('fir-fields');
            const viseraFields = document.getElementById('visera-fields');
            const labReportFields = document.getElementById('lab-report-fields');
            
            // NEW VARIABLES FOR ENHANCED FEATURES
            const templateBtns = document.querySelectorAll('.template-btn');
            const completionPercentage = document.getElementById('completion-percentage');
            const completionFill = document.getElementById('completion-fill');
            const documentStatus = document.getElementById('document-status');
            const zoomInBtn = document.getElementById('zoom-in');
            const zoomOutBtn = document.getElementById('zoom-out');
            const resetZoomBtn = document.getElementById('reset-zoom');
            const policeStationLabel = document.getElementById('police-station-label');
            
            let officerCounter = 1;
            let accusedCounter = 1;
            let currentLanguage = 'tamil';
            let autoSaveTimeout;
            let formData = {};
            let zoomLevel = 1;
            
            // Define which passport types have content available
            const availablePassportTypes = {
                'Lab Report': true,
                'PT warrant': true,
                'Escort': true,
                'Visera Report': true,
                'Releaving Passport': false,
                'Property to lab': false,
                'Sick Passport': true,
                'ML Passport': false,
                'Formal Arrest': true,
                'Transfer Passport': true,
                'FIR Filing Passport': true
            };
            
            // NEW: Template presets
            const templatePresets = {
                'escort': {
                    passportType: 'Escort',
                    policeStation: 'Police Station',
                    crimeNumber: '123/2024',
                    section: '302 IPC',
                    mm: '1',
                    date: '15/12/2024',
                    time: '10:30'
                },
                'transfer': {
                    passportType: 'Transfer Passport',
                    policeStation: 'Police Station',
                    crimeNumber: '456/2024',
                    section: '420 IPC',
                    mm: '2',
                    date: '15/12/2024',
                    time: '11:00',
                    fromStation: 'Police Station',
                    toStation: 'Central Prison',
                    transferReason: 'Judicial Custody'
                },
                'fir': {
                    passportType: 'FIR Filing Passport',
                    policeStation: 'Police Station',
                    crimeNumber: '789/2024',
                    section: '379 IPC',
                    mm: '3',
                    date: '15/12/2024',
                    time: '09:45'
                },
                'visera': {
                    passportType: 'Visera Report',
                    policeStation: 'Police Station',
                    crimeNumber: '101/2024',
                    section: '174 CrPC',
                    mm: '4',
                    date: '15/12/2024',
                    time: '14:00',
                    deceasedName: 'Suresh Kumar',
                    deceasedAge: '45',
                    deceasedFatherName: 'Raj Kumar',
                    pmNumber: 'PM-123',
                    pmDate: '14/12/2024'
                },
                'lab': {
                    passportType: 'Lab Report',
                    policeStation: 'Police Station',
                    crimeNumber: '202/2024',
                    section: '302 IPC',
                    date: '15/12/2024',
                    time: '16:00',
                    narNumber: 'NAR-456',
                    narDate: '14/12/2024'
                },
                'formal-arrest': {
                    passportType: 'Formal Arrest',
                    policeStation: 'Police Station',
                    crimeNumber: '303/2024',
                    section: '302 IPC',
                    date: '15/12/2024',
                    time: '14:30'
                }
            };
            
            // Function to show notification
            function showNotification(message, type) {
                notification.textContent = message;
                notification.className = 'notification ' + type;
                notification.style.display = 'block';
                
                setTimeout(() => {
                    notification.style.display = 'none';
                }, 5000);
            }
            
            // Function to validate crime number format (number/year)
            function isValidCrimeNumber(crimeNumber) {
                const regex = /^\d+\/\d{4}$/;
                return regex.test(crimeNumber);
            }
            
            // Function to auto-format crime number as user types
            function formatCrimeNumber(input) {
                let value = input.value.replace(/[^\d\/]/g, '');
                
                // Remove extra slashes
                const parts = value.split('/');
                if (parts.length > 2) {
                    value = parts[0] + '/' + parts.slice(1).join('');
                }
                
                // Auto-add slash if user types 4+ digits without slash
                if (value.length >= 4 && !value.includes('/')) {
                    value = value.substring(0, value.length - 4) + '/' + value.substring(value.length - 4);
                }
                
                input.value = value;
            }
            
            // Function to get ordinal suffix
            function getOrdinalSuffix(num) {
                if (!num || isNaN(num)) return '';
                
                const j = num % 10;
                const k = num % 100;
                
                if (j === 1 && k !== 11) {
                    return num + "st";
                }
                if (j === 2 && k !== 12) {
                    return num + "nd";
                }
                if (j === 3 && k !== 13) {
                    return num + "rd";
                }
                return num + "th";
            }
            
            // Function to validate date format
            function isValidDate(dateString) {
                const regex = /^(\d{1,2})\/(\d{1,2})\/(\d{4})$/;
                if (!regex.test(dateString)) return false;
                
                const parts = dateString.split('/');
                const day = parseInt(parts[0], 10);
                const month = parseInt(parts[1], 10);
                const year = parseInt(parts[2], 10);
                
                if (year < 1000 || year > 3000 || month === 0 || month > 12) return false;
                
                const monthLength = [31, 28, 31, 30, 31, 30, 31, 31, 30, 31, 30, 31];
                
                // Adjust for leap years
                if (year % 400 === 0 || (year % 100 !== 0 && year % 4 === 0)) {
                    monthLength[1] = 29;
                }
                
                return day > 0 && day <= monthLength[month - 1];
            }
            
            // Function to validate time format
            function isValidTime(timeString) {
                const regex = /^([0-1]?[0-9]|2[0-3]):[0-5][0-9]$/;
                return regex.test(timeString);
            }
            
            // Function to show/hide error message
            function showError(inputId, message) {
                const input = document.getElementById(inputId);
                const errorElement = document.getElementById(`${inputId}-error`);
                
                input.classList.add('input-error');
                input.classList.remove('input-success');
                errorElement.textContent = message;
                errorElement.style.display = 'block';
            }
            
            function hideError(inputId) {
                const input = document.getElementById(inputId);
                const errorElement = document.getElementById(`${inputId}-error`);
                
                input.classList.remove('input-error');
                input.classList.add('input-success');
                errorElement.style.display = 'none';
            }
            
            // Function to validate a field
            function validateField() {
                const fieldId = this.id;
                const value = this.value.trim();
                
                if (!value) {
                    showError(fieldId, 'This field is required');
                    return false;
                }
                
                // Special validation for specific fields
                if (fieldId === 'crimeNumber') {
                    if (!isValidCrimeNumber(value)) {
                        showError(fieldId, 'Please enter a valid crime number in format: number/year (e.g., 123/2024)');
                        return false;
                    }
                }
                
                if (fieldId === 'date' || fieldId === 'incidentDate' || fieldId === 'pmDate' || fieldId === 'narDate') {
                    if (!isValidDate(value)) {
                        showError(fieldId, 'Please enter a valid date in DD/MM/YYYY format');
                        return false;
                    }
                }
                
                if (fieldId === 'time' || fieldId === 'incidentTime') {
                    if (!isValidTime(value)) {
                        showError(fieldId, 'Please enter a valid time in HH:MM format');
                        return false;
                    }
                }
                
                if (fieldId === 'mm') {
                    if (isNaN(value) || value < 1) {
                        showError(fieldId, 'Please enter a valid MM number');
                        return false;
                    }
                }
                
                if (fieldId.includes('age') || fieldId === 'deceasedAge') {
                    if (isNaN(value) || value < 1 || value > 120) {
                        showError(fieldId, 'Please enter a valid age');
                        return false;
                    }
                }
                
                hideError(fieldId);
                return true;
            }
            
            // Function to toggle transfer fields based on passport type
            function toggleTransferFields() {
                const passportType = passportTypeSelect.value;
                
                if (passportType === 'Transfer Passport') {
                    transferFields.classList.add('active');
                } else {
                    transferFields.classList.remove('active');
                }
            }
            
            // Function to toggle FIR fields based on passport type
            function toggleFIRFields() {
                const passportType = passportTypeSelect.value;
                
                if (passportType === 'FIR Filing Passport') {
                    firFields.classList.add('hidden');
                } else {
                    firFields.classList.remove('hidden');
                }
            }
            
            // Function to toggle Visera fields based on passport type
            function toggleViseraFields() {
                const passportType = passportTypeSelect.value;
                
                if (passportType === 'Visera Report') {
                    viseraFields.classList.add('active');
                } else {
                    viseraFields.classList.remove('active');
                }
            }
            
            // Function to toggle Lab Report fields based on passport type
            function toggleLabReportFields() {
                const passportType = passportTypeSelect.value;
                
                if (passportType === 'Lab Report') {
                    labReportFields.classList.add('active');
                } else {
                    labReportFields.classList.remove('active');
                }
            }
            
            // NEW: Function to toggle MM section based on passport type
            function toggleMMSection() {
                const passportType = passportTypeSelect.value;
                
                // Hide MM section for Lab Report
                if (passportType === 'Lab Report') {
                    mmSection.classList.add('hidden');
                    document.getElementById('mm').removeAttribute('required');
                } else {
                    mmSection.classList.remove('hidden');
                    document.getElementById('mm').setAttribute('required', 'required');
                }
            }
            
            // NEW: Function to toggle accused section based on passport type
            function toggleAccusedSection() {
                const passportType = passportTypeSelect.value;
                
                // Hide accused section for FIR Filing Passport, Visera Report, and Lab Report
                if (passportType === 'FIR Filing Passport' || passportType === 'Visera Report' || passportType === 'Lab Report') {
                    accusedSection.classList.add('hidden');
                } else {
                    accusedSection.classList.remove('hidden');
                }
            }
            
            // Function to update content status indicator
            function updateContentStatus() {
                const selectedType = passportTypeSelect.value;
                
                if (!selectedType) {
                    contentStatus.classList.add('hidden');
                    return;
                }
                
                const hasContent = availablePassportTypes[selectedType] || false;
                
                if (hasContent) {
                    contentStatus.className = 'content-status available';
                    contentStatusText.textContent = `‚úì Content template available for ${selectedType}`;
                } else {
                    contentStatus.className = 'content-status unavailable';
                    contentStatusText.textContent = `‚ö† No content template available for ${selectedType}`;
                }
                
                contentStatus.classList.remove('hidden');
            }
            
            // Function to toggle police number field based on designation
            function togglePoliceNumberField(designationSelect) {
                const officerContainer = designationSelect.closest('.officer-container');
                const policeNumberGroup = officerContainer.querySelector('.police-number-group');
                const policeNumberInput = officerContainer.querySelector('input[type="text"]');
                
                // SI and SSI don't need police numbers
                if (designationSelect.value === 'SI' || designationSelect.value === 'SSI') {
                    policeNumberGroup.style.display = 'none';
                    policeNumberInput.removeAttribute('required');
                    policeNumberInput.value = ''; // Clear the value
                } else {
                    policeNumberGroup.style.display = 'block';
                    policeNumberInput.setAttribute('required', 'required');
                }
            }
            
            // Function to create a police officer form with designation dropdown
            function createPoliceOfficerForm(index) {
                const officerDiv = document.createElement('div');
                officerDiv.className = 'officer-container';
                officerDiv.id = `officer-${index}`;
                
                officerDiv.innerHTML = `
                    <h4>Police Officer ${index}</h4>
                    <div class="officer-details">
                        <div class="form-group">
                            <label for="designation${index}" class="required">Designation</label>
                            <select id="designation${index}" class="designation-select">
                                <option value="">Select Designation</option>
                                <option value="SI">SI</option>
                                <option value="SSI">SSI</option>
                                <option value="HC">HC</option>
                                <option value="GrI">GrI</option>
                                <option value="PC">PC</option>
                            </select>
                            <div class="error-message" id="designation${index}-error">Please select a designation</div>
                        </div>
                        <div class="form-group police-number-group">
                            <label for="policeNumber${index}" class="required">Police Number</label>
                            <input type="text" id="policeNumber${index}" placeholder="Enter police number">
                            <div class="error-message" id="policeNumber${index}-error">Please enter a police number</div>
                        </div>
                    </div>
                    <div class="form-group">
                        <label for="fullName${index}" class="required">Full Name</label>
                        <input type="text" id="fullName${index}" placeholder="Enter full name">
                        <div class="error-message" id="fullName${index}-error">Please enter a full name</div>
                    </div>
                    ${index > 1 ? `<button type="button" class="remove-officer" data-index="${index}">Remove Officer</button>` : ''}
                `;
                
                // Add event listener for designation change
                const designationSelect = officerDiv.querySelector(`#designation${index}`);
                designationSelect.addEventListener('change', function() {
                    togglePoliceNumberField(this);
                });
                
                return officerDiv;
            }
            
            // Function to create an accused person form
            function createAccusedForm(index) {
                const accusedDiv = document.createElement('div');
                accusedDiv.className = 'accused-container';
                accusedDiv.id = `accused-${index}`;
                
                accusedDiv.innerHTML = `
                    <h4>Accused Person ${index}</h4>
                    <div class="accused-details">
                        <div class="form-group">
                            <label for="accusedName${index}" class="required">Name</label>
                            <input type="text" id="accusedName${index}" placeholder="Enter accused name">
                            <div class="error-message" id="accusedName${index}-error">Please enter an accused name</div>
                        </div>
                        <div class="form-group">
                            <label for="age${index}" class="required">Age</label>
                            <input type="text" id="age${index}" placeholder="Enter age">
                            <div class="error-message" id="age${index}-error">Please enter a valid age</div>
                        </div>
                    </div>
                    <div class="form-group">
                        <label for="fatherName${index}" class="required">Father Name</label>
                        <input type="text" id="fatherName${index}" placeholder="Enter father's name">
                            <div class="error-message" id="fatherName${index}-error">Please enter a father name</div>
                    </div>
                    ${index > 1 ? `<button type="button" class="remove-accused" data-index="${index}">Remove Accused</button>` : ''}
                `;
                
                return accusedDiv;
            }
            
            // Function to create a police officer document field with name on next line
            function createPoliceOfficerDocumentField(index) {
                const officerContainer = document.createElement('div');
                officerContainer.className = 'officer-container-preview';
                officerContainer.id = `police-officer-${index}`;
                
                officerContainer.innerHTML = `
                    <div class="officer-top-line">
                        <div class="preview-field compact-field officer-designation empty" id="designation-field-${index}" placeholder="Designation"></div>
                        <div class="preview-field compact-field officer-number empty" id="police-number-field-${index}" placeholder="No."></div>
                    </div>
                    <div class="preview-field compact-field officer-name empty" id="full-name-field-${index}" placeholder="Full Name"></div>
                `;
                
                return officerContainer;
            }
            
            // Function to update police officers based on count
            function updatePoliceOfficers() {
                const count = parseInt(officerCountInput.value) || 1;
                
                // Ensure count is within reasonable limits
                if (count < 1) {
                    officerCountInput.value = 1;
                    return;
                }
                if (count > 10) {
                    officerCountInput.value = 10;
                    showNotification('Maximum 10 police officers allowed', 'error');
                    return;
                }
                
                // Update forms
                policeOfficersContainer.innerHTML = '';
                for (let i = 1; i <= count; i++) {
                    policeOfficersContainer.appendChild(createPoliceOfficerForm(i));
                }
                officerCounter = count;
                
                // Update document fields
                policeOfficersList.innerHTML = '';
                for (let i = 1; i <= count; i++) {
                    policeOfficersList.appendChild(createPoliceOfficerDocumentField(i));
                }
                
                // Add event listeners to remove buttons
                document.querySelectorAll('.remove-officer').forEach(button => {
                    button.addEventListener('click', function() {
                        const index = parseInt(this.getAttribute('data-index'));
                        removePoliceOfficer(index);
                    });
                });
                
                // Update form completion
                calculateFormCompletion();
            }
            
            // Function to update accused persons based on count
            function updateAccusedPersons() {
                const count = parseInt(accusedCountInput.value) || 1;
                
                // Ensure count is within reasonable limits
                if (count < 1) {
                    accusedCountInput.value = 1;
                    return;
                }
                if (count > 10) {
                    accusedCountInput.value = 10;
                    showNotification('Maximum 10 accused persons allowed', 'error');
                    return;
                }
                
                // Update forms
                accusedPersonsContainer.innerHTML = '';
                for (let i = 1; i <= count; i++) {
                    accusedPersonsContainer.appendChild(createAccusedForm(i));
                }
                accusedCounter = count;
                
                // Add event listeners to remove buttons
                document.querySelectorAll('.remove-accused').forEach(button => {
                    button.addEventListener('click', function() {
                        const index = parseInt(this.getAttribute('data-index'));
                        removeAccusedPerson(index);
                    });
                });
                
                // Update form completion
                calculateFormCompletion();
            }
            
            // Function to add a single police officer
            function addPoliceOfficer() {
                officerCounter++;
                officerCountInput.value = officerCounter;
                updatePoliceOfficers();
            }
            
            // Function to add a single accused person
            function addAccusedPerson() {
                accusedCounter++;
                accusedCountInput.value = accusedCounter;
                updateAccusedPersons();
            }
            
            // Function to remove a police officer
            function removePoliceOfficer(index) {
                if (officerCounter <= 1) {
                    showNotification('At least one police officer is required', 'error');
                    return;
                }
                
                officerCounter--;
                officerCountInput.value = officerCounter;
                updatePoliceOfficers();
            }
            
            // Function to remove an accused person
            function removeAccusedPerson(index) {
                if (accusedCounter <= 1) {
                    showNotification('At least one accused person is required', 'error');
                    return;
                }
                
                accusedCounter--;
                accusedCountInput.value = accusedCounter;
                updateAccusedPersons();
            }
            
            // Function to validate all form fields
            function validateForm() {
                let isValid = true;
                
                // Validate main form fields
                const mainFields = [
                    'passportType', 'policeStation', 'crimeNumber', 'section', 'date', 'time'
                ];
                
                // Add MM field only if not Lab Report
                if (passportTypeSelect.value !== 'Lab Report') {
                    mainFields.push('mm');
                }
                
                mainFields.forEach(fieldId => {
                    const field = document.getElementById(fieldId);
                    if (!validateField.call(field)) {
                        isValid = false;
                    }
                });
                
                // Validate transfer fields if transfer passport is selected
                if (passportTypeSelect.value === 'Transfer Passport') {
                    const transferFields = ['fromStation', 'toStation', 'transferReason'];
                    transferFields.forEach(fieldId => {
                        const field = document.getElementById(fieldId);
                        if (!validateField.call(field)) {
                            isValid = false;
                        }
                    });
                }
                
                // Validate FIR fields if FIR passport is selected and fields are visible
                if (passportTypeSelect.value === 'FIR Filing Passport' && !firFields.classList.contains('hidden')) {
                    const firFieldsToValidate = ['complainantName', 'complainantAddress', 'incidentDate', 'incidentTime', 'incidentPlace'];
                    firFieldsToValidate.forEach(fieldId => {
                        const field = document.getElementById(fieldId);
                        if (field && !validateField.call(field)) {
                            isValid = false;
                        }
                    });
                }
                
                // Validate Visera fields if Visera Report is selected
                if (passportTypeSelect.value === 'Visera Report') {
                    const viseraFields = ['deceasedName', 'deceasedAge', 'deceasedFatherName', 'pmNumber', 'pmDate'];
                    viseraFields.forEach(fieldId => {
                        const field = document.getElementById(fieldId);
                        if (!validateField.call(field)) {
                            isValid = false;
                        }
                    });
                }
                
                // Validate Lab Report fields if Lab Report is selected
                if (passportTypeSelect.value === 'Lab Report') {
                    const labReportFields = ['narNumber', 'narDate'];
                    labReportFields.forEach(fieldId => {
                        const field = document.getElementById(fieldId);
                        if (!validateField.call(field)) {
                            isValid = false;
                        }
                    });
                }
                
                // Validate police officer fields
                for (let i = 1; i <= officerCounter; i++) {
                    const designationField = document.getElementById(`designation${i}`);
                    const fullNameField = document.getElementById(`fullName${i}`);
                    
                    if (!validateField.call(designationField) || !validateField.call(fullNameField)) {
                        isValid = false;
                    }
                    
                    // Validate police number only for designations that require it
                    const designation = designationField.value;
                    if (designation !== 'SI' && designation !== 'SSI') {
                        const policeNumberField = document.getElementById(`policeNumber${i}`);
                        if (!validateField.call(policeNumberField)) {
                            isValid = false;
                        }
                    }
                }
                
                // Validate accused person fields only if not FIR Filing Passport, Visera Report, or Lab Report
                if (passportTypeSelect.value !== 'FIR Filing Passport' && passportTypeSelect.value !== 'Visera Report' && passportTypeSelect.value !== 'Lab Report') {
                    for (let i = 1; i <= accusedCounter; i++) {
                        const accusedNameField = document.getElementById(`accusedName${i}`);
                        const ageField = document.getElementById(`age${i}`);
                        const fatherNameField = document.getElementById(`fatherName${i}`);
                        
                        if (!validateField.call(accusedNameField) || !validateField.call(ageField) || !validateField.call(fatherNameField)) {
                            isValid = false;
                        }
                    }
                }
                
                return isValid;
            }
            
            // Auto-save functionality
            function autoSave() {
                clearTimeout(autoSaveTimeout);
                
                autoSaveTimeout = setTimeout(() => {
                    // Collect all form data
                    const formData = {
                        passportType: document.getElementById('passportType').value,
                        policeStation: document.getElementById('policeStation').value,
                        crimeNumber: document.getElementById('crimeNumber').value,
                        section: document.getElementById('section').value,
                        mm: document.getElementById('mm').value,
                        date: document.getElementById('date').value,
                        time: document.getElementById('time').value,
                        officerCount: officerCounter,
                        accusedCount: accusedCounter,
                        language: currentLanguage
                    };
                    
                    // Save to localStorage
                    localStorage.setItem('policePassportFormData', JSON.stringify(formData));
                    
                    // Show auto-save indicator
                    autoSaveIndicator.style.display = 'block';
                    setTimeout(() => {
                        autoSaveIndicator.style.display = 'none';
                    }, 2000);
                }, 1000);
            }
            
            // Load saved form data
            function loadSavedData() {
                const savedData = localStorage.getItem('policePassportFormData');
                
                if (savedData) {
                    const formData = JSON.parse(savedData);
                    
                    // Restore form values
                    document.getElementById('passportType').value = formData.passportType || '';
                    document.getElementById('policeStation').value = formData.policeStation || '';
                    document.getElementById('crimeNumber').value = formData.crimeNumber || '';
                    document.getElementById('section').value = formData.section || '';
                    document.getElementById('mm').value = formData.mm || '';
                    document.getElementById('date').value = formData.date || '';
                    document.getElementById('time').value = formData.time || '';
                    
                    // Restore officer and accused counts
                    if (formData.officerCount) {
                        officerCountInput.value = formData.officerCount;
                        updatePoliceOfficers();
                    }
                    
                    if (formData.accusedCount) {
                        accusedCountInput.value = formData.accusedCount;
                        updateAccusedPersons();
                    }
                    
                    // Restore language
                    if (formData.language) {
                        currentLanguage = formData.language;
                        languageSelect.value = currentLanguage;
                        updateLanguageContent();
                    }
                    
                    // Update content visibility
                    updateContentVisibility();
                    toggleTransferFields();
                    toggleFIRFields();
                    toggleViseraFields();
                    toggleLabReportFields();
                    toggleMMSection();
                    toggleAccusedSection();
                    updateContentStatus();
                    
                    showNotification('Previous form data restored', 'success');
                }
            }
            
            // Update language content based on selected language
            function updateLanguageContent() {
                // Hide all language content
                languageContents.forEach(content => {
                    content.classList.remove('active');
                });
                
                // Show active language content
                document.getElementById(`${currentLanguage}-content`).classList.add('active');
                
                // Update content visibility
                updateContentVisibility();
            }
            
            // NEW: Function to calculate form completion
            function calculateFormCompletion() {
                const requiredFields = document.querySelectorAll('[required]');
                let filledCount = 0;
                
                requiredFields.forEach(field => {
                    if (field.value.trim() !== '') {
                        filledCount++;
                    }
                });
                
                const percentage = Math.round((filledCount / requiredFields.length) * 100);
                completionPercentage.textContent = `${percentage}%`;
                completionFill.style.width = `${percentage}%`;
                
                // Update document status
                if (percentage === 100) {
                    documentStatus.textContent = 'Ready to generate document';
                    documentStatus.className = 'document-status ready';
                } else {
                    documentStatus.textContent = `${100 - percentage}% incomplete - fill all required fields`;
                    documentStatus.className = 'document-status pending';
                }
                
                return percentage;
            }
            
            // NEW: Function to apply template preset
            function applyTemplatePreset(templateName) {
                const preset = templatePresets[templateName];
                if (!preset) return;
                
                // Apply preset values
                Object.keys(preset).forEach(key => {
                    const field = document.getElementById(key);
                    if (field) {
                        field.value = preset[key];
                        // Trigger validation for each field
                        if (typeof validateField === 'function') {
                            validateField.call(field);
                        }
                    }
                });
                
                // Trigger change events
                passportTypeSelect.dispatchEvent(new Event('change'));
                
                // Update form completion
                calculateFormCompletion();
                
                // Update content status
                updateContentStatus();
                
                // Auto-save
                autoSave();
                
                showNotification(`${templateName} template applied`, 'success');
            }
            
            // NEW: Zoom functionality
            function updateZoom() {
                const preview = document.getElementById('document-to-print');
                preview.style.transform = `scale(${zoomLevel})`;
                preview.style.transformOrigin = 'top left';
            }
            
            // Initialize the application
            function initializeApp() {
                updatePoliceOfficers();
                updateAccusedPersons();
                loadSavedData();
                calculateFormCompletion();
                updateContentStatus();
            }
            
            // Initialize police officers and accused persons
            initializeApp();
            
            // NEW: Template button event listeners
            templateBtns.forEach(btn => {
                btn.addEventListener('click', function() {
                    const templateName = this.getAttribute('data-template');
                    applyTemplatePreset(templateName);
                });
            });
            
            // NEW: Zoom functionality
            zoomInBtn.addEventListener('click', function() {
                if (zoomLevel < 2) {
                    zoomLevel += 0.1;
                    updateZoom();
                }
            });
            
            zoomOutBtn.addEventListener('click', function() {
                if (zoomLevel > 0.5) {
                    zoomLevel -= 0.1;
                    updateZoom();
                }
            });
            
            resetZoomBtn.addEventListener('click', function() {
                zoomLevel = 1;
                updateZoom();
            });
            
            // Crime number formatting
            crimeNumberInput.addEventListener('input', function() {
                formatCrimeNumber(this);
                autoSave();
                calculateFormCompletion();
            });
            
            // Listen for changes in passport type
            passportTypeSelect.addEventListener('change', function() {
                updateContentVisibility();
                toggleTransferFields();
                toggleFIRFields();
                toggleViseraFields();
                toggleLabReportFields();
                toggleMMSection();
                toggleAccusedSection();
                updateContentStatus();
                autoSave();
                calculateFormCompletion();
            });
            
            // Language dropdown switching
            languageSelect.addEventListener('change', function() {
                currentLanguage = this.value;
                updateLanguageContent();
                updateContentStatus();
                autoSave();
                calculateFormCompletion();
            });
            
            // Update content visibility based on selected passport type and language
            function updateContentVisibility() {
                const passportType = passportTypeSelect.value;
                
                // Hide all content first
                document.querySelectorAll('.content-text').forEach(el => {
                    el.style.display = 'none';
                });
                
                contentPlaceholder.style.display = 'block';
                
                if (!passportType) return;
                
                contentPlaceholder.style.display = 'none';
                
                // Show content based on selected language and passport type
                if (currentLanguage === 'tamil') {
                    if (passportType === 'Escort') {
                        document.getElementById('escort-tamil-content').style.display = 'block';
                    } else if (passportType === 'PT warrant') {
                        document.getElementById('pt-warrant-tamil-content').style.display = 'block';
                    } else if (passportType === 'Sick Passport') {
                        document.getElementById('sick-passport-tamil-content').style.display = 'block';
                    } else if (passportType === 'Transfer Passport') {
                        document.getElementById('transfer-passport-tamil-content').style.display = 'block';
                    } else if (passportType === 'FIR Filing Passport') {
                        document.getElementById('fir-filing-tamil-content').style.display = 'block';
                    } else if (passportType === 'Visera Report') {
                        document.getElementById('visera-report-tamil-content').style.display = 'block';
                    } else if (passportType === 'Lab Report') {
                        document.getElementById('lab-report-tamil-content').style.display = 'block';
                    } else if (passportType === 'Formal Arrest') {
                        document.getElementById('formal-arrest-tamil-content').style.display = 'block';
                    }
                } else if (currentLanguage === 'english') {
                    if (passportType === 'Escort') {
                        document.getElementById('escort-english-content').style.display = 'block';
                    } else if (passportType === 'PT warrant') {
                        document.getElementById('pt-warrant-english-content').style.display = 'block';
                    } else if (passportType === 'Sick Passport') {
                        document.getElementById('sick-passport-english-content').style.display = 'block';
                    } else if (passportType === 'Transfer Passport') {
                        document.getElementById('transfer-passport-english-content').style.display = 'block';
                    } else if (passportType === 'FIR Filing Passport') {
                        document.getElementById('fir-filing-english-content').style.display = 'block';
                    } else if (passportType === 'Visera Report') {
                        document.getElementById('visera-report-english-content').style.display = 'block';
                    } else if (passportType === 'Lab Report') {
                        document.getElementById('lab-report-english-content').style.display = 'block';
                    } else if (passportType === 'Formal Arrest') {
                        document.getElementById('formal-arrest-english-content').style.display = 'block';
                    }
                }
            }
            
            // Listen for changes in police count
            officerCountInput.addEventListener('change', updatePoliceOfficers);
            officerCountInput.addEventListener('input', updatePoliceOfficers);
            
            // Listen for changes in accused count
            accusedCountInput.addEventListener('change', updateAccusedPersons);
            accusedCountInput.addEventListener('input', updateAccusedPersons);
            
            // Add officer button
            addOfficerBtn.addEventListener('click', addPoliceOfficer);
            
            // Add accused button
            addAccusedBtn.addEventListener('click', addAccusedPerson);
            
            // Auto-save on input changes
            document.querySelectorAll('input, select').forEach(element => {
                if (element.id !== 'crimeNumber') { // Skip crime number as it has its own handler
                    element.addEventListener('input', function() {
                        autoSave();
                        calculateFormCompletion();
                    });
                }
            });
            
            // Real-time validation on blur
            document.querySelectorAll('input[required], select[required]').forEach(field => {
                field.addEventListener('blur', validateField);
            });
            
            // Fill form based on questionnaire answers
            fillFormBtn.addEventListener('click', function() {
                // Validate form
                if (!validateForm()) {
                    showNotification('Please fix the errors in the form before generating the document', 'error');
                    return;
                }
                
                // Check if content is available for selected passport type
                const selectedType = passportTypeSelect.value;
                if (!availablePassportTypes[selectedType]) {
                    showNotification(`No content template available for ${selectedType}. Please select a different passport type.`, 'error');
                    return;
                }
                
                // Get all values from the questionnaire
                const passportType = document.getElementById('passportType').value;
                const policeCount = parseInt(officerCountInput.value) || 1;
                const accusedCount = parseInt(accusedCountInput.value) || 1;
                const policeStation = document.getElementById('policeStation').value;
                const time = document.getElementById('time').value;
                const date = document.getElementById('date').value;
                const crimeNumber = document.getElementById('crimeNumber').value;
                const section = document.getElementById('section').value;
                const mm = document.getElementById('mm').value;
                
                // Get transfer details if applicable
                const fromStation = document.getElementById('fromStation')?.value || '';
                const toStation = document.getElementById('toStation')?.value || '';
                const transferReason = document.getElementById('transferReason')?.value || '';
                
                // Get Visera details if applicable
                const deceasedName = document.getElementById('deceasedName')?.value || '';
                const deceasedAge = document.getElementById('deceasedAge')?.value || '';
                const deceasedFatherName = document.getElementById('deceasedFatherName')?.value || '';
                const pmNumber = document.getElementById('pmNumber')?.value || '';
                const pmDate = document.getElementById('pmDate')?.value || '';
                
                // Get Lab Report details if applicable
                const narNumber = document.getElementById('narNumber')?.value || '';
                const narDate = document.getElementById('narDate')?.value || '';
                
                // Get ordinal suffix for MM (only for English)
                const mmNumber = parseInt(mm);
                const mmWithSuffix = getOrdinalSuffix(mmNumber);
                
                // Fill police officer details with name on next line
                for (let i = 1; i <= policeCount; i++) {
                    const designation = document.getElementById(`designation${i}`).value;
                    const policeNumber = document.getElementById(`policeNumber${i}`).value;
                    const fullName = document.getElementById(`fullName${i}`).value;
                    
                    const designationField = document.getElementById(`designation-field-${i}`);
                    const policeNumberField = document.getElementById(`police-number-field-${i}`);
                    const fullNameField = document.getElementById(`full-name-field-${i}`);
                    
                    designationField.textContent = designation;
                    designationField.classList.remove('empty');
                    
                    // Only show police number for designations that need it
                    if (designation === 'SI' || designation === 'SSI') {
                        policeNumberField.textContent = '';
                        policeNumberField.classList.add('hidden-field');
                    } else {
                        policeNumberField.textContent = policeNumber;
                        policeNumberField.classList.remove('empty');
                        policeNumberField.classList.remove('hidden-field');
                    }
                    
                    fullNameField.textContent = fullName;
                    fullNameField.classList.remove('empty');
                }
                
                // Fill other fields
                // UPDATED: Show "Police Station" text after the police station name
                document.getElementById('police-station-field').textContent = policeStation;
                document.getElementById('police-station-field').classList.remove('empty');
                
                // Show the "Police Station" label
                policeStationLabel.style.display = 'block';
                policeStationLabel.textContent = 'Police Station';
                
                document.getElementById('time-field').textContent = time;
                document.getElementById('time-field').classList.remove('empty');
                
                document.getElementById('date-field').textContent = date;
                document.getElementById('date-field').classList.remove('empty');
                
                // Generate accused list for document content (only if not FIR Filing Passport, Visera Report, or Lab Report)
                let accusedListTamil = '';
                let accusedListEnglish = '';
                let accusedListPtTamil = '';
                let accusedListPtEnglish = '';
                let accusedListTransferTamil = '';
                let accusedListTransferEnglish = '';
                let accusedListFormalArrestTamil = '';
                let accusedListFormalArrestEnglish = '';
                
                if (passportType !== 'FIR Filing Passport' && passportType !== 'Visera Report' && passportType !== 'Lab Report') {
                    for (let i = 1; i <= accusedCount; i++) {
                        const accusedName = document.getElementById(`accusedName${i}`).value;
                        const age = document.getElementById(`age${i}`).value;
                        const fatherName = document.getElementById(`fatherName${i}`).value;
                        
                        if (currentLanguage === 'tamil') {
                            accusedListTamil += `${accusedName} ‡ÆÜ/‡Æµ ${age} ‡Æ§/‡Æ™‡ØÜ ${fatherName}`;
                            accusedListPtTamil += `${accusedName}, ‡Æ™‡ØÜ-‡Æµ ${age}, ‡Æ§/‡Æ™‡ØÜ ${fatherName}`;
                            accusedListTransferTamil += `${accusedName} ‡ÆÜ/‡Æµ ${age} ‡Æ§/‡Æ™‡ØÜ ${fatherName}`;
                            accusedListFormalArrestTamil += `${accusedName} ‡ÆÜ/‡Æµ ${age} ‡Æ§/‡Æ™‡ØÜ ${fatherName}`;
                            
                            if (i < accusedCount) {
                                accusedListTamil += ', ';
                                accusedListPtTamil += ', ';
                                accusedListTransferTamil += ', ';
                                accusedListFormalArrestTamil += ', ';
                            }
                        } else {
                            accusedListEnglish += `${accusedName} aged ${age} years, S/o ${fatherName}`;
                            accusedListPtEnglish += `${accusedName} aged ${age} years, S/o ${fatherName}`;
                            accusedListTransferEnglish += `${accusedName} aged ${age} years, S/o ${fatherName}`;
                            accusedListFormalArrestEnglish += `${accusedName} aged ${age} years, S/o ${fatherName}`;
                            
                            if (i < accusedCount) {
                                accusedListEnglish += ', ';
                                accusedListPtEnglish += ', ';
                                accusedListTransferEnglish += ', ';
                                accusedListFormalArrestEnglish += ', ';
                            }
                        }
                    }
                }
                
                // Fill content fields based on language and passport type
                if (currentLanguage === 'tamil') {
                    if (passportType === 'Escort' || passportType === 'PT warrant' || passportType === 'Transfer Passport' || passportType === 'FIR Filing Passport' || passportType === 'Visera Report' || passportType === 'Lab Report' || passportType === 'Formal Arrest') {
                        // UPDATED: Fill police station content in Tamil
                        document.getElementById('police-station-content-tamil').textContent = policeStation;
                        document.getElementById('police-station-content-tamil').classList.remove('empty');
                        
                        document.getElementById('crime-no-field-tamil').textContent = crimeNumber;
                        document.getElementById('crime-no-field-tamil').classList.remove('empty');
                        
                        document.getElementById('section-field-tamil').textContent = section;
                        document.getElementById('section-field-tamil').classList.remove('empty');
                        
                        document.getElementById('accused-list-tamil').textContent = accusedListTamil;
                        
                        // Only fill MM field if not Lab Report - REMOVED ORDINAL SUFFIX FOR TAMIL
                        if (passportType !== 'Lab Report') {
                            document.getElementById('mm-field-tamil').textContent = mm; // Use mm directly without suffix
                            document.getElementById('mm-field-tamil').classList.remove('empty');
                        }
                    }
                    if (passportType === 'PT warrant') {
                        // UPDATED: Fill police station content in Tamil for PT warrant
                        document.getElementById('police-station-content-pt-tamil').textContent = policeStation;
                        document.getElementById('police-station-content-pt-tamil').classList.remove('empty');
                        
                        document.getElementById('crime-no-field-pt-tamil').textContent = crimeNumber;
                        document.getElementById('crime-no-field-pt-tamil').classList.remove('empty');
                        
                        document.getElementById('section-field-pt-tamil').textContent = section;
                        document.getElementById('section-field-pt-tamil').classList.remove('empty');
                        
                        document.getElementById('accused-list-pt-tamil').textContent = accusedListPtTamil;
                        
                        // REMOVED ORDINAL SUFFIX FOR TAMIL
                        document.getElementById('mm-field-pt-tamil').textContent = mm; // Use mm directly without suffix
                        document.getElementById('mm-field-pt-tamil').classList.remove('empty');
                        
                        // Additional fields for PT warrant
                        document.getElementById('sc-no-field-tamil').textContent = '97/2023';
                        document.getElementById('sc-no-field-tamil').classList.remove('empty');
                        
                        document.getElementById('prc-no-field-tamil').textContent = '156/2021';
                        document.getElementById('prc-no-field-tamil').classList.remove('empty');
                        
                        document.getElementById('central-prison-field-tamil').textContent = '‡ÆÆ‡Æ§‡Øç‡Æ§‡Æø‡ÆØ ‡Æö‡Æø‡Æ±‡Øà';
                        document.getElementById('central-prison-field-tamil').classList.remove('empty');
                    }
                    if (passportType === 'Transfer Passport') {
                        // UPDATED: For Transfer Passport, we don't need to fill any fields since the content is static
                        // The content is already set in the HTML template
                    }
                    if (passportType === 'FIR Filing Passport') {
                        // UPDATED: Fill police station content in Tamil for FIR
                        document.getElementById('police-station-content-fir-tamil').textContent = policeStation;
                        document.getElementById('police-station-content-fir-tamil').classList.remove('empty');
                        
                        document.getElementById('crime-no-field-fir-tamil').textContent = crimeNumber;
                        document.getElementById('crime-no-field-fir-tamil').classList.remove('empty');
                        
                        document.getElementById('section-field-fir-tamil').textContent = section;
                        document.getElementById('section-field-fir-tamil').classList.remove('empty');
                        
                        // UPDATED: Remove accused list for FIR Filing Passport
                        document.getElementById('accused-list-fir-tamil').textContent = '';
                        
                        // REMOVED ORDINAL SUFFIX FOR TAMIL
                        document.getElementById('mm-field-fir-tamil').textContent = mm; // Use mm directly without suffix
                        document.getElementById('mm-field-fir-tamil').classList.remove('empty');
                    }
                    if (passportType === 'Visera Report') {
                        // UPDATED: Fill police station content in Tamil for Visera
                        document.getElementById('police-station-content-visera-tamil').textContent = policeStation;
                        document.getElementById('police-station-content-visera-tamil').classList.remove('empty');
                        
                        document.getElementById('crime-no-field-visera-tamil').textContent = crimeNumber;
                        document.getElementById('crime-no-field-visera-tamil').classList.remove('empty');
                        
                        document.getElementById('section-field-visera-tamil').textContent = section;
                        document.getElementById('section-field-visera-tamil').classList.remove('empty');
                        
                        document.getElementById('deceased-name-field-tamil').textContent = deceasedName;
                        document.getElementById('deceased-name-field-tamil').classList.remove('empty');
                        
                        document.getElementById('deceased-age-field-tamil').textContent = deceasedAge;
                        document.getElementById('deceased-age-field-tamil').classList.remove('empty');
                        
                        document.getElementById('deceased-father-name-field-tamil').textContent = deceasedFatherName;
                        document.getElementById('deceased-father-name-field-tamil').classList.remove('empty');
                        
                        document.getElementById('pm-number-field-tamil').textContent = pmNumber;
                        document.getElementById('pm-number-field-tamil').classList.remove('empty');
                        
                        document.getElementById('pm-date-field-tamil').textContent = pmDate;
                        document.getElementById('pm-date-field-tamil').classList.remove('empty');
                    }
                    if (passportType === 'Lab Report') {
                        // NEW: Fill police station content in Tamil for Lab Report
                        document.getElementById('police-station-content-lab-tamil').textContent = policeStation;
                        document.getElementById('police-station-content-lab-tamil').classList.remove('empty');
                        
                        document.getElementById('crime-no-field-lab-tamil').textContent = crimeNumber;
                        document.getElementById('crime-no-field-lab-tamil').classList.remove('empty');
                        
                        document.getElementById('section-field-lab-tamil').textContent = section;
                        document.getElementById('section-field-lab-tamil').classList.remove('empty');
                        
                        document.getElementById('date-field-lab-tamil').textContent = date;
                        document.getElementById('date-field-lab-tamil').classList.remove('empty');
                        
                        document.getElementById('nar-no-field-tamil').textContent = narNumber;
                        document.getElementById('nar-no-field-tamil').classList.remove('empty');
                        
                        document.getElementById('nar-date-field-tamil').textContent = narDate;
                        document.getElementById('nar-date-field-tamil').classList.remove('empty');
                    }
                    if (passportType === 'Formal Arrest') {
                        // NEW: Fill police station content in Tamil for Formal Arrest
                        document.getElementById('crime-no-field-formal-arrest-tamil').textContent = crimeNumber;
                        document.getElementById('crime-no-field-formal-arrest-tamil').classList.remove('empty');
                        
                        document.getElementById('section-field-formal-arrest-tamil').textContent = section;
                        document.getElementById('section-field-formal-arrest-tamil').classList.remove('empty');
                        
                        document.getElementById('accused-list-formal-arrest-tamil').textContent = accusedListFormalArrestTamil;
                    }
                } else if (currentLanguage === 'english') {
                    if (passportType === 'Escort' || passportType === 'PT warrant' || passportType === 'Transfer Passport' || passportType === 'FIR Filing Passport' || passportType === 'Visera Report' || passportType === 'Lab Report' || passportType === 'Formal Arrest') {
                        // UPDATED: Fill police station content in English
                        document.getElementById('police-station-content-english').textContent = policeStation;
                        document.getElementById('police-station-content-english').classList.remove('empty');
                        
                        document.getElementById('crime-no-field-english').textContent = crimeNumber;
                        document.getElementById('crime-no-field-english').classList.remove('empty');
                        
                        document.getElementById('section-field-english').textContent = section;
                        document.getElementById('section-field-english').classList.remove('empty');
                        
                        document.getElementById('accused-list-english').textContent = accusedListEnglish;
                        
                        // Only fill MM field if not Lab Report - KEEP ORDINAL SUFFIX FOR ENGLISH
                        if (passportType !== 'Lab Report') {
                            document.getElementById('mm-field-english').textContent = mmWithSuffix || mm;
                            document.getElementById('mm-field-english').classList.remove('empty');
                        }
                    }
                    if (passportType === 'PT warrant') {
                        // UPDATED: Fill police station content in English for PT warrant
                        document.getElementById('police-station-content-pt-english').textContent = policeStation;
                        document.getElementById('police-station-content-pt-english').classList.remove('empty');
                        
                        document.getElementById('crime-no-field-pt-english').textContent = crimeNumber;
                        document.getElementById('crime-no-field-pt-english').classList.remove('empty');
                        
                        document.getElementById('section-field-pt-english').textContent = section;
                        document.getElementById('section-field-pt-english').classList.remove('empty');
                        
                        document.getElementById('accused-list-pt-english').textContent = accusedListPtEnglish;
                        
                        // KEEP ORDINAL SUFFIX FOR ENGLISH
                        document.getElementById('mm-field-pt-english').textContent = mmWithSuffix || mm;
                        document.getElementById('mm-field-pt-english').classList.remove('empty');
                        
                        // Additional fields for PT warrant
                        document.getElementById('sc-no-field-english').textContent = '97/2023';
                        document.getElementById('sc-no-field-english').classList.remove('empty');
                        
                        document.getElementById('prc-no-field-english').textContent = '156/2021';
                        document.getElementById('prc-no-field-english').classList.remove('empty');
                    }
                    if (passportType === 'Transfer Passport') {
                        // UPDATED: For Transfer Passport, we don't need to fill any fields since the content is static
                        // The content is already set in the HTML template
                    }
                    if (passportType === 'FIR Filing Passport') {
                        // UPDATED: Fill police station content in English for FIR
                        document.getElementById('police-station-content-fir-english').textContent = policeStation;
                        document.getElementById('police-station-content-fir-english').classList.remove('empty');
                        
                        document.getElementById('crime-no-field-fir-english').textContent = crimeNumber;
                        document.getElementById('crime-no-field-fir-english').classList.remove('empty');
                        
                        document.getElementById('section-field-fir-english').textContent = section;
                        document.getElementById('section-field-fir-english').classList.remove('empty');
                        
                        // UPDATED: Remove accused list for FIR Filing Passport
                        document.getElementById('accused-list-fir-english').textContent = '';
                        
                        // KEEP ORDINAL SUFFIX FOR ENGLISH
                        document.getElementById('mm-field-fir-english').textContent = mmWithSuffix || mm;
                        document.getElementById('mm-field-fir-english').classList.remove('empty');
                    }
                    if (passportType === 'Visera Report') {
                        // UPDATED: Fill police station content in English for Visera
                        document.getElementById('police-station-content-visera-english').textContent = policeStation;
                        document.getElementById('police-station-content-visera-english').classList.remove('empty');
                        
                        document.getElementById('crime-no-field-visera-english').textContent = crimeNumber;
                        document.getElementById('crime-no-field-visera-english').classList.remove('empty');
                        
                        document.getElementById('section-field-visera-english').textContent = section;
                        document.getElementById('section-field-visera-english').classList.remove('empty');
                        
                        document.getElementById('deceased-name-field-english').textContent = deceasedName;
                        document.getElementById('deceased-name-field-english').classList.remove('empty');
                        
                        document.getElementById('deceased-age-field-english').textContent = deceasedAge;
                        document.getElementById('deceased-age-field-english').classList.remove('empty');
                        
                        document.getElementById('deceased-father-name-field-english').textContent = deceasedFatherName;
                        document.getElementById('deceased-father-name-field-english').classList.remove('empty');
                        
                        document.getElementById('pm-number-field-english').textContent = pmNumber;
                        document.getElementById('pm-number-field-english').classList.remove('empty');
                        
                        document.getElementById('pm-date-field-english').textContent = pmDate;
                        document.getElementById('pm-date-field-english').classList.remove('empty');
                    }
                    if (passportType === 'Lab Report') {
                        // NEW: Fill police station content in English for Lab Report
                        document.getElementById('police-station-content-lab-english').textContent = policeStation;
                        document.getElementById('police-station-content-lab-english').classList.remove('empty');
                        
                        document.getElementById('crime-no-field-lab-english').textContent = crimeNumber;
                        document.getElementById('crime-no-field-lab-english').classList.remove('empty');
                        
                        document.getElementById('section-field-lab-english').textContent = section;
                        document.getElementById('section-field-lab-english').classList.remove('empty');
                        
                        document.getElementById('date-field-lab-english').textContent = date;
                        document.getElementById('date-field-lab-english').classList.remove('empty');
                        
                        document.getElementById('nar-no-field-english').textContent = narNumber;
                        document.getElementById('nar-no-field-english').classList.remove('empty');
                        
                        document.getElementById('nar-date-field-english').textContent = narDate;
                        document.getElementById('nar-date-field-english').classList.remove('empty');
                    }
                    if (passportType === 'Formal Arrest') {
                        // NEW: Fill police station content in English for Formal Arrest
                        document.getElementById('crime-no-field-formal-arrest-english').textContent = crimeNumber;
                        document.getElementById('crime-no-field-formal-arrest-english').classList.remove('empty');
                        
                        document.getElementById('section-field-formal-arrest-english').textContent = section;
                        document.getElementById('section-field-formal-arrest-english').classList.remove('empty');
                        
                        document.getElementById('accused-list-formal-arrest-english').textContent = accusedListFormalArrestEnglish;
                    }
                }
                
                // Update content based on selected type and language
                updateContentVisibility();
                
                showNotification('Document generated successfully!', 'success');
            });

            // Print document
            printBtn.addEventListener('click', function() {
                const printContent = document.getElementById('document-to-print').innerHTML;
                const originalContent = document.body.innerHTML;
                
                document.body.innerHTML = printContent;
                window.print();
                document.body.innerHTML = originalContent;
                
                // Re-initialize event listeners after restoring content
                window.location.reload();
            });

            // PDF Generation
            generateBtn.addEventListener('click', function() {
                // Validate that document has been filled
                const firstDesignation = document.getElementById('designation-field-1').textContent;
                if (!firstDesignation || firstDesignation === 'Designation') {
                    showNotification('Please generate the document first using the "Generate Document" button', 'error');
                    return;
                }
                
                generateBtn.disabled = true;
                generateBtn.innerHTML = '<span class="spinner"></span> Generating PDF...';
                
                // Add PDF mode class to remove underlines
                document.getElementById('document-to-print').classList.add('pdf-mode');
                
                // Force black color for all text before capturing
                const elements = document.querySelectorAll('.preview-field, .embedded-field, .content-text, .time-field, .time-suffix, .document-title');
                elements.forEach(el => {
                    el.style.color = '#000000';
                    el.style.backgroundColor = '#FFFFFF';
                });
                
                // Set the preview container to A4 dimensions for accurate capture
                const previewElement = document.getElementById('document-to-print');
                const originalWidth = previewElement.style.width;
                const originalHeight = previewElement.style.height;
                
                previewElement.style.width = '595px';
                previewElement.style.height = '842px';
                
                html2canvas(previewElement, {
                    scale: 2,
                    logging: false,
                    useCORS: true,
                    allowTaint: true,
                    backgroundColor: '#FFFFFF',
                    width: 595,
                    height: 842
                }).then(canvas => {
                    // Restore original dimensions
                    previewElement.style.width = originalWidth;
                    previewElement.style.height = originalHeight;
                    
                    const pdf = new jsPDF('p', 'px', 'a4');
                    const imgData = canvas.toDataURL('image/png');
                    
                    // Calculate dimensions to fit A4
                    const pdfWidth = pdf.internal.pageSize.getWidth();
                    const pdfHeight = pdf.internal.pageSize.getHeight();
                    
                    // Add image to PDF - fill the entire A4 page
                    pdf.addImage(imgData, 'PNG', 0, 0, pdfWidth, pdfHeight);
                    
                    const today = new Date();
                    const dateString = today.toISOString().split('T')[0];
                    pdf.save(`POLICE_PASSPORT_${dateString}.pdf`);
                    
                    generateBtn.disabled = false;
                    generateBtn.innerHTML = '<i class="fas fa-file-pdf"></i> Generate PDF';
                    
                    // Remove PDF mode class
                    document.getElementById('document-to-print').classList.remove('pdf-mode');
                    
                    showNotification('PDF generated successfully!', 'success');
                }).catch(error => {
                    console.error('Error generating PDF:', error);
                    showNotification('Error generating PDF. Please try again.', 'error');
                    generateBtn.disabled = false;
                    generateBtn.innerHTML = '<i class="fas fa-file-pdf"></i> Generate PDF';
                    
                    // Restore original dimensions in case of error
                    previewElement.style.width = originalWidth;
                    previewElement.style.height = originalHeight;
                    
                    // Remove PDF mode class in case of error
                    document.getElementById('document-to-print').classList.remove('pdf-mode');
                });
            });
        });
    </script>
</body>
</html>
