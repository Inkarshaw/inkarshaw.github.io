<!DOCTYPE html>
<html lang="ta">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>காவல்துறை ஆவணம் PDF ஜெனரேட்டர்</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css" rel="stylesheet">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <style>
        :root {
            --a4-width: 210mm;
            --a4-height: 297mm;
            --page-margin: 20mm;
        }

        body {
            font-family: 'Helvetica', Arial, sans-serif;
            background-color: #2c3e50;
            padding: 15px;
            margin: 0;
        }

        .container-fluid {
            padding: 10px;
            height: 100vh;
        }

        .header {
            text-align: center;
            margin-bottom: 20px;
            padding: 15px;
            background: white;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }

        .tamil-title {
            font-size: 24px;
            font-weight: bold;
            color: #2c3e50;
            margin: 0;
        }

        /* Main Layout */
        .main-content {
            display: flex;
            height: calc(100vh - 120px);
            gap: 15px;
        }

        /* Input Panel */
        .input-panel {
            width: 400px;
            background: white;
            border-radius: 8px;
            padding: 20px;
            overflow-y: auto;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }

        /* Preview Panel */
        .preview-panel {
            flex: 1;
            background: #f8f9fa;
            border-radius: 8px;
            padding: 20px;
            display: flex;
            flex-direction: column;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }

        /* A4 Preview Container */
        .a4-preview-container {
            flex: 1;
            display: flex;
            justify-content: center;
            align-items: center;
            overflow: auto;
            background: #6c757d;
            border-radius: 4px;
            padding: 20px;
            position: relative;
        }

        /* A4 Page */
        .a4-page {
            width: var(--a4-width);
            min-height: var(--a4-height);
            background: white;
            box-shadow: 0 5px 30px rgba(0,0,0,0.3);
            position: relative;
        }

        /* Document Content */
        .document-content {
            font-family: 'Latha', 'Times New Roman', serif;
            line-height: 1.6;
            font-size: 11pt;
            height: 100%;
            padding: var(--page-margin);
            box-sizing: border-box;
        }

        /* Form Elements */
        .form-label {
            font-weight: bold;
            margin-top: 15px;
            color: #2c3e50;
            font-size: 14px;
        }

        .form-control {
            font-size: 14px;
            padding: 8px 12px;
            margin-bottom: 5px;
        }

        textarea.form-control {
            resize: vertical;
            min-height: 60px;
        }

        /* Controls */
        .controls {
            margin-top: 20px;
            padding-top: 15px;
            border-top: 1px solid #dee2e6;
        }

        .btn-action {
            width: 100%;
            padding: 10px;
            margin-bottom: 10px;
            font-size: 14px;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }

        /* Title Dropdown for Witness Only */
        .title-section {
            display: flex;
            gap: 10px;
            margin-bottom: 15px;
        }

        .title-select {
            width: 120px;
        }

        .name-input {
            flex: 1;
        }

        /* Responsive */
        @media (max-width: 1200px) {
            .main-content {
                flex-direction: column;
                height: auto;
            }

            .input-panel {
                width: 100%;
                max-height: 50vh;
            }

            .a4-preview-container {
                min-height: 500px;
            }
        }

        /* Print styles */
        @media print {
            .no-print {
                display: none !important;
            }

            .a4-page {
                box-shadow: none !important;
                margin: 0 !important;
            }
        }
    </style>
</head>
<body>
    <div class="container-fluid">
        <div class="header">
            <h1 class="tamil-title">காவல்துறை ஆவணம் PDF ஜெனரேட்டர்</h1>
            <p class="mb-0 text-muted">Preview மற்றும் PDF சரியாக ஒரே மாதிரி</p>
        </div>

        <div class="main-content">
            <!-- Input Panel -->
            <div class="input-panel no-print">
                <h5 class="mb-4">ஆவண விவரங்களை நிரப்புக</h5>

                <!-- Form Fields -->
                <div class="mb-3">
                    <label class="form-label">காவல் நிலையத்தின் பெயர்:</label>
                    <input type="text" class="form-control" id="policeStation" value="சேத்துப்பட்டு காவல் நிலையம்" oninput="updatePreview()">
                </div>

                <!-- வட்டாட்சியர் - NO DROPDOWN, ONLY NAME FIELD -->
                <div class="mb-3">
                    <label class="form-label">எழும்புர் வட்டாட்சியர்:</label>
                    <input type="text" class="form-control" id="collectorName" value="வட்டாட்சியர்" oninput="updatePreview()">
                </div>

                <!-- சாட்சி எண் -->
                <div class="mb-3">
                    <label class="form-label">சாட்சி எண்:</label>
                    <input type="text" class="form-control" id="witnessNumber" value="PW 1" oninput="updatePreview()" placeholder="எ.கா: PW 1, PW 2">
                </div>

                <!-- சாட்சி விவரங்கள் -->
                <div class="mb-3">
                    <label class="form-label">சாட்சி விவரங்கள்:</label>
                    <div class="title-section mb-2">
                        <select class="form-control title-select" id="witnessTitle" onchange="updatePreview()">
                            <option value="திரு.">திரு.</option>
                            <option value="திருமதி." selected>திருமதி.</option>
                            <option value="செல்வி.">செல்வி.</option>
                            <option value="">(இல்லை)</option>
                        </select>
                        <input type="text" class="form-control name-input" id="witnessName" value="மாலதி" oninput="updatePreview()">
                    </div>
                    <div class="row">
                        <div class="col-6">
                            <input type="text" class="form-control" id="witnessAge" placeholder="வயது" value="31" oninput="updatePreview()">
                        </div>
                        <div class="col-6">
                            <input type="text" class="form-control" id="witnessFather" placeholder="தந்தை பெயர்" value="டி. சந்திரன்" oninput="updatePreview()">
                        </div>
                    </div>
                </div>

                <div class="mb-3">
                    <label class="form-label">சாட்சி முகவரி:</label>
                    <textarea class="form-control" id="witnessAddress" rows="2" oninput="updatePreview()">எண் 7, வள்ளுவர் சாலை, செத்துப்பட்டு, சென்னை 600031</textarea>
                </div>

                <div class="mb-3">
                    <label class="form-label">தேதி:</label>
                    <input type="date" class="form-control" id="documentDate" value="2025-12-22" oninput="updatePreview()">
                </div>

                <div class="mb-3">
                    <label class="form-label">குற்ற எண்:</label>
                    <input type="text" class="form-control" id="caseNumber" value="1249/2012" oninput="updatePreview()">
                </div>

                <div class="mb-3">
                    <label class="form-label">குற்ற விதிகள்:</label>
                    <input type="text" class="form-control" id="caseSections" value="452, 326, 427, 506(i) IPC மற்றும் 109 CrPC 34 IPC" oninput="updatePreview()">
                </div>

                <div class="mb-3">
                    <label class="form-label">கூடுதல் விளக்கம்:</label>
                    <textarea class="form-control" id="additionalInfo" rows="3" oninput="updatePreview()">பார்வையில் கண்ட பு7 செத்துப்பட்டு காவல் நிலைய குற்ற வழக்கில் அரசு தரப்பு சாட்சி எண் 1 (Pறு-1) திருமதி மாலதி, வயது 31, தந்தை டி. சந்திரன், எண் 7, வள்ளுவர் சாலை, செத்துப்பட்டு, சென்னை 600031 என்பவரை நீதிமன்ற விசாரணைக்கு அழைக்க பலமுறை முயற்சித்தும் அவர் முன்பு விலாசத்தில் இல்லாததால் நீதிமன்ற விசாரணைக்கு அழைக்க இயலவில்லை. முன்பு நபரை பற்றி எந்த தகவலும் இல்லை.</textarea>
                </div>

                <!-- Controls -->
                <div class="controls">
                    <button class="btn btn-primary btn-action" onclick="generatePDF()">
                        <i class="bi bi-file-pdf"></i> PDF உருவாக்கு & பதிவிறக்கம்
                    </button>

                    <button class="btn btn-success btn-action" onclick="printDocument()">
                        <i class="bi bi-printer"></i> ஆவணத்தை அச்சிடுக
                    </button>

                    <button class="btn btn-warning btn-action" onclick="resetForm()">
                        <i class="bi bi-arrow-clockwise"></i> படிவத்தை மீட்டமை
                    </button>
                </div>
            </div>

            <!-- Preview Panel -->
            <div class="preview-panel">
                <div class="d-flex justify-content-between align-items-center mb-3">
                    <h5 class="mb-0">A4 ஆவண முன்னோட்டம்</h5>
                    <span class="badge bg-success">Preview = PDF</span>
                </div>

                <!-- A4 Preview Container -->
                <div class="a4-preview-container">
                    <!-- A4 Page -->
                    <div class="a4-page" id="a4Page">
                        <div class="document-content" id="previewContent">
                            <!-- Preview content will be generated here -->
                        </div>
                    </div>
                </div>

                <div class="text-center mt-3 no-print">
                    <p class="text-muted mb-0">A4 பக்க அளவு: 210mm × 297mm | தமிழ் எழுத்துரு: Latha</p>
                    <p class="text-muted mb-0"><strong>குறிப்பு:</strong> மேலே உள்ள preview சரியாக PDF இல் வரும்</p>
                </div>
            </div>
        </div>
    </div>

    <!-- Hidden div for PDF generation -->
    <div id="pdfContent" style="display: none;"></div>

    <!-- Bootstrap Icons -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.8.1/font/bootstrap-icons.css">

    <script>
        // Initialize jsPDF
        const { jsPDF } = window.jspdf;

        // Function to get full name with title (for witness only)
        function getFullName(title, name) {
            if (!title || title === '(இல்லை)') {
                return name || '';
            }
            return `${title} ${name}`.trim();
        }

        // Function to update preview with form values
        function updatePreview() {
            // Get form values
            const policeStation = document.getElementById('policeStation').value || 'காவல் நிலையம்';

            // Get வட்டாட்சியர் - NO TITLE, JUST NAME
            const collectorName = document.getElementById('collectorName').value || 'வட்டாட்சியர்';

            // Get சாட்சி எண்
            const witnessNumber = document.getElementById('witnessNumber').value || 'PW 1';

            // Get சாட்சி விவரங்கள்
            const witnessTitle = document.getElementById('witnessTitle').value;
            const witnessName = document.getElementById('witnessName').value || 'சாட்சி';
            const fullWitnessName = getFullName(witnessTitle, witnessName);

            const witnessAge = document.getElementById('witnessAge').value || 'வயது';
            const witnessFather = document.getElementById('witnessFather').value || 'தந்தை பெயர்';
            const witnessAddress = document.getElementById('witnessAddress').value || 'முகவரி';

            const documentDate = document.getElementById('documentDate').value;
            const caseNumber = document.getElementById('caseNumber').value || 'குற்ற எண்';
            const caseSections = document.getElementById('caseSections').value || 'குற்ற விதிகள்';
            const additionalInfo = document.getElementById('additionalInfo').value || 'கூடுதல் விளக்கம்';

            // Format date
            let formattedDate = 'தேதி';
            if (documentDate) {
                const dateObj = new Date(documentDate);
                formattedDate = `${dateObj.getDate().toString().padStart(2, '0')}.${(dateObj.getMonth()+1).toString().padStart(2, '0')}.${dateObj.getFullYear()}`;
            }

            // Create preview HTML
            const previewHTML = `
                <!-- Header -->
                <div style="text-align: center; margin-bottom: 30px; padding-top: 5px;">
                    <div style="font-size: 22pt; font-weight: bold; margin-bottom: 5px; font-family: 'Latha', serif;">காவல்துறை</div>
                    <div style="height: 2px; background: #000; width: 100px; margin: 0 auto;"></div>
                </div>
                
                <!-- Sender and Receiver Addresses -->
                <div style="display: flex; justify-content: space-between; margin-bottom: 35px;">
                    <!-- Sender -->
                    <div style="width: 48%;">
                        <div style="font-weight: bold; margin-bottom: 10px; font-size: 10.5pt; font-family: 'Latha', serif;">அனுப்புநர்</div>
                        <div style="line-height: 1.8; font-size: 10.5pt; font-family: 'Latha', serif;">
                            <div>காவல் ஆய்வாளர்</div>
                            <div>${policeStation}</div>
                            <div>சேத்துப்பட்டு, சென்னை 600031</div>
                        </div>
                    </div>
                    
                    <!-- Receiver -->
                    <div style="width: 48%;">
                        <div style="font-weight: bold; margin-bottom: 10px; font-size: 10.5pt; font-family: 'Latha', serif;">பெறுநர்</div>
                        <div style="line-height: 1.8; font-size: 10.5pt; font-family: 'Latha', serif;">
                            <div>${collectorName} அவர்கள்</div>
                            <div>எழும்புர் வட்டாட்சியர் அலுவலகம்</div>
                            <div>சேத்துப்பட்டு, சென்னை 600031</div>
                        </div>
                    </div>
                </div>
                
                <!-- Date -->
                <div style="text-align: right; margin-bottom: 30px;">
                    <div style="font-weight: bold; font-size: 10.5pt; font-family: 'Latha', serif;">நாள்: ${formattedDate}</div>
                </div>
                
                <!-- Reference -->
                <div style="margin-bottom: 25px;">
                    <div style="margin-bottom: 8px; font-size: 10.5pt; font-family: 'Latha', serif;">
                        <span style="font-weight: bold;">ஐயா</span><br>
                        <span style="font-weight: bold;">பார்வை:</span> காவல் நிலை குற்ற எண் ${caseNumber} U/s ${caseSections}
                    </div>
                </div>
                
                <!-- Subject -->
                <div style="margin-bottom: 25px;">
                    <div style="font-weight: bold; margin-bottom: 8px; font-size: 10.5pt; font-family: 'Latha', serif;">டிபாருள்:</div>
                    <div style="text-align: justify; line-height: 1.8; font-size: 10.5pt; font-family: 'Latha', serif;">
                        பார்வையில் கண்ட வழக்கில் சாட்சியாக உள்ளவரின் விலாசம் மற்றும் விபரம் பற்றி விசாரித்து சான்றிதழ் அளிக்க வேண்டுகிறது.
                    </div>
                </div>
                
                <!-- Main Content -->
                <div style="margin-bottom: 25px;">
                    <div style="text-align: justify; line-height: 1.8; font-size: 10.5pt; font-family: 'Latha', serif; margin-bottom: 15px;">
                        ${additionalInfo.replace('சாட்சி எண் 1', `சாட்சி எண் ${witnessNumber}`)}
                    </div>
                    <div style="text-align: justify; line-height: 1.8; font-size: 10.5pt; font-family: 'Latha', serif;">
                        எனவே பார்வையில் கண்ட வழக்கு தொடர்பாக நீதிமன்ற நடவடிக்கைக்கு முன்பு நபரின் தற்போதைய விலாசம் பற்றி விசாரணை செய்து சான்றிதழ் வழங்குமாறு கேட்டுக்கொள்ளப்படுகிறது.
                    </div>
                </div>
                
                <!-- Signature -->
                <div style="margin-top: 70px; text-align: right;">
                    <div style="width: 280px; border-top: 1px solid #000; padding-top: 8px; display: inline-block; text-align: center;">
                        <div style="font-weight: bold; margin-bottom: 5px; font-size: 10.5pt; font-family: 'Latha', serif;">காவல் ஆய்வாளர்</div>
                        <div style="margin-bottom: 3px; font-size: 10.5pt; font-family: 'Latha', serif;">${policeStation}</div>
                    </div>
                </div>
            `;

            // Update preview
            document.getElementById('previewContent').innerHTML = previewHTML;

            // Update the hidden PDF content with the SAME HTML
            document.getElementById('pdfContent').innerHTML = `
                <div class="a4-page" style="width: 210mm; min-height: 297mm; background: white; font-family: 'Latha', serif; padding: 20mm; box-sizing: border-box;">
                    ${previewHTML}
                </div>
            `;
        }

        // Function to reset form
        function resetForm() {
            document.getElementById('policeStation').value = 'சேத்துப்பட்டு காவல் நிலையம்';

            // வட்டாட்சியர் - NO TITLE
            document.getElementById('collectorName').value = 'வட்டாட்சியர்';

            // சாட்சி எண்
            document.getElementById('witnessNumber').value = 'PW 1';

            // சாட்சி விவரங்கள்
            document.getElementById('witnessTitle').value = 'திருமதி.';
            document.getElementById('witnessName').value = 'மாலதி';
            document.getElementById('witnessAge').value = '31';
            document.getElementById('witnessFather').value = 'டி. சந்திரன்';
            document.getElementById('witnessAddress').value = 'எண் 7, வள்ளுவர் சாலை, செத்துப்பட்டு, சென்னை 600031';

            document.getElementById('documentDate').value = '2025-12-22';
            document.getElementById('caseNumber').value = '1249/2012';
            document.getElementById('caseSections').value = '452, 326, 427, 506(i) IPC மற்றும் 109 CrPC 34 IPC';
            document.getElementById('additionalInfo').value = 'பார்வையில் கண்ட பு7 செத்துப்பட்டு காவல் நிலைய குற்ற வழக்கில் அரசு தரப்பு சாட்சி எண் 1 திருமதி மாலதி, வயது 31, தந்தை டி. சந்திரன், எண் 7, வள்ளுவர் சாலை, செத்துப்பட்டு, சென்னை 600031 என்பவரை நீதிமன்ற விசாரணைக்கு அழைக்க பலமுறை முயற்சித்தும் அவர் முன்பு விலாசத்தில் இல்லாததால் நீதிமன்ற விசாரணைக்கு அழைக்க இயலவில்லை. முன்பு நபரை பற்றி எந்த தகவலும் இல்லை.';

            updatePreview();
        }

        // Function to generate and download PDF
        function generatePDF() {
            updatePreview(); // Ensure latest content

            // Get the preview element
            const previewElement = document.getElementById('a4Page');

            // Create a clone of the preview element
            const clone = previewElement.cloneNode(true);
            clone.style.position = 'absolute';
            clone.style.left = '-9999px';
            clone.style.boxShadow = 'none';
            document.body.appendChild(clone);

            // Use html2canvas to capture the content
            html2canvas(clone, {
                scale: 2,
                useCORS: true,
                logging: false,
                backgroundColor: '#ffffff',
                width: clone.offsetWidth,
                height: clone.offsetHeight
            }).then(canvas => {
                // Remove clone
                document.body.removeChild(clone);

                const imgData = canvas.toDataURL('image/png', 1.0);
                const pdf = new jsPDF({
                    orientation: 'portrait',
                    unit: 'mm',
                    format: 'a4'
                });

                // Calculate dimensions to fit A4 exactly
                const pageWidth = pdf.internal.pageSize.getWidth();
                const pageHeight = pdf.internal.pageSize.getHeight();

                // Add image to PDF
                pdf.addImage(imgData, 'PNG', 0, 0, pageWidth, pageHeight);

                // Save the PDF
                const timestamp = new Date().toISOString().slice(0,10).replace(/-/g, '');
                pdf.save(`காவல்துறை_ஆவணம்_${timestamp}.pdf`);

                // Show success message
                showNotification('PDF வெற்றிகரமாக உருவாக்கப்பட்டது!', 'success');
            }).catch(error => {
                console.error('Error generating PDF:', error);
                showNotification('PDF உருவாக்கும் போது பிழை ஏற்பட்டது.', 'error');
            });
        }

        // Function to print the document
        function printDocument() {
            updatePreview();

            // Create print window
            const printContent = `
                <!DOCTYPE html>
                <html>
                <head>
                    <title>காவல்துறை ஆவணம்</title>
                    <style>
                        @media print {
                            @page {
                                size: A4;
                                margin: 20mm;
                            }
                            body {
                                margin: 0;
                                padding: 0;
                            }
                        }
                        
                        body {
                            font-family: 'Latha', serif;
                            margin: 0;
                            padding: 20mm;
                            width: 210mm;
                            min-height: 297mm;
                            box-sizing: border-box;
                            font-size: 11pt;
                            line-height: 1.6;
                        }
                    </style>
                </head>
                <body>
                    ${document.getElementById('previewContent').innerHTML}
                </body>
                </html>
            `;

            const printWindow = window.open('', '_blank');
            printWindow.document.write(printContent);
            printWindow.document.close();
            printWindow.focus();

            setTimeout(() => {
                printWindow.print();
                printWindow.close();
                showNotification('அச்சிடல் தொடங்கப்பட்டது...', 'info');
            }, 500);
        }

        // Function to show notification
        function showNotification(message, type) {
            const notification = document.createElement('div');
            notification.className = `alert alert-${type} alert-dismissible fade show position-fixed`;
            notification.style.cssText = `
                position: fixed;
                top: 20px;
                right: 20px;
                z-index: 9999;
                min-width: 300px;
                animation: slideIn 0.3s ease;
            `;

            notification.innerHTML = `
                ${message}
                <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
            `;

            document.body.appendChild(notification);

            setTimeout(() => {
                notification.remove();
            }, 3000);
        }

        // Initialize on page load
        document.addEventListener('DOMContentLoaded', function() {
            updatePreview();

            // Add CSS for animation
            const style = document.createElement('style');
            style.textContent = `
                @keyframes slideIn {
                    from {
                        transform: translateX(100%);
                        opacity: 0;
                    }
                    to {
                        transform: translateX(0);
                        opacity: 1;
                    }
                }
            `;
            document.head.appendChild(style);
        });
    </script>
</body>
</html>
