<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">

<title>Indian Polity ‚Äì Citizenship Quiz</title>

<style>
body{font-family:Arial,sans-serif;background:#f5f7fb;margin:0}
header{background:#1e40af;color:#fff;padding:15px;text-align:center}
.container{max-width:1000px;margin:auto;padding:15px}
.box{background:#fff;padding:20px;border-radius:12px;margin-bottom:15px}

#splash{
  position:fixed;inset:0;background:#1e40af;color:#fff;
  display:flex;align-items:center;justify-content:center;
  font-size:22px;z-index:9999;
}

#toast{
  position:fixed;bottom:40px;left:50%;
  transform:translateX(-50%);
  background:#111;color:#fff;
  padding:10px 16px;border-radius:20px;
  font-size:14px;display:none;z-index:9999;
}

.settings-row{display:flex;gap:15px;margin-bottom:15px}
.setting{flex:1}
.setting input,.setting select{
  width:100%;padding:8px;border-radius:6px;border:1px solid #cbd5e1
}

.options label{
  display:block;background:#f1f5f9;padding:10px;
  margin:8px 0;border-radius:6px
}

button{padding:10px 18px;border:none;border-radius:20px;cursor:pointer}
.start{background:#16a34a;color:#fff}
.next{background:#2563eb;color:#fff}
.submit{background:#dc2626;color:#fff;margin-left:8px}

.timer{font-weight:bold;color:#dc2626;margin-bottom:10px}

.palette-wrapper{
  border:1px solid #e5e7eb;border-radius:8px;
  padding:8px;margin-bottom:15px;overflow-x:auto
}
.palette{display:flex;gap:8px}
.palette div{
  min-width:40px;padding:8px;text-align:center;
  border-radius:6px;cursor:pointer;background:#e5e7eb
}
.palette .current{background:#1e40af;color:#fff}
.palette .answered{background:#16a34a;color:#fff}
.palette .visited{background:#93c5fd}

.correct{
  background:#dcfce7;
  color:#166534;
  padding:6px;
  border-radius:6px;
}
.wrong{
  background:#fee2e2;
  color:#991b1b;
  padding:6px;
  border-radius:6px;
}
</style>
</head>

<body>

<div id="splash">Exam Practice App</div>
<div id="toast"></div>

<header><h2>Indian Polity ‚Äì Citizenship Quiz</h2></header>

<div class="container">

<!-- SETTINGS -->
<div class="box" id="settingsBox">
<h3>‚öôÔ∏è Quiz Settings</h3>

<div class="settings-row">
<div class="setting">
<label>No. of Questions</label>
<select id="questionCount">
<option value="5">5</option>
<option value="10" selected>10</option>
<option value="20">20</option>
<option value="all">All</option>
</select>
</div>
<div class="setting">
<label>Time (Minutes)</label>
<input type="number" id="timeLimit" value="10">
</div>
</div>

<div class="settings-row">
<div class="setting"><label>From</label><input type="number" id="rangeFrom"></div>
<div class="setting"><label>To</label><input type="number" id="rangeTo"></div>
</div>

<p id="rangeInfo"></p>
<label><input type="checkbox" id="randomize"> Randomize</label><br><br>
<button class="start" onclick="startQuiz()">Start Quiz</button>
</div>

<!-- QUIZ -->
<div class="box" id="quizBox" style="display:none">
<div class="timer" id="timer"></div>

<div class="palette-wrapper">
<div class="palette" id="palette"></div>
</div>

<div id="question"></div>
<div class="options" id="options"></div>

<button class="next" onclick="nextQ()">Next</button>
<button class="submit" onclick="confirmSubmit()">Submit</button>
</div>

<div id="reviewBox"></div>

</div>

<script>
setTimeout(()=>splash.style.display="none",2000);

function showToast(msg){
  toast.innerText=msg;
  toast.style.display="block";
  setTimeout(()=>toast.style.display="none",2000);
}

const sheetURL="https://docs.google.com/spreadsheets/d/e/2PACX-1vTArgFXO2ruYakaftJnxqdtFNGpOcumKIY9g-bS8IiD1UmtGe2kYzM_iGz0yB6TvPCj1fdkzxOn1IVC/pub?output=csv";

let allQuestions=[],quiz=[],index=0,userAnswers=[];
let timerInterval,quizStarted=false;
let wrongIndexes=[],unattemptedIndexes=[];
let reviewIndex=0,reviewList=[];
let backOnce=false;

fetch(sheetURL).then(r=>r.text()).then(t=>{
const rows=t.trim().split("\n").slice(1);
allQuestions=rows.map(r=>{
const c=r.split(/,(?=(?:(?:[^"]*"){2})*[^"]*$)/);
return{q:c[0],opts:c.slice(1,5),ans:c[5].trim().toUpperCase(),exp:c[6]};
});
rangeFrom.value=1;
rangeTo.value=allQuestions.length;
rangeInfo.innerText=`Available questions: 1 to ${allQuestions.length}`;
});

function startQuiz(){
let from=+rangeFrom.value,to=+rangeTo.value;
let count=questionCount.value;
let random=randomize.checked;
let minutes=+timeLimit.value||10;

quiz=[...allQuestions].slice(from-1,to);
if(random) quiz.sort(()=>Math.random()-0.5);
if(count!=="all") quiz=quiz.slice(0,+count);

index=0;
userAnswers=new Array(quiz.length).fill(null);
settingsBox.style.display="none";
quizBox.style.display="block";
quizStarted=true;

createPalette();
startTimer(minutes*60);
loadQ();
}

function startTimer(sec){
let timeLeft=sec;
timerInterval=setInterval(()=>{
let m=Math.floor(timeLeft/60),s=timeLeft%60;
timer.innerText=`Time Left: ${m}:${String(s).padStart(2,"0")}`;
if(timeLeft--<=0){clearInterval(timerInterval);submitQuiz();}
},1000);
}

function createPalette(){
palette.innerHTML="";
quiz.forEach((_,i)=>{
let d=document.createElement("div");
d.innerText=i+1;
d.onclick=()=>jumpQ(i);
palette.appendChild(d);
});
}

function updatePalette(){
document.querySelectorAll(".palette div").forEach((d,i)=>{
d.className="";
if(i===index) d.classList.add("current");
else if(userAnswers[i]) d.classList.add("answered");
else d.classList.add("visited");
});
}

function loadQ(){
let q=quiz[index];
question.innerHTML=`<h3>Q${index+1}. ${q.q}</h3>`;
options.innerHTML="";
q.opts.forEach((o,i)=>{
let l=String.fromCharCode(65+i);
options.innerHTML+=`
<label>
<input type="radio" name="opt" value="${l}" ${userAnswers[index]==l?"checked":""}>
<b>${l}.</b> ${o}
</label>`;
});
updatePalette();
}

function saveAnswer(){
let s=document.querySelector('input[name="opt"]:checked');
userAnswers[index]=s?s.value:null;
}

function nextQ(){saveAnswer();index<quiz.length-1?(index++,loadQ()):submitQuiz();}
function jumpQ(i){saveAnswer();index=i;loadQ();}
function confirmSubmit(){saveAnswer();if(confirm("Submit quiz?")) submitQuiz();}

function submitQuiz(){
clearInterval(timerInterval);
quizBox.style.display="none";
quizStarted=false;

let score=0;
wrongIndexes=[];unattemptedIndexes=[];

quiz.forEach((q,i)=>{
if(!userAnswers[i]) unattemptedIndexes.push(i);
else if(userAnswers[i]!==q.ans) wrongIndexes.push(i);
else score++;
});

reviewBox.innerHTML=`
<div class="box">
<h2>üìä Result</h2>
<p><b>Score:</b> ${score} / ${quiz.length}</p>

<button class="next" onclick="startReattempt('wrong')">
üîÅ Reattempt Wrong (${wrongIndexes.length})
</button>

<button class="next" onclick="startReattempt('unattempted')">
üîÅ Reattempt Unattempted (${unattemptedIndexes.length})
</button>

<button class="submit" onclick="startReview()">
üìÑ Review One by One
</button>
</div>`;
}

function startReattempt(type){
reviewList=type==="wrong"?wrongIndexes:unattemptedIndexes;
if(reviewList.length===0){alert("No questions");return;}
quiz=reviewList.map(i=>quiz[i]);
userAnswers=new Array(quiz.length).fill(null);
index=0;
reviewBox.innerHTML="";
quizBox.style.display="block";
createPalette();
loadQ();
}

function startReview(){
reviewList=[...Array(quiz.length).keys()];
reviewIndex=0;
showReview();
}

function showReview(){
let i=reviewList[reviewIndex];
let q=quiz[i];
let user=userAnswers[i];
let correct=q.ans;

let optHTML="";
q.opts.forEach((opt,idx)=>{
let l=String.fromCharCode(65+idx);
let cls="";
if(l===correct) cls="correct";
if(l===user && user!==correct) cls="wrong";
optHTML+=`<div class="${cls}"><b>${l}.</b> ${opt}</div>`;
});

reviewBox.innerHTML=`
<div class="box">
<h3>Q${i+1}. ${q.q}</h3>
${optHTML}
<p>Your Answer: <b>${user||"Not Attempted"}</b></p>
<p>Correct Answer: <b>${correct}</b></p>
<p>${q.exp||""}</p>

<button class="next" onclick="reviewIndex>0&&(reviewIndex--,showReview())">‚¨Ö Prev</button>
<button class="next" onclick="reviewIndex<reviewList.length-1&&(reviewIndex++,showReview())">Next ‚û°</button>
</div>`;
}

history.pushState(null,null,location.href);
window.onpopstate=function(){
if(quizStarted){
showToast("Exit quiz? Progress will be lost");
history.pushState(null,null,location.href);
}else{
if(backOnce) return;
showToast("Press back again to exit");
backOnce=true;
setTimeout(()=>backOnce=false,2000);
history.pushState(null,null,location.href);
}
};
</script>

</body>
</html>
