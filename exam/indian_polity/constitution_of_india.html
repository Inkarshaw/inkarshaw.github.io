<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Online Quiz</title>

<style>
body{font-family:Arial,sans-serif;background:#f5f7fb;margin:0}
header{background:#1e40af;color:#fff;padding:15px;text-align:center}
.container{max-width:800px;margin:auto;padding:15px}
.question-box{background:#fff;padding:20px;border-radius:10px}
.options label{display:block;background:#f1f5f9;padding:10px;margin:8px 0;border-radius:6px;cursor:pointer}
button{margin-top:15px;padding:10px 20px;border:none;border-radius:20px;font-size:15px;cursor:pointer}
.next{background:#2563eb;color:#fff}
.submit{background:#16a34a;color:#fff;margin-left:10px}
.review{background:#fff;padding:15px;border-radius:10px;margin-top:15px}
.correct{color:green;font-weight:bold}
.wrong{color:red;font-weight:bold}
</style>
</head>

<body>

<header>
  <h2>Exam Practice Quiz</h2>
</header>

<div class="container">

  <div class="question-box" id="quizBox">
    <div id="question">Loading...</div>
    <div class="options" id="options"></div>

    <button class="next" id="nextBtn">Next</button>
    <button class="submit" id="submitBtn">Submit Quiz</button>
  </div>

  <div id="reviewBox"></div>

</div>

<script>
const sheetURL =
"https://docs.google.com/spreadsheets/d/e/2PACX-1vRhUA51WgTVQ7AnW8O136gYvtB_zKhPAyJU6vtR2-mghYEB0pPSZIqUT9q_kuDZSRrZENs1BfQAwDIf/pub?output=csv";

let quiz = [];
let index = 0;
let userAnswers = [];

fetch(sheetURL)
.then(r => r.text())
.then(text => {
  const rows = text.trim().split("\n").slice(1);
  quiz = rows.map(r => {
    const c = r.split(/,(?=(?:(?:[^"]*"){2})*[^"]*$)/);
    return {
      q: c[0],
      opts: c.slice(1,5),
      ans: c[5].trim(),
      exp: c[6]
    };
  });
  loadQ();
});

function loadQ(){
  const q = quiz[index];
  document.getElementById("question").innerHTML =
    `<h3>Q${index+1}. ${q.q}</h3>`;

  const o = document.getElementById("options");
  o.innerHTML = "";
  q.opts.forEach(opt=>{
    o.innerHTML += `
      <label>
        <input type="radio" name="opt" value="${opt}">
        ${opt}
      </label>`;
  });
}

document.getElementById("nextBtn").onclick = () => {
  const sel = document.querySelector('input[name="opt"]:checked');
  userAnswers[index] = sel ? sel.value : null;

  index++;
  if(index < quiz.length){
    loadQ();
  } else {
    alert("You have reached last question. Click Submit Quiz.");
  }
};

document.getElementById("submitBtn").onclick = () => {
  document.getElementById("quizBox").style.display="none";
  showReview();
};
function showReview(){
  let score = 0;
  let attempted = 0;
  let html = `<div class="review"><h2>Quiz Review</h2>`;

  quiz.forEach((q, i) => {

    // ❌ Skip unattempted questions
    if(userAnswers[i] === null || userAnswers[i] === undefined){
      return;
    }

    attempted++;

    const user = userAnswers[i];
    const correct = q.ans;
    const right = user === correct;

    if(right) score++;

    html += `
      <hr>
      <p><b>Q${i+1}. ${q.q}</b></p>
      <p>Your Answer: ${user}</p>
      <p>Correct Answer: ${correct}</p>
      <p class="${right ? 'correct' : 'wrong'}">
        ${right ? '✔ Correct' : '✖ Wrong'}
      </p>
      <p><b>Explanation:</b> ${q.exp}</p>
    `;
  });

  html += `
    <hr>
    <h3>Attempted: ${attempted} / ${quiz.length}</h3>
    <h3>Score: ${score} / ${attempted}</h3>
  </div>`;

  document.getElementById("reviewBox").innerHTML = html;
}
</script>

</body>
</html>
