<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport"
content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">

<title>Indian Polity – Constitution of India Quiz</title>

<style>
body{
  font-family:Arial,sans-serif;
  background:#f5f7fb;
  margin:0;
}
header{
  background:#1e40af;
  color:#fff;
  padding:15px;
  text-align:center;
}
.container{
  max-width:1000px;
  margin:auto;
  padding:15px;
}
.box{
  background:#fff;
  padding:20px;
  border-radius:12px;
  margin-bottom:15px;
}

/* SETTINGS */
.settings-row{
  display:flex;
  gap:15px;
  margin-bottom:15px;
}
.setting{
  flex:1;
}
.setting label{
  font-weight:bold;
}
.setting input,.setting select{
  width:100%;
  padding:8px;
  border-radius:6px;
  border:1px solid #cbd5e1;
}

/* OPTIONS */
.options label{
  display:block;
  background:#f1f5f9;
  padding:10px;
  margin:8px 0;
  border-radius:6px;
}

/* BUTTONS */
button{
  padding:10px 18px;
  border:none;
  border-radius:20px;
  cursor:pointer;
}
.start{background:#16a34a;color:#fff}
.next{background:#2563eb;color:#fff}
.submit{background:#dc2626;color:#fff;margin-left:10px}

/* TIMER */
.timer{
  font-weight:bold;
  color:#dc2626;
  margin-bottom:10px;
}

/* PALETTE */
.palette-wrapper{
  border:1px solid #e5e7eb;
  border-radius:8px;
  padding:8px;
  margin-bottom:15px;
}
.palette{
  display:flex;
  gap:8px;
}
.palette div{
  min-width:40px;
  padding:8px;
  text-align:center;
  border-radius:6px;
  cursor:pointer;
  background:#e5e7eb;
}
.palette .current{background:#1e40af;color:#fff}
.palette .answered{background:#16a34a;color:#fff}
.palette .visited{background:#93c5fd}

/* REVIEW */
.correct{color:green;font-weight:bold}
.wrong{color:red;font-weight:bold}
</style>
</head>

<body>

<header>
  <h2>Exam Practice Quiz</h2>
</header>

<div class="container">

<!-- SETTINGS -->
<div class="box" id="settingsBox">
  <h3>⚙️ Quiz Settings</h3>

  <div class="settings-row">
    <div class="setting">
      <label>No. of Questions</label>
      <select id="questionCount">
        <option value="5">5</option>
        <option value="10" selected>10</option>
        <option value="20">20</option>
        <option value="all">All</option>
      </select>
    </div>
    <div class="setting">
      <label>Time (Minutes)</label>
      <input type="number" id="timeLimit" value="10">
    </div>
  </div>

  <div class="settings-row">
    <div class="setting">
      <label>From</label>
      <input type="number" id="rangeFrom">
    </div>
    <div class="setting">
      <label>To</label>
      <input type="number" id="rangeTo">
    </div>
  </div>

  <p id="rangeInfo"></p>
  <label><input type="checkbox" id="randomize"> Randomize</label><br><br>

  <button class="start" onclick="startQuiz()">Start Quiz</button>
</div>

<!-- QUIZ -->
<div class="box" id="quizBox" style="display:none">
  <div class="timer" id="timer"></div>

  <div class="palette-wrapper">
    <div class="palette" id="palette"></div>
  </div>

  <div id="question"></div>
  <div class="options" id="options"></div>

  <button class="next" onclick="nextQ()">Next</button>
  <button class="submit" onclick="confirmSubmit()">Submit</button>
</div>

<div id="reviewBox"></div>

</div>

<script>
const sheetURL="https://docs.google.com/spreadsheets/d/e/2PACX-1vRhUA51WgTVQ7AnW8O136gYvtB_zKhPAyJU6vtR2-mghYEB0pPSZIqUT9q_kuDZSRrZENs1BfQAwDIf/pub?output=csv";

let allQuestions=[],quiz=[],index=0,userAnswers=[];
let quizStarted=false;

fetch(sheetURL).then(r=>r.text()).then(t=>{
  const rows=t.trim().split("\n").slice(1);
  allQuestions=rows.map(r=>{
    const c=r.split(/,(?=(?:(?:[^"]*"){2})*[^"]*$)/);
    return{q:c[0],opts:c.slice(1,5),ans:c[5].trim().toUpperCase(),exp:c[6]};
  });
  rangeFrom.value=1;
  rangeTo.value=allQuestions.length;
  rangeInfo.innerText=`Available: 1 to ${allQuestions.length}`;
});

/* START */
function startQuiz(){
  let from=+rangeFrom.value,to=+rangeTo.value;
  if(from<1||to>allQuestions.length||from>to){
    alert("Invalid range");
    return;
  }
  quiz=[...allQuestions].slice(from-1,to);
  index=0;
  userAnswers=new Array(quiz.length).fill(null);
  settingsBox.style.display="none";
  quizBox.style.display="block";
  quizStarted=true;
  createPalette();
  loadQ();
}

/* PALETTE */
function createPalette(){
  palette.innerHTML="";
  quiz.forEach((_,i)=>{
    let d=document.createElement("div");
    d.innerText=i+1;
    d.onclick=()=>jumpQ(i);
    palette.appendChild(d);
  });
}
function updatePalette(){
  document.querySelectorAll(".palette div").forEach((d,i)=>{
    d.className="";
    if(i===index) d.classList.add("current");
    else if(userAnswers[i]) d.classList.add("answered");
    else d.classList.add("visited");
  });
}

/* QUESTIONS */
function loadQ(){
  let q=quiz[index];
  question.innerHTML=`<h3>Q${index+1}. ${q.q}</h3>`;
  options.innerHTML="";
  q.opts.forEach((o,i)=>{
    let l=String.fromCharCode(65+i);
    options.innerHTML+=`
    <label>
      <input type="radio" name="opt" value="${l}"
      ${userAnswers[index]==l?"checked":""}>
      <b>${l}.</b> ${o}
    </label>`;
  });
  updatePalette();
}

function saveAnswer(){
  let s=document.querySelector('input[name="opt"]:checked');
  userAnswers[index]=s?s.value:null;
}
function nextQ(){
  saveAnswer();
  if(index<quiz.length-1){index++;loadQ();}
  else if(confirm("Submit quiz?")) submitQuiz();
}
function jumpQ(i){saveAnswer();index=i;loadQ();}

function confirmSubmit(){
  saveAnswer();
  if(confirm("Are you sure?")) submitQuiz();
}
function submitQuiz(){
  quizBox.style.display="none";
  quizStarted=false;
  reviewBox.innerHTML="<div class='box'><h2>Quiz Submitted</h2></div>";
}

/* APK BACK BUTTON */
history.pushState(null,null,location.href);
window.onpopstate=function(){
  if(quizStarted){
    if(confirm("Exit quiz? Progress will be lost.")){
      quizStarted=false;
      location.reload();
    }else{
      history.pushState(null,null,location.href);
    }
  }
};
</script>

</body>
</html>
