<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">

<title>Indian Polity – Multi-Part Quiz</title>

<style>
body{font-family:Arial,sans-serif;background:#f5f7fb;margin:0}
header{background:#1e40af;color:#fff;padding:15px;text-align:center}
.container{max-width:1000px;margin:auto;padding:15px}
.box{background:#fff;padding:20px;border-radius:12px;margin-bottom:15px}

select,input{
  width:100%;
  padding:10px;
  border-radius:8px;
  border:1px solid #d1d5db;
  font-size:15px
}

button{
  padding:10px 18px;
  border:none;
  border-radius:20px;
  cursor:pointer;
  margin:5px
}
.start{background:#16a34a;color:#fff}
.next{background:#2563eb;color:#fff}
.submit{background:#dc2626;color:#fff}
.reviewBtn{background:#7c3aed;color:#fff}

.timer{font-weight:bold;color:#dc2626;margin-bottom:10px}
.score{font-weight:bold;color:#166534;margin-bottom:10px}

.options label{
  display:block;
  padding:10px;
  margin:6px 0;
  border-radius:6px;
  background:#f1f5f9
}

.correct{background:#dcfce7;color:#166534;font-weight:bold}
.wrong{background:#fee2e2;color:#991b1b}

/* PALETTE */
.palette-wrapper{
  border:1px solid #e5e7eb;
  border-radius:8px;
  padding:8px;
  margin-bottom:15px;
  overflow-x:auto
}
.palette{display:flex;gap:8px}
.palette div{
  min-width:40px;
  padding:8px;
  text-align:center;
  border-radius:6px;
  background:#e5e7eb;
  cursor:pointer;
  user-select:none
}
.palette .current{background:#1e40af;color:#fff}
.palette .answered{background:#16a34a;color:#fff}
.palette .unanswered{background:#dc2626;color:#fff}

/* MULTI SELECT PARTS */
.parts{
  display:flex;
  flex-wrap:wrap;
  gap:10px;
  margin-top:8px
}
.parts label{
  background:#eef2ff;
  padding:6px 10px;
  border-radius:20px;
  cursor:pointer;
  font-size:14px
}
.parts input{margin-right:6px}
</style>
</head>

<body>

<header><h2>Indian Polity – Article-wise Quiz</h2></header>

<div class="container">

<!-- SETTINGS -->
<div class="box" id="settingsBox">
<h3>Quiz Settings</h3>

<label><b>Select Article Parts (Multiple)</b></label>
<div id="partContainer" class="parts"></div>
<br>

<label>No. of Questions</label>
<select id="questionCount">
<option>5</option>
<option>10</option>
<option>20</option>
<option selected>50</option>
</select>
<br><br>

<button class="start" onclick="startQuiz()">Start Quiz</button>
</div>

<!-- QUIZ -->
<div class="box" id="quizBox" style="display:none">
<div class="timer" id="timer"></div>

<div class="palette-wrapper">
  <div class="palette" id="palette"></div>
</div>

<div id="question"></div>
<div class="options" id="options"></div>

<button class="next" onclick="nextQ()">Next</button>
<button class="submit" onclick="confirmSubmit()">Submit</button>
</div>

<!-- RESULT -->
<div class="box" id="resultBox" style="display:none">
<div class="score" id="scoreBox"></div>
<button class="reviewBtn" onclick="reviewAll()">Review All</button>
<button class="reviewBtn" onclick="reattemptWrong()">Reattempt Wrong</button>
<button class="reviewBtn" onclick="reattemptUnanswered()">Reattempt Unanswered</button>
</div>

<!-- REVIEW -->
<div class="box" id="reviewBox" style="display:none">
<h3 id="reviewCount"></h3>
<div id="reviewQuestion"></div>
<div id="reviewOptions"></div>
<div id="reviewExp"></div>
<button onclick="prevReview()">⬅ Previous</button>
<button onclick="nextReview()">Next ➡</button>
</div>

</div>

<script>
const sheetURL =
"https://docs.google.com/spreadsheets/d/e/2PACX-1vSoofrGeEqZfnkiTKZOJ68ap8x70uC77dafP0psIy-GRn1gWyFCEl5bKCou24KZQqG_YBkL3dNmJlCI/pub?output=csv";

let allQuestions=[], quiz=[], index=0, userAnswers=[];
let reviewIndex=0, timerInt, timeLeft=0;

/* LOAD QUESTIONS */
fetch(sheetURL).then(r=>r.text()).then(t=>{
const rows=t.trim().split("\n").slice(1);

allQuestions = rows.map(r=>{
const c=r.split(/,(?=(?:(?:[^"]*"){2})*[^"]*$)/);
return{
  q:c[0],
  opts:c.slice(1,5),
  ans:(c[5]||"").trim().toUpperCase(),
  exp:c[6]||"",
  part:(c[7]||"Uncategorized").trim()
};
});

/* BUILD MULTI-SELECT PARTS */
const uniqueParts=[...new Set(allQuestions.map(q=>q.part))].sort();
const box=document.getElementById("partContainer");

uniqueParts.forEach(p=>{
  box.innerHTML+=`
    <label>
      <input type="checkbox" value="${p.toLowerCase().trim()}">
      ${p}
    </label>`;
});
});

/* START QUIZ */
function startQuiz(){
const checked=[...document.querySelectorAll('#partContainer input:checked')]
  .map(i=>i.value);

let count=+questionCount.value;

let filtered = checked.length===0
  ? allQuestions
  : allQuestions.filter(q =>
      checked.includes(q.part.toLowerCase().trim())
    );

quiz = filtered.slice(0,count);
if(!quiz.length){alert("No questions for selected parts");return;}

userAnswers=new Array(quiz.length).fill(null);
index=0;

settingsBox.style.display="none";
quizBox.style.display="block";

startTimer();
createPalette();
loadQ();
}

/* TIMER */
function startTimer(){
clearInterval(timerInt);
timeLeft=quiz.length*60;
timerInt=setInterval(()=>{
let m=Math.floor(timeLeft/60),s=timeLeft%60;
timer.innerText=`Time Left: ${m}:${s.toString().padStart(2,"0")}`;
if(--timeLeft<0){clearInterval(timerInt);submitQuiz();}
},1000);
}

/* PALETTE */
function createPalette(){
palette.innerHTML="";
quiz.forEach((_,i)=>{
let d=document.createElement("div");
d.innerText=i+1;
d.onclick=()=>{saveAnswer();index=i;loadQ();}
palette.appendChild(d);
});
}

function updatePalette(){
document.querySelectorAll(".palette div").forEach((d,i)=>{
d.className="";
if(i===index)d.classList.add("current");
else if(userAnswers[i]!==null)d.classList.add("answered");
else d.classList.add("unanswered");
});
}

/* QUESTIONS */
function loadQ(){
let q=quiz[index];
question.innerHTML=`<h3>Q${index+1}. ${q.q}</h3>`;
options.innerHTML="";
q.opts.forEach((o,i)=>{
let l=String.fromCharCode(65+i);
options.innerHTML+=`
<label>
<input type="radio" name="opt" value="${l}" ${userAnswers[index]==l?"checked":""}>
<b>${l}.</b> ${o}
</label>`;
});
updatePalette();
}

function saveAnswer(){
let s=document.querySelector('input[name="opt"]:checked');
userAnswers[index]=s?s.value:null;
}

function nextQ(){
saveAnswer();
if(index<quiz.length-1){index++;loadQ();}
else confirmSubmit();
}

/* SUBMIT */
function confirmSubmit(){
saveAnswer();
let un=userAnswers.filter(a=>a===null).length;
if(un>0 && !confirm(`You have ${un} unanswered questions. Submit?`))return;
submitQuiz();
}

function submitQuiz(){
clearInterval(timerInt);
quizBox.style.display="none";
resultBox.style.display="block";
let score=0;
quiz.forEach((q,i)=>{if(userAnswers[i]===q.ans)score++;});
scoreBox.innerText=`Score: ${score} / ${quiz.length}`;
}

/* REVIEW */
function reviewAll(){
resultBox.style.display="none";
reviewBox.style.display="block";
reviewIndex=0;
loadReview();
}

function loadReview(){
let q=quiz[reviewIndex];
reviewCount.innerText=`Review ${reviewIndex+1}/${quiz.length}`;
reviewQuestion.innerHTML=`<b>${q.q}</b>`;
reviewOptions.innerHTML="";
q.opts.forEach((o,i)=>{
let l=String.fromCharCode(65+i),cls="";
if(l===q.ans)cls="correct";
if(userAnswers[reviewIndex]===l && l!==q.ans)cls="wrong";
reviewOptions.innerHTML+=`<div class="${cls}">${l}. ${o}</div>`;
});
reviewExp.innerHTML=`<b>Explanation:</b> ${q.exp||"—"}`;
}

function nextReview(){if(reviewIndex<quiz.length-1){reviewIndex++;loadReview();}}
function prevReview(){if(reviewIndex>0){reviewIndex--;loadReview();}}

/* REATTEMPT */
function reattemptWrong(){
filterReattempt((q,i)=>userAnswers[i]!==q.ans);
}
function reattemptUnanswered(){
filterReattempt((q,i)=>userAnswers[i]===null);
}
function filterReattempt(fn){
quiz=quiz.filter(fn);
userAnswers=new Array(quiz.length).fill(null);
index=0;
resultBox.style.display="none";
quizBox.style.display="block";
startTimer();
createPalette();
loadQ();
}
</script>

</body>
</html>