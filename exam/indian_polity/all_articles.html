<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<title>Indian Polity â€“ Article-wise Quiz</title>

<style>
/* ========== THEME VARIABLES ========== */
:root{
  --bg:#f5f7fb;
  --card:#ffffff;
  --text:#111827;
  --primary:#1e40af;
  --accent:#16a34a;
  --danger:#dc2626;
  --border:#e5e7eb;
}

body.dark{
  --bg:#0f172a;
  --card:#020617;
  --text:#e5e7eb;
  --primary:#3b82f6;
  --accent:#22c55e;
  --danger:#ef4444;
  --border:#334155;
}

/* ========== BASE ========== */
body{
  margin:0;
  font-family:Arial,sans-serif;
  background:var(--bg);
  color:var(--text);
}

header{
  background:var(--primary);
  color:#fff;
  padding:15px;
  text-align:center;
}

.container{
  max-width:1000px;
  margin:auto;
  padding:15px;
}

.box{
  background:var(--card);
  padding:20px;
  border-radius:12px;
  margin-bottom:15px;
  border:1px solid var(--border);
}

/* ========== STICKY FILTER BAR ========== */
.sticky{
  position:sticky;
  top:0;
  z-index:100;
}

/* ========== INPUTS ========== */
select,input{
  width:100%;
  padding:10px;
  border-radius:8px;
  border:1px solid var(--border);
  font-size:15px;
  background:var(--card);
  color:var(--text);
}

/* ========== BUTTONS ========== */
button{
  padding:8px 14px;
  border:none;
  border-radius:20px;
  cursor:pointer;
  margin:4px;
}

.start{background:var(--accent);color:#fff}
.next{background:var(--primary);color:#fff}
.submit{background:var(--danger);color:#fff}
.secondary{background:#64748b;color:#fff}

/* ========== FILTER CONTROLS ========== */
.filter-header{
  display:flex;
  justify-content:space-between;
  align-items:center;
  cursor:pointer;
}

.parts{
  display:grid;
  grid-template-columns:repeat(auto-fill,minmax(220px,1fr));
  gap:10px;
  margin-top:10px;
}

.parts label{
  display:flex;
  align-items:center;
  gap:8px;
  background:#eef2ff;
  padding:8px 12px;
  border-radius:20px;
  font-size:14px;
  cursor:pointer;
}

body.dark .parts label{background:#1e293b}

/* ========== QUIZ ========== */
.timer{font-weight:bold;color:var(--danger);margin-bottom:10px}

.palette-wrapper{
  border:1px solid var(--border);
  border-radius:8px;
  padding:8px;
  margin-bottom:15px;
  overflow-x:auto;
}

.palette{display:flex;gap:8px}
.palette div{
  min-width:40px;
  padding:8px;
  text-align:center;
  border-radius:6px;
  background:#cbd5e1;
  cursor:pointer;
}

.palette .current{background:var(--primary);color:#fff}
.palette .answered{background:var(--accent);color:#fff}
.palette .unanswered{background:var(--danger);color:#fff}

.options label{
  display:block;
  padding:10px;
  margin:6px 0;
  border-radius:6px;
  background:#e5e7eb;
}

body.dark .options label{background:#1e293b}

/* ========== DARK MODE TOGGLE ========== */
.toggle{
  display:flex;
  align-items:center;
  gap:6px;
  font-size:14px;
}
</style>
</head>

<body>

<header>
<h2>Indian Polity â€“ Article-wise Quiz</h2>
</header>

<div class="container">

<!-- ========== STICKY FILTER BAR ========== -->
<div class="box sticky" id="settingsBox">

<div class="filter-header" onclick="toggleFilters()">
  <h3>Quiz Filters</h3>
  <span id="collapseIcon">â¬†</span>
</div>

<div id="filterBody">

<div style="display:flex;justify-content:space-between;align-items:center">
  <b>Select Article Parts</b>
  <div>
    <button class="secondary" onclick="selectAllParts()">Select All</button>
    <button class="secondary" onclick="clearAllParts()">Clear All</button>
  </div>
</div>

<div id="partContainer" class="parts"></div>

<br>

<label>No. of Questions</label>
<select id="questionCount">
<option>5</option>
<option>10</option>
<option>20</option>
<option selected>50</option>
</select>

<br><br>

<div style="display:flex;justify-content:space-between;align-items:center">
  <button class="start" onclick="startQuiz()">Start Quiz</button>

  <div class="toggle">
    <input type="checkbox" onchange="toggleDarkMode(this)">
    ðŸŒ™ Dark
  </div>
</div>

</div>
</div>

<!-- ========== QUIZ ========== -->
<div class="box" id="quizBox" style="display:none">
<div class="timer" id="timer"></div>

<div class="palette-wrapper">
  <div class="palette" id="palette"></div>
</div>

<div id="question"></div>
<div class="options" id="options"></div>

<button class="next" onclick="nextQ()">Next</button>
<button class="submit" onclick="confirmSubmit()">Submit</button>
</div>

</div>

<script>
const sheetURL =
"https://docs.google.com/spreadsheets/d/e/2PACX-1vSoofrGeEqZfnkiTKZOJ68ap8x70uC77dafP0psIy-GRn1gWyFCEl5bKCou24KZQqG_YBkL3dNmJlCI/pub?output=csv";

let allQuestions=[],quiz=[],index=0,userAnswers=[];
let timerInt,timeLeft=0;

/* LOAD QUESTIONS */
fetch(sheetURL).then(r=>r.text()).then(t=>{
const rows=t.trim().split("\n").slice(1);
allQuestions=rows.map(r=>{
const c=r.split(/,(?=(?:(?:[^"]*"){2})*[^"]*$)/);
return{
  q:c[0],opts:c.slice(1,5),
  ans:(c[5]||"").trim().toUpperCase(),
  part:(c[7]||"Uncategorized").trim()
};
});

const parts=[...new Set(allQuestions.map(q=>q.part))].sort();
const box=document.getElementById("partContainer");
parts.forEach(p=>{
  box.innerHTML+=`
    <label>
      <input type="checkbox" value="${p.toLowerCase()}"> ${p}
    </label>`;
});
});

/* FILTER UI */
function toggleFilters(){
const body=document.getElementById("filterBody");
const icon=document.getElementById("collapseIcon");
body.style.display = body.style.display==="none" ? "block" : "none";
icon.textContent = body.style.display==="none" ? "â¬‡" : "â¬†";
}

function selectAllParts(){
document.querySelectorAll('#partContainer input')
  .forEach(c=>c.checked=true);
}
function clearAllParts(){
document.querySelectorAll('#partContainer input')
  .forEach(c=>c.checked=false);
}

/* DARK MODE */
function toggleDarkMode(cb){
document.body.classList.toggle("dark",cb.checked);
}

/* QUIZ */
function startQuiz(){
const selected=[...document.querySelectorAll('#partContainer input:checked')]
  .map(c=>c.value);

quiz = selected.length
 ? allQuestions.filter(q=>selected.includes(q.part.toLowerCase()))
 : allQuestions;

quiz=quiz.slice(0,+questionCount.value);
userAnswers=new Array(quiz.length).fill(null);
index=0;

settingsBox.style.display="none";
quizBox.style.display="block";

startTimer();
createPalette();
loadQ();
}

/* TIMER */
function startTimer(){
timeLeft=quiz.length*60;
timerInt=setInterval(()=>{
timer.innerText=`Time Left: ${Math.floor(timeLeft/60)}:${(timeLeft%60).toString().padStart(2,"0")}`;
if(--timeLeft<0){clearInterval(timerInt);alert("Time Up");}
},1000);
}

/* PALETTE */
function createPalette(){
palette.innerHTML="";
quiz.forEach((_,i)=>{
let d=document.createElement("div");
d.textContent=i+1;
d.onclick=()=>{saveAnswer();index=i;loadQ();}
palette.appendChild(d);
});
}

function updatePalette(){
[...palette.children].forEach((d,i)=>{
d.className="";
if(i===index)d.classList.add("current");
else if(userAnswers[i])d.classList.add("answered");
else d.classList.add("unanswered");
});
}

/* QUESTIONS */
function loadQ(){
const q=quiz[index];
question.innerHTML=`<h3>Q${index+1}. ${q.q}</h3>`;
options.innerHTML="";
q.opts.forEach((o,i)=>{
const l=String.fromCharCode(65+i);
options.innerHTML+=`
<label>
<input type="radio" name="opt" value="${l}" ${userAnswers[index]==l?"checked":""}>
<b>${l}.</b> ${o}
</label>`;
});
updatePalette();
}

function saveAnswer(){
const s=document.querySelector('input[name="opt"]:checked');
userAnswers[index]=s?s.value:null;
}

function nextQ(){
saveAnswer();
if(index<quiz.length-1){index++;loadQ();}
else confirmSubmit();
}

function confirmSubmit(){
saveAnswer();
const un=userAnswers.filter(a=>!a).length;
if(un && !confirm(`${un} unanswered. Submit?`))return;
alert("Quiz Submitted");
}
</script>

</body>
</html>