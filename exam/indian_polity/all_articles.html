<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<title>Indian Polity ‚Äì Article-wise Quiz</title>

<style>
*{box-sizing:border-box;margin:0;padding:0}
body{
  font-family:'Segoe UI',Arial,sans-serif;
  background:#f0f4f8;
  line-height:1.6;
}
header{
  background:#1e3a8a;
  color:#fff;
  padding:1.2rem;
  text-align:center;
  position:sticky;
  top:0;
  z-index:100;
}
.container{max-width:1000px;margin:auto;padding:20px}
.box{
  background:#fff;
  padding:25px;
  border-radius:16px;
  margin-bottom:20px;
  box-shadow:0 10px 15px -3px rgba(0,0,0,.1);
}

/* INPUTS & BUTTONS */
select,button,input{font-family:inherit;font-size:15px}
select{
  width:100%;
  padding:12px;
  border-radius:10px;
  border:2px solid #e2e8f0;
}
button{
  padding:12px 24px;
  border:none;
  border-radius:30px;
  font-weight:600;
  cursor:pointer;
}
.start{background:#059669;color:#fff;font-size:1.2rem}
.next{background:#3b82f6;color:#fff}
.submit{background:#dc2626;color:#fff}

/* PARTS */
.parts{
  display:grid;
  grid-template-columns:repeat(auto-fill,minmax(200px,1fr));
  gap:12px;
}
.parts label{
  display:flex;
  gap:10px;
  background:#eef2ff;
  padding:12px 15px;
  border-radius:30px;
  cursor:pointer;
}
.parts input{width:18px;height:18px}

/* MOBILE */
@media(max-width:640px){
  .container{padding:10px}
  button{width:100%;margin-top:8px}
}

/* quiz elements */
.question-text{font-size:1.2rem;font-weight:500;margin-bottom:1rem}
.option-row{
  background:#f8fafc;
  border-radius:30px;
  padding:12px 20px;
  margin:8px 0;
  border:2px solid transparent;
  transition:0.1s;
}
.option-row.selected{background:#dbeafe;border-color:#3b82f6}
.option-row.correct{background:#bbf7d0;border-color:#059669}
.option-row.wrong{background:#fee2e2;border-color:#dc2626}
.timer{font-size:1.5rem;font-weight:700;color:#1e3a8a}
.flex{display:flex;justify-content:space-between;align-items:center}
</style>
</head>

<body>

<header>
  <h2>üáÆüá≥ Indian Polity ‚Äì Article-wise Quiz</h2>
</header>

<div class="container">

<!-- SETTINGS -->
<div class="box" id="settingsBox">

  <h3>üìã Quiz Settings</h3>
  <p style="color:#64748b;margin-bottom:20px;font-size:14px">
    Customize your quiz by selecting Constitution Parts and question count.
  </p>

  <!-- PART SELECTION -->
  <div class="box" style="background:#f8fafc;border:2px dashed #c7d2fe">
    <h4>üìö Select Constitution Parts</h4>
    <p style="font-size:13px;color:#475569;margin-bottom:12px">
      Select multiple Parts. Leave empty to include all Parts.
    </p>

    <div id="partContainer" class="parts">
      <div>Loading parts...</div>
    </div>

    <div style="display:flex;gap:10px;margin-top:15px;flex-wrap:wrap">
      <button type="button" class="next" onclick="selectAllParts()">‚úî Select All</button>
      <button type="button" class="submit" onclick="clearAllParts()">‚úñ Clear All</button>
    </div>
  </div>

  <!-- QUESTION COUNT -->
  <div class="box" style="background:#eef2ff">
    <label style="font-weight:bold">üî¢ Number of Questions</label>
    <select id="questionCount" style="margin-top:10px">
      <option value="5">5 ‚Äì Quick Test</option>
      <option value="10">10 ‚Äì Mini Test</option>
      <option value="20">20 ‚Äì Practice Set</option>
      <option value="30">30 ‚Äì Section Test</option>
      <option value="50" selected>50 ‚Äì Full Test</option>
      <option value="100">100 ‚Äì Marathon</option>
    </select>
    <p style="font-size:13px;color:#475569;margin-top:8px">
      ‚è±Ô∏è Time: 1 minute per question
    </p>
  </div>

  <!-- START -->
  <button class="start" onclick="startQuiz()" style="width:100%;margin-top:20px">
    üöÄ Start Polity Quiz
  </button>

</div>

<!-- QUIZ / RESULT / REVIEW -->
<div class="box" id="quizBox" style="display:none"></div>
<div class="box" id="resultBox" style="display:none"></div>
<div class="box" id="reviewBox" style="display:none"></div>

</div>

<script>
/* ==== FULL QUIZ LOGIC ‚Äì LOAD, FILTER, ATTEMPT, REVIEW ==== */

const sheetURL = "https://docs.google.com/spreadsheets/d/e/2PACX-1vSoofrGeEqZfnkiTKZOJ68ap8x70uC77dafP0psIy-GRn1gWyFCEl5bKCou24KZQqG_YBkL3dNmJlCI/pub?output=csv";

let allQuestions = [];
let quiz = [];               // current quiz questions
let index = 0;
let userAnswers = [];        // array of selected option (0‚Äëbased)
let timerInterval = null;
let secondsLeft = 0;
let totalTimeSeconds = 0;

// DOM elements
const partContainer = document.getElementById("partContainer");
const questionCount = document.getElementById("questionCount");
const settingsBox = document.getElementById("settingsBox");
const quizBox = document.getElementById("quizBox");
const resultBox = document.getElementById("resultBox");
const reviewBox = document.getElementById("reviewBox");

window.addEventListener("load", loadQuestions);

async function loadQuestions() {
  try {
    const res = await fetch(sheetURL);
    const text = await res.text();
    const rows = text.trim().split("\n").slice(1);
    allQuestions = rows.map(r => {
      // handle possible commas inside fields ‚Äì crude but keeps original format
      const c = r.split(",");
      // expected columns: question, opt1, opt2, opt3, opt4, answerLetter, explanation, part
      return {
        q: c[0] || "",
        opts: c.slice(1,5).map(s => s.replace(/^"|"$/g, '')),  // remove surrounding quotes
        ans: (c[5] || "A").trim().charAt(0).toUpperCase(),    // 'A','B','C','D'
        exp: c[6] || "",
        part: (c[7] || "Other").trim()
      };
    });
    displayPartFilters();
  } catch (e) {
    partContainer.innerHTML = "<div style='color:red'>Failed to load questions. Using sample data.</div>";
    // fallback sample data (polity like)
    allQuestions = [
      {q:"Who is the guardian of the Constitution of India?", opts:["President","Supreme Court","Parliament","Chief Justice"], ans:"B", exp:"Supreme Court is the guardian.", part:"Part V"},
      {q:"Which article deals with the President's impeachment?", opts:["Article 61","Article 72","Article 74","Article 123"], ans:"A", exp:"Article 61 describes impeachment.", part:"Part V"},
      {q:"Right to Equality is ensured by which articles?", opts:["14-18","19-22","23-24","25-28"], ans:"A", exp:"Articles 14 to 18 cover Right to Equality.", part:"Part III"},
      {q:"Which article abolishes untouchability?", opts:["17","15","16","18"], ans:"A", exp:"Article 17 abolishes untouchability.", part:"Part III"},
      {q:"The Constitution of India came into force on?", opts:["26 Jan 1950","15 Aug 1947","26 Nov 1949","30 Jan 1948"], ans:"A", exp:"26 January 1950.", part:"Part I"},
    ];
    displayPartFilters();
  }
}

function displayPartFilters() {
  const parts = [...new Set(allQuestions.map(q => q.part))];
  if (parts.length === 0) parts.push("Part I","Part III","Part V","Other");
  partContainer.innerHTML = parts.map(p => `
    <label>
      <input type="checkbox" value="${p.toLowerCase().replace(/\s+/g,'')}">
      <span>${p}</span>
    </label>
  `).join("");
}

function selectAllParts() {
  document.querySelectorAll("#partContainer input").forEach(c => c.checked = true);
}
function clearAllParts() {
  document.querySelectorAll("#partContainer input").forEach(c => c.checked = false);
}

// main start function
function startQuiz() {
  // get selected parts
  const partChecks = document.querySelectorAll("#partContainer input");
  const selectedParts = [];
  partChecks.forEach(c => { if (c.checked) selectedParts.push(c.nextElementSibling.innerText.trim()); });

  // filter questions by part (if any selected)
  let pool = allQuestions;
  if (selectedParts.length > 0) {
    pool = allQuestions.filter(q => selectedParts.includes(q.part));
  }

  if (pool.length === 0) {
    alert("No questions available for selected parts. Select other parts.");
    return;
  }

  const count = parseInt(questionCount.value, 10);
  // shuffle and pick
  const shuffled = [...pool].sort(() => Math.random() - 0.5);
  quiz = shuffled.slice(0, Math.min(count, shuffled.length));
  if (quiz.length < count) {
    alert(`Only ${quiz.length} questions available for selected parts. Starting with ${quiz.length} questions.`);
  }

  // reset state
  index = 0;
  userAnswers = new Array(quiz.length).fill(null);
  if (timerInterval) clearInterval(timerInterval);
  totalTimeSeconds = quiz.length * 60; // 1 min per question
  secondsLeft = totalTimeSeconds;

  // hide settings, show quiz
  settingsBox.style.display = "none";
  quizBox.style.display = "block";
  resultBox.style.display = "none";
  reviewBox.style.display = "none";

  renderQuizQuestion();
  startTimer();
}

function startTimer() {
  timerInterval = setInterval(() => {
    secondsLeft--;
    if (secondsLeft <= 0) {
      clearInterval(timerInterval);
      finishQuiz(); // time out ‚Äì auto submit
    }
    updateTimerDisplay();
  }, 1000);
}

function updateTimerDisplay() {
  const timerSpan = document.getElementById("timerDisplay");
  if (timerSpan) {
    const mins = Math.floor(secondsLeft / 60);
    const secs = secondsLeft % 60;
    timerSpan.innerText = `${mins}:${secs < 10 ? '0' : ''}${secs}`;
  }
}

function renderQuizQuestion() {
  if (index >= quiz.length) {
    finishQuiz();
    return;
  }
  const q = quiz[index];
  const saved = userAnswers[index];
  const optsHtml = q.opts.map((opt, i) => {
    let letter = String.fromCharCode(65 + i); // A,B,C,D
    let selectedClass = (saved === i) ? 'selected' : '';
    return `<div class="option-row ${selectedClass}" onclick="selectOption(${i})">
      <span style="font-weight:600;margin-right:10px">${letter}.</span> ${opt}
    </div>`;
  }).join('');

  quizBox.innerHTML = `
    <div class="flex">
      <h3>Question ${index+1} / ${quiz.length}</h3>
      <div class="timer">‚è≥ <span id="timerDisplay"></span></div>
    </div>
    <div class="question-text">${q.q}</div>
    <div id="optionsContainer">${optsHtml}</div>
    <div style="display:flex;justify-content:space-between;margin-top:25px;gap:10px;flex-wrap:wrap">
      <button class="next" onclick="prevQuestion()" ${index===0?'disabled style="opacity:0.5"':''}>‚óÄ Previous</button>
      <button class="next" onclick="nextQuestion()">Next ‚ñ∂</button>
      <button class="submit" onclick="finishQuiz()">‚èπÔ∏è Finish</button>
    </div>
  `;
  updateTimerDisplay();
}

function selectOption(optIndex) {
  userAnswers[index] = optIndex;
  // re-render to show highlight
  renderQuizQuestion();
}

function prevQuestion() {
  if (index > 0) {
    index--;
    renderQuizQuestion();
  }
}
function nextQuestion() {
  if (index < quiz.length - 1) {
    index++;
    renderQuizQuestion();
  } else {
    finishQuiz();
  }
}

function finishQuiz() {
  clearInterval(timerInterval);
  // build result
  let correct = 0;
  quiz.forEach((q, i) => {
    const ansLetter = q.ans.toUpperCase().charCodeAt(0) - 65; // 'A'->0, 'B'->1
    if (userAnswers[i] === ansLetter) correct++;
  });
  const percentage = Math.round((correct / quiz.length)*100);
  // show result box
  quizBox.style.display = "none";
  resultBox.style.display = "block";
  resultBox.innerHTML = `
    <h3>üìä Quiz Result</h3>
    <div style="background:#e6f7e6;border-radius:20px;padding:30px;text-align:center">
      <div style="font-size:4rem">${correct}/${quiz.length}</div>
      <div style="font-size:2rem;margin:10px 0">${percentage}%</div>
      <div style="margin:20px 0">‚è±Ô∏è Time taken: ${formatTime(totalTimeSeconds - secondsLeft)} / ${formatTime(totalTimeSeconds)}</div>
      <button class="next" onclick="reviewQuiz()">üìã Review Answers</button>
      <button class="start" onclick="newQuiz()" style="margin-left:10px">üîÑ New Quiz</button>
    </div>
  `;
}

function formatTime(sec) {
  if (sec<0) sec=0;
  const m = Math.floor(sec/60);
  const s = sec%60;
  return `${m}:${s<10?'0':''}${s}`;
}

function reviewQuiz() {
  resultBox.style.display = "none";
  reviewBox.style.display = "block";
  let html = '<h3>üîç Detailed Review</h3>';
  quiz.forEach((q, i) => {
    const userOpt = userAnswers[i];
    const correctIdx = q.ans.toUpperCase().charCodeAt(0)-65;
    const isCorrect = (userOpt === correctIdx);
    let statusIcon = isCorrect ? '‚úÖ' : '‚ùå';
    let userLetter = (userOpt!==null) ? String.fromCharCode(65+userOpt) : 'Not answered';
    let correctLetter = String.fromCharCode(65+correctIdx);
    let explanation = q.exp ? q.exp : 'No explanation.';

    html += `<div style="border-bottom:1px solid #ddd;padding:20px 0">
      <p><strong>Q${i+1}:</strong> ${q.q}</p>
      <p>${statusIcon} Your answer: ${userLetter}  |  Correct: ${correctLetter}</p>
      <p style="background:#f1f5f9;padding:10px;border-radius:12px">üí° ${explanation}</p>
    </div>`;
  });
  html += `<button class="start" onclick="newQuiz()" style="margin-top:20px">üîÑ New Quiz</button>`;
  reviewBox.innerHTML = html;
}

function newQuiz() {
  // reset UI
  settingsBox.style.display = "block";
  quizBox.style.display = "none";
  resultBox.style.display = "none";
  reviewBox.style.display = "none";
  if (timerInterval) clearInterval(timerInterval);
}

// expose globals for inline handlers
window.selectAllParts = selectAllParts;
window.clearAllParts = clearAllParts;
window.startQuiz = startQuiz;
window.selectOption = selectOption;
window.prevQuestion = prevQuestion;
window.nextQuestion = nextQuestion;
window.finishQuiz = finishQuiz;
window.reviewQuiz = reviewQuiz;
window.newQuiz = newQuiz;

</script>
</body>
</html>
