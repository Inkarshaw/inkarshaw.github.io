<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Yojanas & Schemes Quiz</title>

<style>
body{
  margin:0;
  font-family:Arial,sans-serif;
  background:#f5f7fb;
  color:#111827;
}
header{
  background:#1e40af;
  color:#fff;
  padding:15px;
  text-align:center;
}
.container{
  max-width:900px;
  margin:auto;
  padding:15px;
}
.box{
  background:#fff;
  padding:20px;
  border-radius:12px;
  margin-bottom:15px;
}
label{font-weight:bold}
select{
  width:100%;
  padding:8px;
  margin-top:6px;
  border-radius:6px;
  border:1px solid #d1d5db;
}
button{
  padding:10px 18px;
  border:none;
  border-radius:20px;
  font-size:15px;
  cursor:pointer;
}
.start{background:#16a34a;color:#fff;margin-top:15px}
.next{background:#2563eb;color:#fff}
.submit{background:#dc2626;color:#fff;margin-left:10px}

.options label{
  display:block;
  background:#f1f5f9;
  padding:10px;
  margin:8px 0;
  border-radius:6px;
  cursor:pointer;
}
.correct{color:green;font-weight:bold}
.wrong{color:red;font-weight:bold}
</style>
</head>

<body>

<header>
  <h2>ðŸ“˜ Yojanas & Government Schemes Quiz</h2>
</header>

<div class="container">

<!-- SETTINGS -->
<div class="box" id="settingsBox">
  <h3>Select Topic</h3>

  <label>Yojana / Scheme</label>
  <select id="topicSelect">
    <option value="">Loading topics...</option>
  </select>

  <button class="start" onclick="startQuiz()">Start Quiz</button>
</div>

<!-- QUIZ -->
<div class="box" id="quizBox" style="display:none">
  <div id="question"></div>
  <div class="options" id="options"></div>

  <button class="next" onclick="nextQ()">Next</button>
  <button class="submit" onclick="submitQuiz()">Submit Quiz</button>
</div>

<!-- REVIEW -->
<div id="reviewBox"></div>

</div>

<script>
const sheetURL =
"https://docs.google.com/spreadsheets/d/e/2PACX-1vTOEwxsSeGZI2M074Zdjy5K0ewaZYJD38m5eCM0aKS7gAqlBUOKbCQPN3_FbHP-4uA25uBgobRt3l1w/pub?output=csv";

let allQuestions = [];
let quiz = [];
let index = 0;
let userAnswers = [];

// LOAD SHEET
fetch(sheetURL)
.then(res => res.text())
.then(csv => {
  const rows = csv.trim().split("\n").slice(1);

  allQuestions = rows.map(r => {
    const c = r.split(/,(?=(?:(?:[^"]*"){2})*[^"]*$)/);
    return {
      topic: c[0].trim(),
      q: c[1],
      opts: [c[2], c[3], c[4], c[5]],
      ans: c[6].trim().toUpperCase(), // A/B/C/D
      exp: c[7]
    };
  });

  populateTopics();
});

// POPULATE TOPIC DROPDOWN
function populateTopics(){
  const select = document.getElementById("topicSelect");
  const topics = [...new Set(allQuestions.map(q => q.topic))];

  select.innerHTML = `<option value="">-- Select Topic --</option>`;
  topics.forEach(t => {
    const opt = document.createElement("option");
    opt.value = t;
    opt.textContent = t;
    select.appendChild(opt);
  });
}

// START QUIZ
function startQuiz(){
  const topic = document.getElementById("topicSelect").value;
  if(!topic){
    alert("Please select a topic");
    return;
  }

  quiz = allQuestions.filter(q => q.topic === topic);

  index = 0;
  userAnswers = new Array(quiz.length).fill(null);

  document.getElementById("settingsBox").style.display = "none";
  document.getElementById("quizBox").style.display = "block";

  loadQ();
}

// LOAD QUESTION
function loadQ(){
  const q = quiz[index];
  document.getElementById("question").innerHTML =
    `<h3>Q${index+1}. ${q.q}</h3>`;

  const optDiv = document.getElementById("options");
  optDiv.innerHTML = "";

  q.opts.forEach((opt,i)=>{
    const letter = String.fromCharCode(65+i);
    optDiv.innerHTML += `
      <label>
        <input type="radio" name="opt" value="${letter}"
        ${userAnswers[index]===letter?"checked":""}>
        <b>${letter}.</b> ${opt}
      </label>
    `;
  });
}

// NEXT
function nextQ(){
  saveAnswer();
  if(index < quiz.length-1){
    index++;
    loadQ();
  }
}

// SAVE ANSWER
function saveAnswer(){
  const sel = document.querySelector('input[name="opt"]:checked');
  userAnswers[index] = sel ? sel.value : null;
}

// SUBMIT
function submitQuiz(){
  saveAnswer();
  document.getElementById("quizBox").style.display = "none";
  showReview();
}

// REVIEW (ATTEMPTED ONLY)
function showReview(){
  let score = 0, attempted = 0;
  let html = `<div class="box"><h2>Quiz Review</h2>`;

  quiz.forEach((q,i)=>{
    if(!userAnswers[i]) return;
    attempted++;

    const right = userAnswers[i] === q.ans;
    if(right) score++;

    const ua = userAnswers[i].charCodeAt(0)-65;
    const ca = q.ans.charCodeAt(0)-65;

    html += `
      <hr>
      <p><b>Q${i+1}. ${q.q}</b></p>
      <p>Your Answer: <b>${userAnswers[i]}</b>. ${q.opts[ua]}</p>
      <p>Correct Answer: <b>${q.ans}</b>. ${q.opts[ca]}</p>
      <p class="${right?'correct':'wrong'}">
        ${right?'âœ” Correct':'âœ– Wrong'}
      </p>
      <p><b>Explanation:</b> ${q.exp}</p>
    `;
  });

  html += `
    <h3>Attempted: ${attempted}/${quiz.length}</h3>
    <h3>Score: ${score}/${attempted}</h3>
  </div>`;

  document.getElementById("reviewBox").innerHTML = html;
}
</script>

</body>
</html>